
Функция Создать(Excel_Настройки) Экспорт
	
	ПРОТОКОЛИРУЕМОЕ_СОБЫТИЕ = "ОбщийМодуль.ОбщегоНазначенияMicrosoftExcelКлиентСерверУХ.Создать";
	
	Попытка
	
		ExcelApplication = New COMОбъект("Excel.Application");
		
		ExcelApplication.Visible = False;

		Excel_Настройки = Новый Структура;
		Excel_Настройки.Вставить("AskToUpdateLinks",   ExcelApplication.AskToUpdateLinks);
		Excel_Настройки.Вставить("DisplayAlerts",      ExcelApplication.DisplayAlerts);
		Excel_Настройки.Вставить("AutomationSecurity", ExcelApplication.AutomationSecurity);

		ExcelApplication.AskToUpdateLinks = False;
		ExcelApplication.DisplayAlerts = False;
		ExcelApplication.AutomationSecurity = 3;
		
	Исключение
		
		ПротоколируемыеСобытияВызовСервераУХ.ДобавитьЗаписьПримечание(ПРОТОКОЛИРУЕМОЕ_СОБЫТИЕ,,, ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		Возврат Неопределено;
		
	КонецПопытки;
	
	Возврат ExcelApplication;
		
КонецФункции

Функция Закрыть(ExcelApplication, Excel_Настройки, ЗакрытьКниги = Истина) Экспорт
	
	ПРОТОКОЛИРУЕМОЕ_СОБЫТИЕ = "ОбщийМодуль.ОбщегоНазначенияMicrosoftExcelКлиентСерверУХ.Закрыть";
	
	Попытка
		
		Если ЗакрытьКниги Тогда
			
			ExcelApplication.DisplayAlerts=0;
			
			For Each Workbook In ExcelApplication.Workbooks Do
				
				Workbook.Close(False);
				Workbook=Неопределено;
				
			EndDo;
			
		КонецЕсли;
				
		ExcelApplication.Quit();
		ExcelApplication=Неопределено;
							
	Исключение
		
		ПротоколируемыеСобытияВызовСервераУХ.ДобавитьЗаписьПримечание(ПРОТОКОЛИРУЕМОЕ_СОБЫТИЕ,,, ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
		Возврат Ложь;
		
	КонецПопытки;
	
	Возврат Истина;
	
КонецФункции

Функция ИмяЛистаCOM2ADO(Знач Имя) Экспорт
	
	ЕстьСпециальныеСимволы = Ложь;
	ЕстьСпециальныеСимволы = СтрНайти(Имя, " ") > 0;
	ЕстьСпециальныеСимволы = ЕстьСпециальныеСимволы ИЛИ СтрНайти(Имя, ",") > 0;
	ЕстьСпециальныеСимволы = ЕстьСпециальныеСимволы ИЛИ СтрНайти(Имя, "(") > 0;
	ЕстьСпециальныеСимволы = ЕстьСпециальныеСимволы ИЛИ СтрНайти(Имя, ")") > 0;
	ЕстьСпециальныеСимволы = ЕстьСпециальныеСимволы ИЛИ СтрНайти(Имя, "&") > 0;
	
	Имя = СтрЗаменить(Имя, ".", "#");
	
	Имя = Имя + "$";
	
	Если ЕстьСпециальныеСимволы Тогда
		Имя = "'" + Имя + "'";
	КонецЕсли;
	
	Возврат Имя;
	
Конецфункции

Функция ИмяКолонкиCOM2ADO(Знач Имя) Экспорт
	
	Имя = СтрЗаменить(Имя, ".", "#");
	
	Возврат Лев(Имя, 64);
	
КонецФункции