
// Предлагаем пользователю выбрать файл/ы. И возвращаем их список.
// Параметры
//  СписокИмен - массив, в который будут сохранены имена файлов
//  МножественныйВыбор - флаг переключающий выбор
//  НачальныйКаталог - каталог из которого будет осуществляться выбор
//
Процедура ПолучитьИменаФайлов(СписокИмен, МножественныйВыбор=Ложь, НачальныйКаталог="") Экспорт

	ДопПараметры = Новый Структура("МножественныйВыбор,СписокИмен,НачальныйКаталог", 
									МножественныйВыбор, СписокИмен, НачальныйКаталог);
	Оповещение = Новый ОписаниеОповещения("Подключаемый_ПолучитьИменаФайлов", ЭтотОбъект, ДопПараметры);
	
	ОбщегоНазначенияКлиентУХ.ПоказатьВопросОбУстановкеРасширенияРаботыСФайлами(Оповещение,, Ложь);
		
КонецПроцедуры

Процедура Подключаемый_ПолучитьИменаФайлов(Результат, ДополнительныеПараметры) Экспорт
	
	Если Результат <> Истина Тогда
		// Отказ от установки расширения.
		Возврат;
	КонецЕсли;
	
	МножественныйВыбор 	= ДополнительныеПараметры.МножественныйВыбор;
	СписокИмен 			= ДополнительныеПараметры.СписокИмен;
	НачальныйКаталог	= ДополнительныеПараметры.НачальныйКаталог;
	
    ИмяКаталога = КаталогВременныхФайлов();
    
    Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
    Диалог.Каталог = ?(НачальныйКаталог="", ИмяКаталога, НачальныйКаталог);
    Диалог.Заголовок = НСтр("ru = 'Выбор файла'");
    Диалог.Фильтр = НСтр("ru = 'Все файлы (*.*)|*.*'");
    Диалог.ПредварительныйПросмотр = Ложь;
    Диалог.ПроверятьСуществованиеФайла = Истина;
    Диалог.МножественныйВыбор = МножественныйВыбор;
	
	ДопПараметры = Новый Структура("СписокИмен", СписокИмен);
	Оповещение = Новый ОписаниеОповещения("Подключаемый_ПолучитьИменаФайловЗавершение", ЭтотОбъект, ДопПараметры);
    Диалог.Показать(Оповещение);

КонецПроцедуры

Процедура Подключаемый_ПолучитьИменаФайловЗавершение(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
    
    СписокИмен = ДополнительныеПараметры.СписокИмен;    
    
    Если Не (ВыбранныеФайлы <> Неопределено) Тогда
        Возврат;
    КонецЕсли;
    
    Если ТипЗнч(СписокИмен) <> Тип("СписокЗначений") Тогда
        СписокИмен = Новый СписокЗначений;
    КонецЕсли;
    
    Для каждого ПолученноеИмяФайла Из ВыбранныеФайлы Цикл
		
		Если СписокИмен.НайтиПоЗначению(ПолученноеИмяФайла) <> Неопределено  Тогда 
            Продолжить;
        КонецЕсли;
		
		СписокИмен.Добавить(ПолученноеИмяФайла, РаботаСФайламиУХ.ПолучитьИмяФайлаИзПолногоПути(ПолученноеИмяФайла));
		
    КонецЦикла;

КонецПроцедуры // ДобавитьФайлы()