
#Область ПрограммныйИнтерфейс

//Инициализирует настройки отчета для формирования отчета.
// Возвращаемое значение:
//	Структура - настройки отчета.
Функция ИнициализироватьНастройкиОтчета(Отчет, КлючТекущегоВарианта, ОтчетОбъект) Экспорт
	
	НастройкиОтчета = ВариантыОтчетов.НастройкиФормыОтчета(Отчет, КлючТекущегоВарианта, ОтчетОбъект); // Структура
	ОбщегоНазначенияКлиентСервер.ДополнитьСтруктуру(НастройкиОтчета, ВариантыОтчетов.ПараметрыКлиента());
	
	НастройкиОтчета.Вставить("ПрочитатьФлажокФормироватьСразуИзПользовательскихНастроек", Ложь);
	НастройкиОтчета.Вставить("РазрешеноВыбиратьВарианты", Ложь);
	НастройкиОтчета.Вставить("СхемаМодифицирована", Ложь);
	НастройкиОтчета.Вставить("ПредопределенныеВарианты", Неопределено);
	НастройкиОтчета.Вставить("АдресСхемы",   "");
	НастройкиОтчета.Вставить("КлючСхемы",    "");
	НастройкиОтчета.Вставить("Контекстный",  Ложь);
	НастройкиОтчета.Вставить("ПолноеИмя",    "");
	НастройкиОтчета.Вставить("Наименование", "");
	НастройкиОтчета.Вставить("ОтчетСсылка",  Неопределено);
	НастройкиОтчета.Вставить("Внешний",      Ложь);
	НастройкиОтчета.Вставить("Безопасный",   Ложь);
	
	Возврат НастройкиОтчета;
	
КонецФункции

// Строит дерево себестоимости для изделия.
//
// Параметры:
//  ПараметрыДерева - см. СтруктураСебестоимости.ПараметрыДереваСебестоимости
//  ПараметрыУзла - см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости.
//
Процедура ПостроитьДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла = Неопределено) Экспорт
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	Замер = ОценкаПроизводительности.НачатьЗамерДлительнойОперации("ОбщийМодуль.СтруктураСебестоимости.ПостроитьДеревоСебестоимости");
	ПараметрыДерева.Вставить("КоличествоСтрок", 0);
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
	Если ПараметрыУзла = Неопределено Тогда
		ПараметрыУзла = СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости();
	КонецЕсли;
	
	Если ПараметрыДерева.Результат = Неопределено Тогда
		ПустоеДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла);
	КонецЕсли;
	
	ЗаполнитьДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла);
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	ОценкаПроизводительности.ЗакончитьЗамерДлительнойОперации(Замер, ПараметрыДерева.КоличествоСтрок / 1000);
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
КонецПроцедуры

// Строит дерево себестоимости для изделия в фоне.
//
// Параметры:
// 	Параметры - Структура - описание параметров формирования отчетов.
//		* ПараметрыДерева - см. СтруктураСебестоимости.ПараметрыДереваСебестоимости - параметры дерева.
//		* ПараметрыУзла -см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости - параметры узла дерева.
//	АдресХранилища - Строка - адрес временного хранилища.
Процедура ПостроитьДеревоСебестоимостиВФоне(Параметры, АдресХранилища) Экспорт
	
	ПараметрыДерева = Параметры.ПараметрыДерева; // см. СтруктураСебестоимости.ПараметрыДереваСебестоимости
	ПараметрыУзла = Параметры.ПараметрыУзла; // см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости
	ПостроитьДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла);
	
	Результат = Новый Структура("ДеревоСебестоимости, Успех");
	Результат.ДеревоСебестоимости	= ПараметрыДерева.Результат;
	Результат.Успех					= Истина;
	
	ПоместитьВоВременноеХранилище(Результат, АдресХранилища);
	
КонецПроцедуры

// Вызывается перед раскрытием узла дерева себестоимости.
//
// Параметры:
//  ПараметрыДерева	- см. СтруктураСебестоимости.ПараметрыДереваСебестоимости
//  ПараметрыУзла - см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости
//  ОписаниеПродукции	- Структура	- Аналитика учета, партия и уровень продукции.
//
Процедура ДеревоСебестоимостиПередРазворачиванием(ПараметрыДерева, ПараметрыУзла, ОписаниеПродукции) Экспорт
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	Замер = ОценкаПроизводительности.НачатьЗамерДлительнойОперации("ОбщийМодуль.СтруктураСебестоимости.ДеревоСебестоимостиПередРазворачиванием");
	ПараметрыДерева.Вставить("КоличествоСтрок", 0);
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
	РазузловатьУзелДереваСебестоимости(ПараметрыДерева, ПараметрыУзла, ПараметрыДерева.Результат, ОписаниеПродукции);
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	ОценкаПроизводительности.ЗакончитьЗамерДлительнойОперации(Замер, ПараметрыДерева.КоличествоСтрок / 100);
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
КонецПроцедуры

#Область ПараметрыДереваСебестоимости

// Параметры построения дерева себестоимости
// 
// Возвращаемое значение:
// Структура:
//  * ДинамическоеСчитывание - Булево - Истина, если уровни дерева себестоимости получается последовательно.
//  * ТипРезультата - Строка - Тип объекта, в который будет помещен результат - ДеревоЗначений, ТаблицаЗначений, МенеджерВременныхТаблиц.
//  * Результат - ДеревоЗначений, ТаблицаЗначений, МенеджерВременныхТаблиц - Объект, в который будет помещен результат разузлования.
//  * ДобавлятьПолуфабрикатыВРезультат - Булево - Будут ли добавлены промежуточные полуфабрикаты в результат.
//                                                Если результат ДеревоЗначений, то полуфабрикаты добавляются всегда.
//
Функция ПараметрыДереваСебестоимости() Экспорт
	
	ТипыРезультата = Новый ОписаниеТипов("ДеревоЗначений,ТаблицаЗначений,МенеджерВременныхТаблиц");
	
	ПараметрыДерева = Новый Структура;
	
	ПараметрыДерева.Вставить("ДинамическоеСчитывание",	Истина);
	ПараметрыДерева.Вставить("ТипРезультата",			"ДеревоЗначений");
	ПараметрыДерева.Вставить("Результат",				ТипыРезультата.ПривестиЗначение(Неопределено));
	ПараметрыДерева.Вставить("ДобавлятьПолуфабрикатыВРезультат", Истина);
	
	Возврат ПараметрыДерева;
	
КонецФункции

// Параметры узла дерева себестоимости
// 
// Возвращаемое значение:
// Структура:
//  * ИнтерактивнаяНастройка - Булево - Истина, если для получения таблицы ВыпущеннаяПродукция используется схема КД
//  * СхемаКД - СхемаКомпоновкиДанных - Схема КД для получения таблицы ВыпущеннаяПродукция
//  * НастройкиКД - НастройкиКомпоновкиДанных - Настройки схемы КД для получения таблицы ВыпущеннаяПродукция
//  * Отборы - Структура - Структура отборов, накладываемых на получение таблицы ВыпущеннаяПродукция.
//                         Используется для программного получения данных себестоимости.
//
Функция ПараметрыУзлаДереваСебестоимости() Экспорт
	
	ПараметрыУзла = Новый Структура;
	
	ПараметрыУзла.Вставить("ИнтерактивнаяНастройка",	Ложь);
	ПараметрыУзла.Вставить("СхемаКД",					Отчеты.ДеревоСебестоимостиПродукции.ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных"));
	ПараметрыУзла.Вставить("НастройкиКД",				ПараметрыУзла.СхемаКД.НастройкиПоУмолчанию);
	
	Отборы = НоваяСтруктураОтборов();
	ПараметрыУзла.Вставить("Отборы", Отборы);
	
	Возврат ПараметрыУзла;
	
КонецФункции

Функция НоваяСтруктураОтборов()
	
	Регистраторы = Новый Массив; // Массив из ДокументСсылка
	Организации = Новый Массив; // Массив из СправочникСсылка.Организации
	Подразделения = Новый Массив; // Массив из СправочникСсылка.СтруктураПредприятия
	Продукция = Новый Массив; // Массив из СправочникСсылка.Номенклатура
	ХарактеристикиПродукции = Новый Массив; // Массив из СправочникСсылка.ХарактеристикиНоменклатуры
	СерииПродукции = Новый Массив; // Массив из СправочникСсылка.СерииНоменклатуры
	НазначенияПродукции = Новый Массив; // Массив из СправочникСсылка.Назначения
	ПартииПродукции = Новый Массив; // Массив из ДокументСсылка
	АналитикиУчетаПартийПродукции = Новый Массив; // Массив из СправочникСсылка.КлючиАналитикиУчетаПартий
	
	Отборы = Новый Структура;
	
	Отборы.Вставить("ДанныеПоСебестоимости",			1);
	Отборы.Вставить("ДатаНачала",						'00010101');
	Отборы.Вставить("ДатаОкончания",					'00010101');
	Отборы.Вставить("Регистраторы",						Регистраторы);
	Отборы.Вставить("Организации",						Организации);
	Отборы.Вставить("Подразделения",					Подразделения);
	Отборы.Вставить("Продукция",						Продукция);
	Отборы.Вставить("ХарактеристикиПродукции",			ХарактеристикиПродукции);
	Отборы.Вставить("СерииПродукции",					СерииПродукции);
	Отборы.Вставить("НазначенияПродукции",				НазначенияПродукции);
	Отборы.Вставить("ПартииПродукции",					ПартииПродукции);
	Отборы.Вставить("АналитикиУчетаПартийПродукции",	АналитикиУчетаПартийПродукции);
	Отборы.Вставить("Числитель",						0);
	Отборы.Вставить("Знаменатель",						0);
	Отборы.Вставить("ВалютаУправленческогоУчета",		Справочники.Валюты.ПустаяСсылка());
	
	Возврат Отборы;
	
КонецФункции
	
#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Заполняет дерево себестоимости
//
// Параметры:
//  ПараметрыДерева	- см. СтруктураСебестоимости.ПараметрыДереваСебестоимости
//  ПараметрыУзла - см. СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости
//
Процедура ЗаполнитьДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла)
	
	Запрос = ЗапросВыпущеннаяПродукция(ПараметрыУзла, Ложь);
	ВыпущеннаяПродукция = Запрос.Выполнить().Выгрузить();
	
	Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
		Результат = ПараметрыДерева.Результат.Строки;
	ИначеЕсли ПараметрыДерева.ТипРезультата = "ТаблицаЗначений" Тогда
		Результат = ПараметрыДерева.Результат;
	Иначе
		Результат = Новый ТаблицаЗначений;
		ИнициализироватьПоляДереваСебестоимости(Результат);
	КонецЕсли;
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	ПараметрыДерева.КоличествоСтрок = ПараметрыДерева.КоличествоСтрок + ВыпущеннаяПродукция.Количество();
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
	Для Каждого ТекПартия Из ВыпущеннаяПродукция Цикл
		
		Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений"
			ИЛИ ПараметрыДерева.ДобавлятьПолуфабрикатыВРезультат
			ИЛИ Не ТекПартия.ТребуетсяРазузлование Тогда
			СтрокаПартия = Результат.Добавить(); // СтрокаДереваЗначений
			ЗаполнитьЗначенияСвойств(СтрокаПартия, ТекПартия);
			
			СтрокаПартия.Идентификатор	= Новый УникальныйИдентификатор();
			СтрокаПартия.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияПродукции;
			
			СтрокаПартия.АналитикаУчетаВыходноеИзделие			= ТекПартия.АналитикаУчетаПродукции;
			СтрокаПартия.АналитикаУчетаПартийВыходноеИзделие	= ТекПартия.АналитикаУчетаПартийПродукции;
			СтрокаПартия.ПартияВыходноеИзделие					= ТекПартия.ПартияПродукции;
			
			СтрокаПартия.Номенклатура			= ТекПартия.Продукция;
			СтрокаПартия.Характеристика			= ТекПартия.ХарактеристикаПродукции;
			СтрокаПартия.Серия					= ТекПартия.СерияПродукции;
			СтрокаПартия.Назначение				= ТекПартия.НазначениеПродукции;
			СтрокаПартия.Валюта					= ТекПартия.Валюта;
			СтрокаПартия.Партия					= ТекПартия.ПартияПродукции;
			СтрокаПартия.АналитикаУчетаПартий	= ТекПартия.АналитикаУчетаПартийПродукции;
			СтрокаПартия.ЕдиницаИзмерения		= ТекПартия.ЕдиницаИзмеренияПродукция;
			
			СтрокаПартия.Количество	= ТекПартия.КоличествоПродукция;
			СтрокаПартия.Сумма		= ТекПартия.СуммаПродукция;
			СтрокаПартия.СуммаЗабалансовая = ТекПартия.СуммаПродукцияЗабалансовая;
		КонецЕсли;
		
		Если ТекПартия.ТребуетсяРазузлование
			И ПараметрыДерева.ТипРезультата = "ДеревоЗначений"
			И ПараметрыДерева.ДинамическоеСчитывание Тогда
			
			СтрокаПартия.Строки.Добавить();
			
		ИначеЕсли ТекПартия.ТребуетсяРазузлование Тогда
			
			ПараметрыУзлаПартии = СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости();
			
			Отборы = ПараметрыУзлаПартии.Отборы;
			Отборы.ДанныеПоСебестоимости = ПараметрыУзла.Отборы.ДанныеПоСебестоимости;
			Отборы.Продукция.Добавить(ТекПартия.Продукция);
			Отборы.ХарактеристикиПродукции.Добавить(ТекПартия.ХарактеристикаПродукции);
			Отборы.СерииПродукции.Добавить(ТекПартия.СерияПродукции);
			Отборы.ПартииПродукции.Добавить(ТекПартия.ПартияПродукции);
			Отборы.АналитикиУчетаПартийПродукции.Добавить(ТекПартия.АналитикаУчетаПартийПродукции);
			Отборы.Числитель = ТекПартия.Числитель;
			
			ОписаниеПродукции = Новый Структура("АналитикаУчетаПродукции, ПартияПродукции, АналитикаУчетаПартийПродукции");
			ЗаполнитьЗначенияСвойств(ОписаниеПродукции, ТекПартия);
			ОписаниеПродукции.Вставить("Уровень", 0);
			
			Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
				ТаблицаРезультата = СтрокаПартия;
			Иначе
				ТаблицаРезультата = Результат;
			КонецЕсли;
			
			РазузловатьУзелДереваСебестоимости(ПараметрыДерева, ПараметрыУзлаПартии, ТаблицаРезультата, ОписаниеПродукции);
			
		КонецЕсли;
	КонецЦикла;
	
	Если ПараметрыДерева.ТипРезультата = "МенеджерВременныхТаблиц" Тогда
		Запрос = Новый Запрос;
		Запрос.МенеджерВременныхТаблиц = ПараметрыДерева.Результат;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	*
		|ПОМЕСТИТЬ Результат
		|ИЗ
		|	&Результат КАК Результат";
		
		Результат.Колонки.Удалить("Идентификатор");
		Запрос.УстановитьПараметр("Результат", Результат);
		// Структуру ВТ Результат см. в СтруктураСебестоимости.СтруктураПолейДереваСебестоимости.
		Запрос.Выполнить();
	КонецЕсли;
	
КонецПроцедуры

Процедура РазузловатьУзелДереваСебестоимости(ПараметрыДерева, ПараметрыУзла, ТаблицаРезультата, ОписаниеПродукции)
	
	Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
		Результат = ТаблицаРезультата.Строки;
		Если ПараметрыДерева.ДинамическоеСчитывание Тогда
			Результат.Очистить();
		КонецЕсли;
	Иначе
		Результат = ТаблицаРезультата
	КонецЕсли;
	
	ПройденныйПуть = Неопределено;
	Если НЕ ПараметрыДерева.Свойство("ПройденныйПуть", ПройденныйПуть) Тогда
		ПройденныйПуть = Новый ТаблицаЗначений;
		ПройденныйПуть.Колонки.Добавить("Партия");
		ПройденныйПуть.Колонки.Добавить("АналитикаУчетаПартий");
		ПройденныйПуть.Индексы.Добавить("Партия, АналитикаУчетаПартий");
		ПараметрыДерева.Вставить("ПройденныйПуть", ПройденныйПуть);
	КонецЕсли;
	
	АналитикаУчетаПродукции			= ОписаниеПродукции.АналитикаУчетаПродукции;
	ПартияПродукции					= ОписаниеПродукции.ПартияПродукции;
	АналитикаУчетаПартийПродукции	= ОписаниеПродукции.АналитикаУчетаПартийПродукции;
	УровеньУзла						= ОписаниеПродукции.Уровень + 1;
	
	СебестоимостьУзла = СебестоимостьУзла(ПараметрыДерева, ПараметрыУзла);
	
	// СтандартныеПодсистемы.ЗамерПроизводительности
	ПараметрыДерева.КоличествоСтрок = ПараметрыДерева.КоличествоСтрок + СебестоимостьУзла.Количество();
	// Конец СтандартныеПодсистемы.ЗамерПроизводительности
	
	Для Каждого ТекПартия Из СебестоимостьУзла Цикл
		
		Если ТекПартия.ТребуетсяРазузлование И ТекПартия.КоличествоЗатрата <> 0 Тогда
			ПараметрыОтбора = Новый Структура("Партия, АналитикаУчетаПартий",
				ТекПартия.ПартияЗатрата,
				ТекПартия.АналитикаУчетаПартийЗатрата);
			МассивСтрок = ПройденныйПуть.НайтиСтроки(ПараметрыОтбора);
		Иначе
			МассивСтрок = Новый Массив;
		КонецЕсли;
		
		Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений"
			ИЛИ ПараметрыДерева.ДобавлятьПолуфабрикатыВРезультат
			ИЛИ Не ТекПартия.ТребуетсяРазузлование Тогда
			СтрокаПартия = Результат.Добавить(); // СтрокаДереваЗначений
			ЗаполнитьЗначенияСвойств(СтрокаПартия, ТекПартия);
			
			СтрокаПартия.Идентификатор	= Новый УникальныйИдентификатор();
			Если ТекПартия.ТребуетсяРазузлование
			 И Окр(ТекПартия.КоличествоЗатрата, 3) > 0
			 И ТекПартия.СуммаЗатрата > 1
			 И МассивСтрок.Количество() = 0 Тогда
				
				СтрокаПартия.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияПолуфабриката;
				СтрокаПартия.Числитель 		= ТекПартия.КоличествоЗатрата;
				
			Иначе
				СтрокаПартия.ВидСтроки		= Перечисления.ВидыСтрокДереваСебестоимости.ПартияЗатраты;
				СтрокаПартия.ТребуетсяРазузлование = Ложь;
			КонецЕсли;
			
			СтрокаПартия.АналитикаУчетаПродукции		= АналитикаУчетаПродукции;
			СтрокаПартия.ПартияПродукции				= ПартияПродукции;
			СтрокаПартия.АналитикаУчетаПартийПродукции	= АналитикаУчетаПартийПродукции;
			
			СтрокаПартия.Номенклатура			= ТекПартия.Затрата;
			СтрокаПартия.Характеристика			= ТекПартия.ХарактеристикаЗатрата;
			СтрокаПартия.Серия					= ТекПартия.СерияЗатрата;
			СтрокаПартия.Назначение				= ТекПартия.НазначениеЗатрата;
			СтрокаПартия.Партия					= ТекПартия.ПартияЗатрата;
			СтрокаПартия.АналитикаУчетаПартий	= ТекПартия.АналитикаУчетаПартийЗатрата;
			СтрокаПартия.ЕдиницаИзмерения		= ТекПартия.ЕдиницаИзмеренияЗатрата;
			СтрокаПартия.Уровень				= УровеньУзла;
			
			СтрокаПартия.Количество	= ТекПартия.КоличествоЗатрата;
			СтрокаПартия.Сумма		= ТекПартия.СуммаЗатрата;
			СтрокаПартия.СуммаЗабалансовая = ТекПартия.СуммаЗатратаЗабалансовая;
		КонецЕсли;
		
		Если ТекПартия.ТребуетсяРазузлование
			И ПараметрыДерева.ТипРезультата = "ДеревоЗначений"
			И ПараметрыДерева.ДинамическоеСчитывание Тогда
			СтрокаПартия.Строки.Добавить();
		ИначеЕсли ТекПартия.ТребуетсяРазузлование
		 И Окр(ТекПартия.КоличествоЗатрата, 3) > 0
		 И ТекПартия.СуммаЗатрата > 1
		 И МассивСтрок.Количество() = 0 Тогда
			ПараметрыУзлаПартии = СтруктураСебестоимости.ПараметрыУзлаДереваСебестоимости();
			
			НовыйПуть = ПройденныйПуть.Добавить();
			НовыйПуть.Партия = ТекПартия.ПартияЗатрата;
			НовыйПуть.АналитикаУчетаПартий = ТекПартия.АналитикаУчетаПартийЗатрата;
			
			Отборы = ПараметрыУзлаПартии.Отборы;
			Отборы.ДанныеПоСебестоимости = ПараметрыУзла.Отборы.ДанныеПоСебестоимости;
			Отборы.Продукция.Добавить(ТекПартия.Затрата);
			Отборы.ХарактеристикиПродукции.Добавить(ТекПартия.ХарактеристикаЗатрата);
			Отборы.СерииПродукции.Добавить(ТекПартия.СерияЗатрата);
			Отборы.ПартииПродукции.Добавить(ТекПартия.ПартияЗатрата);
			Отборы.АналитикиУчетаПартийПродукции.Добавить(ТекПартия.АналитикаУчетаПартийЗатрата);
			Отборы.Числитель = ТекПартия.КоличествоЗатрата;
			
			Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
				ТаблицаРезультатаПартии = СтрокаПартия;
			Иначе
				ТаблицаРезультатаПартии = Результат;
			КонецЕсли;
			
			ОписаниеПродукции.Вставить("Уровень", УровеньУзла);
			РазузловатьУзелДереваСебестоимости(ПараметрыДерева, ПараметрыУзлаПартии, ТаблицаРезультатаПартии, ОписаниеПродукции);
		КонецЕсли;
		
		// Удалим строку, по которой уже выполнено разозлование.
		Если ТекПартия.ТребуетсяРазузлование
		 И Окр(ТекПартия.КоличествоЗатрата, 3) > 0
		 И ТекПартия.СуммаЗатрата > 1 Тогда
			ПараметрыОтбора = Новый Структура("Партия, АналитикаУчетаПартий",
				ТекПартия.ПартияЗатрата,
				ТекПартия.АналитикаУчетаПартийЗатрата);
			МассивСтрок = ПройденныйПуть.НайтиСтроки(ПараметрыОтбора);
			Для Каждого СтрокаКУдалению Из МассивСтрок Цикл
				ПройденныйПуть.Удалить(СтрокаКУдалению);
			КонецЦикла;
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Функция СебестоимостьУзла(ПараметрыДерева, ПараметрыУзла)
	
	Запрос = ЗапросВыпущеннаяПродукция(ПараметрыУзла, Истина);
	Запрос.Текст = Запрос.Текст
					+ ТекстЗапросаЗатратыНаПродукцию();
	Результат = Запрос.Выполнить();
	
	Возврат Результат.Выгрузить();
	
КонецФункции

Функция ТекстЗапросаЗатратыНаПродукцию()
	
	ТекстыЗапроса = Новый Массив;
	
	
#Область ТекстМатериальныеЗатраты
	ТекстМатериальныеЗатраты =
		"ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ) КАК Период,
		|	ВыпущеннаяПродукция.Организация КАК Организация,
		|	ВыпущеннаяПродукция.ПартияПродукции КАК ПартияПродукции,
		|	ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции КАК АналитикаУчетаПартийПродукции,
		|	ВыпущеннаяПродукция.АналитикаУчетаПродукции КАК АналитикаУчетаПродукции,
		|	МАКСИМУМ(ВыпущеннаяПродукция.Числитель) КАК Числитель,
		|	МАКСИМУМ(ВыпущеннаяПродукция.Знаменатель) КАК Знаменатель,
		|	СебестоимостьТоваров.Партия КАК Партия,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	СУММА(СебестоимостьТоваров.Количество) КАК Количество,
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл
		|ПОМЕСТИТЬ ВыбытиеИзНЗППоПродукции
		|ИЗ
		|	ВыпущеннаяПродукция КАК ВыпущеннаяПродукция
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ПО ВыпущеннаяПродукция.ПартияПродукции = СебестоимостьТоваров.Регистратор
		|			И ВыпущеннаяПродукция.АналитикаУчетаПродукции = СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры
		|			И ВыпущеннаяПродукция.ПартияПродукции = СебестоимостьТоваров.КорПартия
		|			И ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции = СебестоимостьТоваров.КорАналитикаУчетаПартий
		|ГДЕ
		|	СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И ТИПЗНАЧЕНИЯ(СебестоимостьТоваров.Партия) = ТИП(Справочник.ПартииПроизводства)
		|	И НЕ СебестоимостьТоваров.Партия = ЗНАЧЕНИЕ(Справочник.ПартииПроизводства.ПустаяСсылка)
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	ВыпущеннаяПродукция.Организация,
		|	ВыпущеннаяПродукция.ПартияПродукции,
		|	ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции,
		|	ВыпущеннаяПродукция.АналитикаУчетаПродукции,
		|	СебестоимостьТоваров.Партия,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры
		|;
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	МАКСИМУМ(Т.Период) КАК Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|ПОМЕСТИТЬ ВыбывшиеЗатратыСводно
		|ИЗ
		|	ВыбытиеИзНЗППоПродукции КАК Т
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.Партия
		|ПОМЕСТИТЬ ПартииПроизводства
		|ИЗ
		|	ВыбывшиеЗатратыСводно КАК Т
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(Т.Период, МЕСЯЦ) КАК Период,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.Партия КАК Партия,
		|	СУММА(Т.КоличествоРасход) КАК Количество
		|ПОМЕСТИТЬ ВыбытиеИзНЗП
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров.Обороты(
		|			,
		|			,
		|			МЕСЯЦ,
		|			Партия В
		|				(ВЫБРАТЬ
		|					Т.Партия
		|				ИЗ
		|					ПартииПроизводства КАК Т)) КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|	    ПО Т.АналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|			И Т.Партия = Выбытие.Партия
		|			
		|ГДЕ
		|	Т.АналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|	И Т.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(Т.Период, МЕСЯЦ),
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ) КАК Период,
		// Аналитика первичной партии.
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры 	КАК АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий 			КАК АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Партия 						КАК Партия,
		// Аналитка в НЗП.
		|	СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры 	КАК КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.КорПартия						КАК КорПартия,
		
		|	СУММА(СебестоимостьТоваров.Количество) 				КАК Количество,
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл
		|ПОМЕСТИТЬ ПервичныеПартииВНЗП
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводства КАК ПП
		|		ПО СебестоимостьТоваров.КорПартия = ПП.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|		ПО СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|			И СебестоимостьТоваров.КорПартия = Выбытие.Партия
		|			И СебестоимостьТоваров.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|ГДЕ
		|	СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
		|	И НЕ Выбытие.АналитикаУчетаНоменклатуры ЕСТЬ NULL
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Партия,
		|	СебестоимостьТоваров.КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.КорПартия
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Фикс. стоимость
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор,
		
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия,
		
		|	СУММА(СебестоимостьТоваров.Количество),
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводства КАК ПП
		|		ПО СебестоимостьТоваров.Партия = ПП.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|		ПО СебестоимостьТоваров.АналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|			И СебестоимостьТоваров.Партия = Выбытие.Партия
		|			И СебестоимостьТоваров.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|ГДЕ
		|	СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииФиксированнаяСтоимость)
		|	И СебестоимостьТоваров.Количество < 0
		|	И НЕ Выбытие.АналитикаУчетаНоменклатуры ЕСТЬ NULL
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		// Начальные остатки
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор,
		
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия,
		
		|	СУММА(СебестоимостьТоваров.Количество),
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПартииПроизводства КАК ПП
		|		ПО СебестоимостьТоваров.Партия = ПП.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбывшиеЗатратыСводно КАК Выбытие
		|		ПО СебестоимостьТоваров.АналитикаУчетаНоменклатуры = Выбытие.АналитикаУчетаНоменклатуры
		|			И СебестоимостьТоваров.Партия = Выбытие.Партия
		|			И СебестоимостьТоваров.Период <= КОНЕЦПЕРИОДА(Выбытие.Период, МЕСЯЦ)
		|ГДЕ
		|	СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВводОстатковЗатратПартийПроизводства)
		|	И НЕ Выбытие.АналитикаУчетаНоменклатуры ЕСТЬ NULL
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.ПартияПродукции
		|ПОМЕСТИТЬ ОтчетыПереработчика
		|ИЗ
		|	ВыпущеннаяПродукция КАК Т
		|ГДЕ
		|	ТИПЗНАЧЕНИЯ(Т.ПартияПродукции) = ТИП(Документ.ОтчетПереработчика)
		|;
		|
		|ВЫБРАТЬ
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ) КАК Период,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор Партия,
		
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия КАК КорПартия,
		
		|	СУММА(СебестоимостьТоваров.Количество),
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|		КОНЕЦ)												КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.Трудозатраты
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ТрудозатратыРегл
		|		КОНЕЦ)												КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|		КОНЕЦ)												КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансовая
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ)												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА &ДанныеПоСебестоимости = 1
		|				ТОГДА СебестоимостьТоваров.Стоимость
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеСНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеСНДС
		|				+ СебестоимостьТоваров.ДопРасходы
		|			КОГДА &ДанныеПоСебестоимости = 2
		|				ТОГДА СебестоимостьТоваров.СтоимостьБезНДС
		|				+ СебестоимостьТоваров.Трудозатраты
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеБезНДС
		|				+ СебестоимостьТоваров.ДопРасходыБезНДС
		|			КОГДА &ДанныеПоСебестоимости = 3
		|				ТОГДА СебестоимостьТоваров.СтоимостьРегл
		|				+ СебестоимостьТоваров.ТрудозатратыРегл
		|				+ СебестоимостьТоваров.ПостатейныеПостоянныеРегл
		|				+ СебестоимостьТоваров.ПостатейныеПеременныеРегл
		|				+ СебестоимостьТоваров.ДопРасходыРегл
		|		КОНЕЦ)												КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	СУММА(СебестоимостьТоваров.Стоимость)					КАК МатериальныеСНДС,
		|	СУММА(СебестоимостьТоваров.Трудозатраты)				КАК ТрудозатратыСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеСНДС)	КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеСНДС)	КАК ПостатейныеПеременныеСНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходы)					КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	СУММА(СебестоимостьТоваров.СтоимостьБезНДС)				КАК МатериальныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеБезНДС)	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеБезНДС)	КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(СебестоимостьТоваров.ДопРасходыБезНДС)			КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	СУММА(СебестоимостьТоваров.СтоимостьРегл)				КАК МатериальныеРегл,
		|	СУММА(СебестоимостьТоваров.ТрудозатратыРегл)			КАК ТрудозатратыРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПостоянныеРегл)	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(СебестоимостьТоваров.ПостатейныеПеременныеРегл)	КАК ПостатейныеПеременныеРегл,
		|	СУММА(СебестоимостьТоваров.ДопРасходыРегл)				КАК ДопРасходыРегл,
		|	СУММА(СебестоимостьТоваров.СтоимостьЗабалансоваяРегл)	КАК СтоимостьЗабалансоваяРегл
		|ПОМЕСТИТЬ УслугиПереработчика
		|ИЗ
		|	РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ОтчетыПереработчика КАК ОтчетыПереработчика
		|		ПО СебестоимостьТоваров.Регистратор = ОтчетыПереработчика.ПартияПродукции
		|ГДЕ
		|	СебестоимостьТоваров.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ЗакупкаУПоставщика)
		|		И СебестоимостьТоваров.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаСебестоимостиТоваров.НезавершенноеПроизводство)
		|
		|СГРУППИРОВАТЬ ПО
		|	НАЧАЛОПЕРИОДА(СебестоимостьТоваров.Период, МЕСЯЦ),
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.АналитикаУчетаПартий,
		|	СебестоимостьТоваров.Регистратор,
		|	СебестоимостьТоваров.АналитикаУчетаНоменклатуры,
		|	СебестоимостьТоваров.Партия
		|;
		|
		|ВЫБРАТЬ
		|	Т.Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия,
		|	СУММА(Партии.Количество) КАК Количество
		|ПОМЕСТИТЬ ПриходыНарастающимИтогом
		|ИЗ
		|	ВыбытиеИзНЗП КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеПартииВНЗП КАК Партии
		|		ПО Т.АналитикаУчетаНоменклатуры = Партии.КорАналитикаУчетаНоменклатуры
		|			И Т.Партия = Партии.КорПартия
		|			И Т.Период >= Партии.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период КАК Период,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.Партия КАК Партия,
		|	СУММА(НарастающийИтог.Количество) КАК Количество
		|ПОМЕСТИТЬ РасходыНарастающимИтогом
		|ИЗ
		|	ВыбытиеИзНЗП КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбытиеИзНЗП КАК НарастающийИтог
		|		ПО Т.АналитикаУчетаНоменклатуры = НарастающийИтог.АналитикаУчетаНоменклатуры
		|			И Т.Партия = НарастающийИтог.Партия
		|			И Т.Период >= НарастающийИтог.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Расходы.Период КАК Период,
		|	Расходы.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Расходы.Партия КАК Партия
		|ПОМЕСТИТЬ НулевыеПериоды
		|ИЗ
		|	РасходыНарастающимИтогом КАК Расходы
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПриходыНарастающимИтогом КАК Приходы
		|		ПО Расходы.АналитикаУчетаНоменклатуры = Приходы.АналитикаУчетаНоменклатуры
		|			И Расходы.Партия = Приходы.Партия
		|			И Расходы.Период = Приходы.Период
		|ГДЕ
		|	Расходы.Количество - ЕСТЬNULL(Приходы.Количество, 0) = 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период КАК КонецПериода,
		|	МАКСИМУМ(ЕСТЬNULL(ДОБАВИТЬКДАТЕ(НулевыеПериоды.Период, МЕСЯЦ, 1), ДАТАВРЕМЯ(1, 1, 1))) КАК НачалоПериода,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.Партия КАК Партия
		|ПОМЕСТИТЬ ИнтервалыРасходаПартий
		|ИЗ
		|	НулевыеПериоды КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ НулевыеПериоды КАК НулевыеПериоды
		|		ПО Т.АналитикаУчетаНоменклатуры = НулевыеПериоды.АналитикаУчетаНоменклатуры
		|			И Т.Партия = НулевыеПериоды.Партия
		|			И Т.Период > НулевыеПериоды.Период
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Выбытие.Период,
		|	ПП.АналитикаУчетаНоменклатуры,
		|	ПП.АналитикаУчетаПартий,
		|	ПП.Партия,
		|	Выбытие.АналитикаУчетаНоменклатуры 	КАК КорАналитикаУчетаНоменклатуры,
		|	Выбытие.Партия 						КАК КорПартия,
		
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|			Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.Количество) КАК Количество,
		|	МАКСИМУМ(Выбытие.Количество = Поступило.Количество - ЕСТЬNULL(Выбыло.Количество, 0) + Выбытие.Количество) КАК СписатьОстаток,
		
		// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.Материальные) КАК Материальные,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.Трудозатраты) КАК Трудозатраты,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянные) КАК ПостатейныеПостоянные,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременные) КАК ПостатейныеПеременные,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходы) КАК ДопРасходы,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.СуммаЗатратаЗабалансовая) КАК СуммаЗатратаЗабалансовая,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.СуммаЗатрата) КАК СуммаЗатрата,
		
		// Стоимости с НДС
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.МатериальныеСНДС) КАК МатериальныеСНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ТрудозатратыСНДС) КАК ТрудозатратыСНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходыСНДС) КАК ДопРасходыСНДС,
		
		// Стоимости без НДС
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.МатериальныеБезНДС) КАК МатериальныеБезНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		
		// Стоимости Регл
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.МатериальныеРегл) КАК МатериальныеРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(
		|		ВЫРАЗИТЬ(Выбытие.Количество /
		|		Поступило.Количество КАК ЧИСЛО(23, 10))
		|			* ПП.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл
		|ПОМЕСТИТЬ ПредварительныйРасходПартий
		|ИЗ
		|	ВыбытиеИзНЗП КАК Выбытие
		|		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасходаПартий КАК Интервалы
		|		ПО Выбытие.АналитикаУчетаНоменклатуры = Интервалы.АналитикаУчетаНоменклатуры
		|			И Выбытие.Партия = Интервалы.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеПартииВНЗП КАК ПП
		|		ПО Выбытие.АналитикаУчетаНоменклатуры = ПП.КорАналитикаУчетаНоменклатуры
		|			И Выбытие.Партия = ПП.КорПартия
		|			И Выбытие.Период >= ПП.Период
		|			И (ПП.Период >= ЕСТЬNULL(Интервалы.НачалоПериода, ДАТАВРЕМЯ(1,1,1)))
		|		ЛЕВОЕ СОЕДИНЕНИЕ РасходыНарастающимИтогом КАК Выбыло
		|		ПО Выбытие.АналитикаУчетаНоменклатуры = Выбыло.АналитикаУчетаНоменклатуры
		|			И Выбытие.Партия = Выбыло.Партия
		|			И Выбытие.Период = Выбыло.Период
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПриходыНарастающимИтогом КАК Поступило
		|		ПО Выбытие.АналитикаУчетаНоменклатуры = Поступило.АналитикаУчетаНоменклатуры
		|			И Выбытие.Партия = Поступило.Партия
		|			И Выбытие.Период = Поступило.Период
		|ГДЕ
		|	(Интервалы.НачалоПериода ЕСТЬ NULL
		|		ИЛИ Выбытие.Период МЕЖДУ Интервалы.НачалоПериода И Интервалы.КонецПериода)
		|
		|СГРУППИРОВАТЬ ПО
		|	Выбытие.Период,
		|	Выбытие.АналитикаУчетаНоменклатуры,
		|	Выбытие.Партия,
		|	ПП.АналитикаУчетаНоменклатуры,
		|	ПП.АналитикаУчетаПартий,
		|	ПП.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период КАК Период,
		|	Т.КорАналитикаУчетаНоменклатуры КАК КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия КАК КорПартия,
		|	Т.АналитикаУчетаНоменклатуры КАК АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий КАК АналитикаУчетаПартий,
		|	Т.Партия КАК Партия,
		|	СУММА(Партии.Количество) КАК Количество,
		// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(Партии.Материальные) КАК Материальные,
		|	СУММА(Партии.Трудозатраты) КАК Трудозатраты,
		|	СУММА(Партии.ПостатейныеПостоянные) КАК ПостатейныеПостоянные,
		|	СУММА(Партии.ПостатейныеПеременные) КАК ПостатейныеПеременные,
		|	СУММА(Партии.ДопРасходы) КАК ДопРасходы,
		|	СУММА(Партии.СуммаЗатратаЗабалансовая) КАК СуммаЗатратаЗабалансовая,
		|	СУММА(Партии.СуммаЗатрата) КАК СуммаЗатрата,
		|
		// Стоимости с НДС
		|	СУММА(Партии.МатериальныеСНДС) КАК МатериальныеСНДС,
		|	СУММА(Партии.ТрудозатратыСНДС) КАК ТрудозатратыСНДС,
		|	СУММА(Партии.ПостатейныеПостоянныеСНДС) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(Партии.ПостатейныеПеременныеСНДС) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(Партии.ДопРасходыСНДС) КАК ДопРасходыСНДС,
		|
		// Стоимости без НДС
		|	СУММА(Партии.МатериальныеБезНДС) КАК МатериальныеБезНДС,
		|	СУММА(Партии.ПостатейныеПостоянныеБезНДС) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(Партии.ПостатейныеПеременныеБезНДС) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(Партии.ДопРасходыБезНДС) КАК ДопРасходыБезНДС,
		|
		// Стоимости Регл
		|	СУММА(Партии.МатериальныеРегл) КАК МатериальныеРегл,
		|	СУММА(Партии.ТрудозатратыРегл) КАК ТрудозатратыРегл,
		|	СУММА(Партии.ПостатейныеПостоянныеРегл) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(Партии.ПостатейныеПеременныеРегл) КАК ПостатейныеПеременныеРегл,
		|	СУММА(Партии.ДопРасходыРегл) КАК ДопРасходыРегл,
		|	СУММА(Партии.СтоимостьЗабалансоваяРегл) КАК СтоимостьЗабалансоваяРегл
		|ПОМЕСТИТЬ ПартииСводно
		|ИЗ
		|	ПредварительныйРасходПартий КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасходаПартий КАК Интервалы
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Интервалы.АналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Интервалы.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеПартииВНЗП КАК Партии
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Партии.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Партии.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Партии.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Партии.АналитикаУчетаПартий
		|			И Т.Партия = Партии.Партия
		|			И Т.Период >= Партии.Период
		|			И (Партии.Период >= ЕСТЬNULL(Интервалы.НачалоПериода, ДАТАВРЕМЯ(1,1,1)))
		|ГДЕ
		|	Интервалы.НачалоПериода ЕСТЬ NULL
		|		ИЛИ Т.Период МЕЖДУ Интервалы.НачалоПериода И Интервалы.КонецПериода
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период КАК Период,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия КАК Партия,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.Количество
		|		КОНЕЦ) КАК Количество,
		// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.Материальные
		|		КОНЕЦ) КАК Материальные,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.Трудозатраты
		|		КОНЕЦ) КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянные
		|		КОНЕЦ) КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременные
		|		КОНЕЦ) КАК ПостатейныеПеременные,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходы
		|		КОНЕЦ) КАК ДопРасходы,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.СуммаЗатратаЗабалансовая
		|		КОНЕЦ) КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.СуммаЗатрата
		|		КОНЕЦ) КАК СуммаЗатрата,
		|
		// Стоимости с НДС
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.МатериальныеСНДС
		|		КОНЕЦ) КАК МатериальныеСНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ТрудозатратыСНДС
		|		КОНЕЦ) КАК ТрудозатратыСНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянныеСНДС
		|		КОНЕЦ) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременныеСНДС
		|		КОНЕЦ) КАК ПостатейныеПеременныеСНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходыСНДС
		|		КОНЕЦ) КАК ДопРасходыСНДС,
		// Стоимости без НДС
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.МатериальныеБезНДС
		|		КОНЕЦ) КАК МатериальныеБезНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянныеБезНДС
		|		КОНЕЦ) КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременныеБезНДС
		|		КОНЕЦ) КАК ПостатейныеПеременныеБезНДС,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходыБезНДС
		|		КОНЕЦ) КАК ДопРасходыБезНДС,
		// Стоимости Регл
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.МатериальныеРегл
		|		КОНЕЦ) КАК МатериальныеРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ТрудозатратыРегл
		|		КОНЕЦ) КАК ТрудозатратыРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПостоянныеРегл
		|		КОНЕЦ) КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ПостатейныеПеременныеРегл
		|		КОНЕЦ) КАК ПостатейныеПеременныеРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.ДопРасходыРегл
		|		КОНЕЦ) КАК ДопРасходыРегл,
		|	СУММА(ВЫБОР
		|			КОГДА Расход.СписатьОстаток
		|				ТОГДА 0
		|			ИНАЧЕ Расход.СтоимостьЗабалансоваяРегл
		|		КОНЕЦ) КАК СтоимостьЗабалансоваяРегл
		|ПОМЕСТИТЬ РасходПартийСводно
		|ИЗ
		|	ПредварительныйРасходПартий КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ ИнтервалыРасходаПартий КАК Интервалы
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Интервалы.АналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Интервалы.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПредварительныйРасходПартий КАК Расход
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Расход.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Расход.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Расход.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Расход.АналитикаУчетаПартий
		|			И Т.Партия = Расход.Партия
		|			И Т.Период >= Расход.Период
		|			И (Расход.Период >= ЕСТЬNULL(Интервалы.НачалоПериода, ДАТАВРЕМЯ(1,1,1)))
		|ГДЕ
		|	Т.Период МЕЖДУ Интервалы.НачалоПериода И Интервалы.КонецПериода
		|		ИЛИ Интервалы.НачалоПериода ЕСТЬ NULL
		|
		|СГРУППИРОВАТЬ ПО
		|	Т.Период,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Т.Период КАК Период,
		|	Т.КорАналитикаУчетаНоменклатуры,
		|	Т.КорПартия КАК КорПартия,
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия КАК Партия,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.Количество - Расход.Количество
		|		ИНАЧЕ Т.Количество
		|	КОНЕЦ КАК Количество,
		// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.Материальные - Расход.Материальные
		|		ИНАЧЕ Т.Материальные
		|	КОНЕЦ КАК Материальные,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.Трудозатраты - Расход.Трудозатраты
		|		ИНАЧЕ Т.Трудозатраты
		|	КОНЕЦ КАК Трудозатраты,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянные - Расход.ПостатейныеПостоянные
		|		ИНАЧЕ Т.ПостатейныеПостоянные
		|	КОНЕЦ КАК ПостатейныеПостоянные,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременные - Расход.ПостатейныеПеременные
		|		ИНАЧЕ Т.ПостатейныеПеременные
		|	КОНЕЦ КАК ПостатейныеПеременные,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходы - Расход.ДопРасходы
		|		ИНАЧЕ Т.ДопРасходы
		|	КОНЕЦ КАК ДопРасходы,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.СуммаЗатратаЗабалансовая - Расход.СуммаЗатратаЗабалансовая
		|		ИНАЧЕ Т.СуммаЗатратаЗабалансовая
		|	КОНЕЦ КАК СуммаЗатратаЗабалансовая,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.СуммаЗатрата - Расход.СуммаЗатрата
		|		ИНАЧЕ Т.СуммаЗатрата
		|	КОНЕЦ КАК СуммаЗатрата,
		|
		// Стоимости с НДС
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.МатериальныеСНДС - Расход.МатериальныеСНДС
		|		ИНАЧЕ Т.МатериальныеСНДС
		|	КОНЕЦ КАК МатериальныеСНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ТрудозатратыСНДС - Расход.ТрудозатратыСНДС
		|		ИНАЧЕ Т.ТрудозатратыСНДС
		|	КОНЕЦ КАК ТрудозатратыСНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянныеСНДС - Расход.ПостатейныеПостоянныеСНДС
		|		ИНАЧЕ Т.ПостатейныеПостоянныеСНДС
		|	КОНЕЦ КАК ПостатейныеПостоянныеСНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременныеСНДС - Расход.ПостатейныеПеременныеСНДС
		|		ИНАЧЕ Т.ПостатейныеПеременныеСНДС
		|	КОНЕЦ КАК ПостатейныеПеременныеСНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходыСНДС - Расход.ДопРасходыСНДС
		|		ИНАЧЕ Т.ДопРасходыСНДС
		|	КОНЕЦ КАК ДопРасходыСНДС,
		|
		// Стоимости без НДС
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.МатериальныеБезНДС - Расход.МатериальныеБезНДС
		|		ИНАЧЕ Т.МатериальныеБезНДС
		|	КОНЕЦ КАК МатериальныеБезНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянныеБезНДС - Расход.ПостатейныеПостоянныеБезНДС
		|		ИНАЧЕ Т.ПостатейныеПостоянныеБезНДС
		|	КОНЕЦ КАК ПостатейныеПостоянныеБезНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременныеБезНДС - Расход.ПостатейныеПеременныеБезНДС
		|		ИНАЧЕ Т.ПостатейныеПеременныеБезНДС
		|	КОНЕЦ КАК ПостатейныеПеременныеБезНДС,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходыБезНДС - Расход.ДопРасходыБезНДС
		|		ИНАЧЕ Т.ДопРасходыБезНДС
		|	КОНЕЦ КАК ДопРасходыБезНДС,
		|
		// Стоимости Регл
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.МатериальныеРегл - Расход.МатериальныеРегл
		|		ИНАЧЕ Т.МатериальныеРегл
		|	КОНЕЦ КАК МатериальныеРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ТрудозатратыРегл - Расход.ТрудозатратыРегл
		|		ИНАЧЕ Т.ТрудозатратыРегл
		|	КОНЕЦ КАК ТрудозатратыРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПостоянныеРегл - Расход.ПостатейныеПостоянныеРегл
		|		ИНАЧЕ Т.ПостатейныеПостоянныеРегл
		|	КОНЕЦ КАК ПостатейныеПостоянныеРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ПостатейныеПеременныеРегл - Расход.ПостатейныеПеременныеРегл
		|		ИНАЧЕ Т.ПостатейныеПеременныеРегл
		|	КОНЕЦ КАК ПостатейныеПеременныеРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.ДопРасходыРегл - Расход.ДопРасходыРегл
		|		ИНАЧЕ Т.ДопРасходыРегл
		|	КОНЕЦ КАК ДопРасходыРегл,
		|	ВЫБОР
		|		КОГДА Т.СписатьОстаток
		|			ТОГДА Приход.СтоимостьЗабалансоваяРегл - Расход.СтоимостьЗабалансоваяРегл
		|		ИНАЧЕ Т.СтоимостьЗабалансоваяРегл
		|	КОНЕЦ КАК СтоимостьЗабалансоваяРегл
		|ПОМЕСТИТЬ ПервичныеЗатратыПоПериодам
		|ИЗ
		|	ПредварительныйРасходПартий КАК Т
		|		ЛЕВОЕ СОЕДИНЕНИЕ РасходПартийСводно КАК Расход
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Расход.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Расход.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Расход.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Расход.АналитикаУчетаПартий
		|			И Т.Партия = Расход.Партия
		|			И Т.Период = Расход.Период
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПартииСводно КАК Приход
		|		ПО Т.КорАналитикаУчетаНоменклатуры = Приход.КорАналитикаУчетаНоменклатуры
		|			И Т.КорПартия = Приход.КорПартия
		|			И Т.АналитикаУчетаНоменклатуры = Приход.АналитикаУчетаНоменклатуры
		|			И Т.АналитикаУчетаПартий = Приход.АналитикаУчетаПартий
		|			И Т.Партия = Приход.Партия
		|			И Т.Период = Приход.Период
		|;
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	Т.АналитикаУчетаНоменклатуры,
		|	Т.АналитикаУчетаПартий,
		|	Т.Партия
		|ПОМЕСТИТЬ ПервичныеПартииСводно
		|ИЗ
		|	ПервичныеЗатратыПоПериодам КАК Т
		|;
		|
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПП.Партия,
		|	ПП.АналитикаУчетаПартий,
		|	ПП.АналитикаУчетаНоменклатуры
		|ПОМЕСТИТЬ ПартииПолуфабрикатов
		|ИЗ
		|	ПервичныеПартииСводно КАК ПП
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.СебестоимостьТоваров КАК СебестоимостьТоваров
		|		ПО СебестоимостьТоваров.Регистратор = ПП.Партия
		|		И СебестоимостьТоваров.АналитикаУчетаПартий = ПП.АналитикаУчетаПартий
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаПартий КАК АналитикиУчетаПартий
		|		ПО СебестоимостьТоваров.АналитикаУчетаПартий = АналитикиУчетаПартий.КлючАналитики
		|
		|ГДЕ
		|	СебестоимостьТоваров.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
		|	И СебестоимостьТоваров.ХозяйственнаяОперация В (ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукции),
		|													ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииНаСклад),
		|													ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыпускПродукцииВПодразделение))
		|	И НЕ АналитикиУчетаПартий.КодСтроки = 0
		|;
		|";	
#КонецОбласти

#Область ТекстМатериальныеЗатратыОбъединение

	ТекстМатериальныеЗатратыОбъединение =
		"ВЫБРАТЬ
		|	НЗППоПродукции.Организация							КАК Организация,
		|	НЗППоПродукции.ПартияПродукции						КАК ПартияВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПартийПродукции		КАК АналитикаУчетаПартийВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПродукции				КАК АналитикаУчетаВыходноеИзделие,
		|	ПартииМатериалов.Партия								КАК ПартияЗатрата,
		|	ПартииМатериалов.АналитикаУчетаПартий				КАК АналитикаУчетаПартийЗатрата,
		|	ПартииМатериалов.АналитикаУчетаНоменклатуры			КАК АналитикаУчетаЗатрата,
		|	АналитикаЗатрат.Номенклатура						КАК Затрата,
		|	АналитикаЗатрат.Номенклатура.ЕдиницаИзмерения 		КАК ЕдиницаИзмеренияЗатрата,
		|	АналитикаЗатрат.Характеристика						КАК ХарактеристикаЗатрата,
		|	АналитикаЗатрат.Серия								КАК СерияЗатрата,
		|	АналитикаЗатрат.Назначение							КАК НазначениеЗатрата,
		|	АналитикаЗатрат.СтатьяКалькуляции					КАК СтатьяКалькуляции,
		|	АналитикаЗатрат.МестоХранения                       КАК Подразделение,
		|	ПартииПолуфабрикатов.Партия ЕСТЬ НЕ NULL			КАК ТребуетсяРазузлование,
		|	""Материальные""									КАК ТипЗатрат,
		|	ПартииМатериалов.Количество
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	ПартииМатериалов.Материальные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Материальные,
		|	ПартииМатериалов.Трудозатраты
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Трудозатраты,
		|	ПартииМатериалов.ПостатейныеПостоянные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянные,
		|	ПартииМатериалов.ПостатейныеПеременные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременные,
		|	ПартииМатериалов.ДопРасходы
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходы,
		|	ПартииМатериалов.СуммаЗатратаЗабалансовая
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатратаЗабалансовая,
		|	ПартииМатериалов.СуммаЗатрата
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	ПартииМатериалов.МатериальныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеСНДС,
		|	ПартииМатериалов.ТрудозатратыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыСНДС,
		|	ПартииМатериалов.ПостатейныеПостоянныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеСНДС,
		|	ПартииМатериалов.ПостатейныеПеременныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеСНДС,
		|	ПартииМатериалов.ДопРасходыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	ПартииМатериалов.МатериальныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеБезНДС,
		|	ПартииМатериалов.ПостатейныеПостоянныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеБезНДС,
		|	ПартииМатериалов.ПостатейныеПеременныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеБезНДС,
		|	ПартииМатериалов.ДопРасходыБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	ПартииМатериалов.МатериальныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеРегл,
		|	ПартииМатериалов.ТрудозатратыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыРегл,
		|	ПартииМатериалов.ПостатейныеПостоянныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеРегл,
		|	ПартииМатериалов.ПостатейныеПеременныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеРегл,
		|	ПартииМатериалов.ДопРасходыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыРегл,
		|	ПартииМатериалов.СтоимостьЗабалансоваяРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / ВыбытиеСводно.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СтоимостьЗабалансоваяРегл
		|ИЗ
		|	ВыбытиеИзНЗППоПродукции КАК НЗППоПродукции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ПервичныеЗатратыПоПериодам КАК ПартииМатериалов
		|	    ПО НЗППоПродукции.Период = ПартииМатериалов.Период
		|			И НЗППоПродукции.АналитикаУчетаНоменклатуры = ПартииМатериалов.КорАналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = ПартииМатериалов.КорПартия
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаЗатрат
		|		ПО НЗППоПродукции.АналитикаУчетаНоменклатуры = АналитикаЗатрат.КлючАналитики
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВыбытиеИзНЗП КАК ВыбытиеСводно
		|		ПО НЗППоПродукции.Период = ВыбытиеСводно.Период
		|			И НЗППоПродукции.АналитикаУчетаНоменклатуры = ВыбытиеСводно.АналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = ВыбытиеСводно.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПартииПолуфабрикатов КАК ПартииПолуфабрикатов
		|		ПО ПартииМатериалов.Партия = ПартииПолуфабрикатов.Партия
		|			И ПартииМатериалов.АналитикаУчетаПартий = ПартииПолуфабрикатов.АналитикаУчетаПартий
		|			И ПартииМатериалов.АналитикаУчетаНоменклатуры = ПартииПолуфабрикатов.АналитикаУчетаНоменклатуры
		|			И (НЕ НЗППоПродукции.ПартияПродукции = ПартииПолуфабрикатов.Партия
		|				ИЛИ НЕ НЗППоПродукции.АналитикаУчетаПартийПродукции = ПартииПолуфабрикатов.АналитикаУчетаПартий
		|				ИЛИ НЕ НЗППоПродукции.АналитикаУчетаПродукции = ПартииПолуфабрикатов.АналитикаУчетаНоменклатуры)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	НЗППоПродукции.Организация							КАК Организация,
		|	НЗППоПродукции.ПартияПродукции						КАК ПартияВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПартийПродукции		КАК АналитикаУчетаПартийВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПродукции				КАК АналитикаУчетаВыходноеИзделие,
		|	УслугиПереработчика.Партия							КАК ПартияЗатрата,
		|	УслугиПереработчика.АналитикаУчетаПартий			КАК АналитикаУчетаПартийЗатрата,
		|	УслугиПереработчика.АналитикаУчетаНоменклатуры		КАК АналитикаУчетаЗатрата,
		|	АналитикаЗатрат.Номенклатура						КАК Затрата,
		|	АналитикаЗатрат.Номенклатура.ЕдиницаИзмерения 		КАК ЕдиницаИзмеренияЗатрата,
		|	АналитикаЗатрат.Характеристика						КАК ХарактеристикаЗатрата,
		|	АналитикаЗатрат.Серия								КАК СерияЗатрата,
		|	АналитикаЗатрат.Назначение							КАК НазначениеЗатрата,
		|	АналитикаЗатрат.СтатьяКалькуляции					КАК СтатьяКалькуляции,
		|	АналитикаЗатрат.МестоХранения                       КАК Подразделение,
		|	ЛОЖЬ												КАК ТребуетсяРазузлование,
		|	""Материальные""									КАК ТипЗатрат,
		|	НЗППоПродукции.Количество
		|	* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	УслугиПереработчика.Материальные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Материальные,
		|	УслугиПереработчика.Трудозатраты
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Трудозатраты,
		|	УслугиПереработчика.ПостатейныеПостоянные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянные,
		|	УслугиПереработчика.ПостатейныеПеременные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременные,
		|	УслугиПереработчика.ДопРасходы
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходы,
		|	УслугиПереработчика.СуммаЗатратаЗабалансовая
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатратаЗабалансовая,
		|	УслугиПереработчика.СуммаЗатрата
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	УслугиПереработчика.МатериальныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеСНДС,
		|	УслугиПереработчика.ТрудозатратыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыСНДС,
		|	УслугиПереработчика.ПостатейныеПостоянныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеСНДС,
		|	УслугиПереработчика.ПостатейныеПеременныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеСНДС,
		|	УслугиПереработчика.ДопРасходыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	УслугиПереработчика.МатериальныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеБезНДС,
		|	УслугиПереработчика.ПостатейныеПостоянныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеБезНДС,
		|	УслугиПереработчика.ПостатейныеПеременныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеБезНДС,
		|	УслугиПереработчика.ДопРасходыБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	УслугиПереработчика.МатериальныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеРегл,
		|	УслугиПереработчика.ТрудозатратыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыРегл,
		|	УслугиПереработчика.ПостатейныеПостоянныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеРегл,
		|	УслугиПереработчика.ПостатейныеПеременныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеРегл,
		|	УслугиПереработчика.ДопРасходыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыРегл,
		|	УслугиПереработчика.СтоимостьЗабалансоваяРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Количество / УслугиПереработчика.Количество КАК ЧИСЛО(31,10))
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СтоимостьЗабалансоваяРегл
		|ИЗ
		|	ВыбытиеИзНЗППоПродукции КАК НЗППоПродукции
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ УслугиПереработчика КАК УслугиПереработчика
		|	    ПО НЗППоПродукции.Период = УслугиПереработчика.Период
		|			И НЗППоПродукции.АналитикаУчетаНоменклатуры = УслугиПереработчика.КорАналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = УслугиПереработчика.КорПартия
		|			И НЗППоПродукции.ПартияПродукции = УслугиПереработчика.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаЗатрат
		|		ПО НЗППоПродукции.АналитикаУчетаНоменклатуры = АналитикаЗатрат.КлючАналитики";
	
	ТекстыЗапроса.Добавить(ТекстМатериальныеЗатратыОбъединение);
#КонецОбласти	
	
#Область ТекстМатериалыНачальныеОстаткиНЗПОбъединение
	ТекстМатериалыНачальныеОстаткиНЗПОбъединение =
		"ВЫБРАТЬ
		|	НЗППоПродукции.Организация							КАК Организация,
		|	НЗППоПродукции.ПартияПродукции						КАК ПартияВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПартийПродукции		КАК АналитикаУчетаПартийВыходноеИзделие,
		|	НЗППоПродукции.АналитикаУчетаПродукции				КАК АналитикаУчетаВыходноеИзделие,
		|	НЗППоПродукции.Партия								КАК ПартияЗатрата,
		|	НЕОПРЕДЕЛЕНО										КАК АналитикаУчетаПартийЗатрата,
		|	НЗППоПродукции.АналитикаУчетаНоменклатуры			КАК АналитикаУчетаЗатрата,
		|	АналитикаЗатрат.Номенклатура						КАК Затрата,
		|	АналитикаЗатрат.Номенклатура.ЕдиницаИзмерения 		КАК ЕдиницаИзмеренияЗатрата,
		|	АналитикаЗатрат.Характеристика						КАК ХарактеристикаЗатрата,
		|	АналитикаЗатрат.Серия								КАК СерияЗатрата,
		|	АналитикаЗатрат.Назначение							КАК НазначениеЗатрата,
		|	АналитикаЗатрат.СтатьяКалькуляции					КАК СтатьяКалькуляции,
		|	АналитикаЗатрат.МестоХранения                       КАК Подразделение,
		|	ЛОЖЬ												КАК ТребуетсяРазузлование,
		|	""Материальные""									КАК ТипЗатрат,
		|	НЗППоПродукции.Количество
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	НЗППоПродукции.Материальные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Материальные,
		|	НЗППоПродукции.Трудозатраты
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК Трудозатраты,
		|	НЗППоПродукции.ПостатейныеПостоянные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянные,
		|	НЗППоПродукции.ПостатейныеПеременные
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременные,
		|	НЗППоПродукции.ДопРасходы
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходы,
		|	НЗППоПродукции.СуммаЗатратаЗабалансовая
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатратаЗабалансовая,
		|	НЗППоПродукции.СуммаЗатрата
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	НЗППоПродукции.МатериальныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеСНДС,
		|	НЗППоПродукции.ТрудозатратыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыСНДС,
		|	НЗППоПродукции.ПостатейныеПостоянныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеСНДС,
		|	НЗППоПродукции.ПостатейныеПеременныеСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеСНДС,
		|	НЗППоПродукции.ДопРасходыСНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	НЗППоПродукции.МатериальныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеБезНДС,
		|	НЗППоПродукции.ПостатейныеПостоянныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеБезНДС,
		|	НЗППоПродукции.ПостатейныеПеременныеБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеБезНДС,
		|	НЗППоПродукции.ДопРасходыБезНДС
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	НЗППоПродукции.МатериальныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК МатериальныеРегл,
		|	НЗППоПродукции.ТрудозатратыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ТрудозатратыРегл,
		|	НЗППоПродукции.ПостатейныеПостоянныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПостоянныеРегл,
		|	НЗППоПродукции.ПостатейныеПеременныеРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ПостатейныеПеременныеРегл,
		|	НЗППоПродукции.ДопРасходыРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК ДопРасходыРегл,
		|	НЗППоПродукции.СтоимостьЗабалансоваяРегл
		|		* ВЫРАЗИТЬ(НЗППоПродукции.Числитель / НЗППоПродукции.Знаменатель КАК ЧИСЛО(31,10)) КАК СтоимостьЗабалансоваяРегл
		|ИЗ
		|	ВыбытиеИзНЗППоПродукции КАК НЗППоПродукции
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПервичныеЗатратыПоПериодам КАК ПартииМатериалов
		|	    ПО НЗППоПродукции.Период = ПартииМатериалов.Период
		|			И НЗППоПродукции.АналитикаУчетаНоменклатуры = ПартииМатериалов.КорАналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = ПартииМатериалов.КорПартия
		|		ЛЕВОЕ СОЕДИНЕНИЕ УслугиПереработчика КАК УслугиПереработчика
		|	    ПО НЗППоПродукции.Период = УслугиПереработчика.Период
		|			И НЗППоПродукции.АналитикаУчетаНоменклатуры = УслугиПереработчика.КорАналитикаУчетаНоменклатуры
		|			И НЗППоПродукции.Партия = УслугиПереработчика.КорПартия
		|			И НЗППоПродукции.ПартияПродукции = УслугиПереработчика.Партия
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АналитикаУчетаНоменклатуры КАК АналитикаЗатрат
		|		ПО НЗППоПродукции.АналитикаУчетаНоменклатуры = АналитикаЗатрат.КлючАналитики
		|ГДЕ
		|	ПартииМатериалов.Партия ЕСТЬ NULL
		|	И УслугиПереработчика.Партия ЕСТЬ NULL 
		|";
	
	ТекстыЗапроса.Добавить(ТекстМатериалыНачальныеОстаткиНЗПОбъединение);
	
#КонецОбласти
	
#Область ТекстТрудозатратыОбъединение
	ТекстТрудозатратыОбъединение =
		"ВЫБРАТЬ
		|	ТрудозатратыНЗП.Организация						КАК Организация,
		|	ТрудозатратыНЗП.Регистратор						КАК ПартияВыходноеИзделие,
		|	ТрудозатратыНЗП.КорАналитикаУчетаПартий			КАК АналитикаУчетаПартийВыходноеИзделие,
		|	ТрудозатратыНЗП.КорАналитикаУчетаПродукции		КАК АналитикаУчетаВыходноеИзделие,
		|	НЕОПРЕДЕЛЕНО									КАК ПартияЗатрата,
		|	НЕОПРЕДЕЛЕНО									КАК АналитикаУчетаПартийЗатрата,
		|	ТрудозатратыНЗП.ВидРабот						КАК АналитикаЗатрата,
		|	ТрудозатратыНЗП.ВидРабот						КАК Затрата,
		|	СпрВидыРабот.ЕдиницаИзмерения					КАК ЕдиницаИзмеренияЗатрата,
		|	НЕОПРЕДЕЛЕНО									КАК ХарактеристикаЗатрата,
		|	НЕОПРЕДЕЛЕНО									КАК СерияЗатрата,
		|	НЕОПРЕДЕЛЕНО									КАК НазначениеЗатрата,
		|	ТрудозатратыНЗП.СтатьяКалькуляции				КАК СтатьяКалькуляции,
		|	ТрудозатратыНЗП.Подразделение					КАК Подразделение,
		|	ЛОЖЬ											КАК ТребуетсяРазузлование,
		|	""Трудозатраты""								КАК ТипЗатрат,
		|	СУММА(ТрудозатратыНЗП.Количество
		|		* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	0												КАК Материальные,
		|	СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ТрудозатратыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК Трудозатраты,
		|	0												КАК ПостатейныеПостоянные,
		|	0												КАК ПостатейныеПеременные,
		|	0												КАК ДопРасходы,
		|	0												КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ТрудозатратыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ТрудозатратыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	0												КАК МатериальныеСНДС,
		|	СУММА(ТрудозатратыНЗП.Стоимость
		|	* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ТрудозатратыСНДС,
		|	0												КАК ПостатейныеПостоянныеСНДС,
		|	0												КАК ПостатейныеПеременныеСНДС,
		|	0												КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	0												КАК МатериальныеБезНДС,
		|	0												КАК ПостатейныеПостоянныеБезНДС,
		|	0												КАК ПостатейныеПеременныеБезНДС,
		|	0												КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	0												КАК МатериальныеРегл,
		|	СУММА(ТрудозатратыНЗП.СтоимостьРегл
		|	* ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ТрудозатратыРегл,
		|	0												КАК ПостатейныеПостоянныеРегл,
		|	0												КАК ПостатейныеПеременныеРегл,
		|	0												КАК ДопРасходыРегл,
		|	0												КАК СтоимостьЗабалансоваяРегл
		|ИЗ
		|	ВыпущеннаяПродукция КАК ВыпущеннаяПродукция
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ТрудозатратыНезавершенногоПроизводства КАК ТрудозатратыНЗП
		|		ПО ВыпущеннаяПродукция.ПартияПродукции = ТрудозатратыНЗП.Регистратор
		|		И ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции = ТрудозатратыНЗП.КорАналитикаУчетаПартий
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВидыРаботСотрудников КАК СпрВидыРабот
		|		ПО СпрВидыРабот.Ссылка = ТрудозатратыНЗП.ВидРабот
		|
		|СГРУППИРОВАТЬ ПО
		|	ТрудозатратыНЗП.Организация,
		|	ТрудозатратыНЗП.ВидРабот,
		|	ТрудозатратыНЗП.СтатьяКалькуляции,
		|	СпрВидыРабот.ЕдиницаИзмерения,
		|	ТрудозатратыНЗП.КорАналитикаУчетаПродукции,
		|	ТрудозатратыНЗП.Регистратор,
		|	ТрудозатратыНЗП.КорАналитикаУчетаПартий,
		|	ТрудозатратыНЗП.Подразделение
		|";
	
	ТекстыЗапроса.Добавить(ТекстТрудозатратыОбъединение);
	
#КонецОбласти
	
#Область ТекстПрочиеРасходыОбъединение
	ТекстПрочиеРасходыОбъединение =
		"ВЫБРАТЬ
		|	ПрочиеРасходыНЗП.Организация				КАК Организация,
		|	ПрочиеРасходыНЗП.Регистратор				КАК ПартияВыходноеИзделие,
		|	ПрочиеРасходыНЗП.КорАналитикаУчетаПартий	КАК АналитикаУчетаПартийВыходноеИзделие,
		|	ПрочиеРасходыНЗП.АналитикаУчетаПродукции	КАК АналитикаУчетаВыходноеИзделие,
		|	НЕОПРЕДЕЛЕНО								КАК ПартияЗатрата,
		|	НЕОПРЕДЕЛЕНО								КАК АналитикаУчетаПартийЗатрата,
		|	ПрочиеРасходыНЗП.СтатьяРасходов				КАК АналитикаЗатрата,
		|	ПрочиеРасходыНЗП.СтатьяРасходов				КАК Затрата,
		|	НЕОПРЕДЕЛЕНО								КАК ЕдиницаИзмеренияЗатрата,
		|	НЕОПРЕДЕЛЕНО								КАК ХарактеристикаЗатрата,
		|	НЕОПРЕДЕЛЕНО								КАК СерияЗатрата,
		|	НЕОПРЕДЕЛЕНО								КАК НазначениеЗатрата,
		|	ПрочиеРасходыНЗП.СтатьяКалькуляции			КАК СтатьяКалькуляции,
		|	ПрочиеРасходыНЗП.Подразделение				КАК Подразделение,
		|	ЛОЖЬ										КАК ТребуетсяРазузлование,
		|	""Постатейные""								КАК ТипЗатрат,
		|	0											КАК КоличествоЗатрата,
		|
		|// Стоимости согласно параметру ""ДанныеПоСебестоимости""
		|	0											КАК Материальные,
		|	0											КАК Трудозатраты,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ПрочиеРасходыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьБезНДС
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПостоянные,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ПрочиеРасходыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьБезНДС
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПеременные,
		|	0											КАК ДопРасходы,
		|	0											КАК СуммаЗатратаЗабалансовая,
		|	СУММА(ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ПрочиеРасходыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьБезНДС
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК СуммаЗатрата,
		|
		|// Стоимости с НДС
		|	0											КАК МатериальныеСНДС,
		|	0											КАК ТрудозатратыСНДС,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.Стоимость
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10))) КАК ПостатейныеПостоянныеСНДС,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.Стоимость
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПеременныеСНДС,
		|	0											КАК ДопРасходыСНДС,
		|
		|// Стоимости без НДС
		|	0											КАК МатериальныеБезНДС,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьБезНДС
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПостоянныеБезНДС,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьБезНДС
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПеременныеБезНДС,
		|	0											КАК ДопРасходыБезНДС,
		|
		|// Стоимости Регл
		|	0											КАК МатериальныеРегл,
		|	0											КАК ТрудозатратыРегл,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Переменные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПостоянныеРегл,
		|	СУММА(ВЫБОР
		|		КОГДА СтатьиРасходов.ХарактерПроизводственныхЗатрат = ЗНАЧЕНИЕ(Перечисление.ХарактерПроизводственныхЗатрат.Постоянные)
		|			ТОГДА 0
		|		ИНАЧЕ ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ * ВЫРАЗИТЬ(ВыпущеннаяПродукция.Числитель / ВыпущеннаяПродукция.Знаменатель КАК ЧИСЛО(31,10)))	КАК ПостатейныеПеременныеРегл,
		|	0											КАК ДопРасходыРегл,
		|	0											КАК СтоимостьЗабалансоваяРегл
		|ИЗ
		|	ВыпущеннаяПродукция КАК ВыпущеннаяПродукция
		|
		|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ПрочиеРасходыНезавершенногоПроизводства КАК ПрочиеРасходыНЗП
		|		ПО ВыпущеннаяПродукция.ПартияПродукции = ПрочиеРасходыНЗП.Регистратор
		|		И ВыпущеннаяПродукция.АналитикаУчетаПартийПродукции = ПрочиеРасходыНЗП.КорАналитикаУчетаПартий
		|
		|	ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
		|		ПО ПрочиеРасходыНЗП.СтатьяРасходов = СтатьиРасходов.Ссылка
		|
		|ГДЕ
		|	НЕ ВЫБОР
		|		КОГДА &ДанныеПоСебестоимости = 1
		|			ТОГДА ПрочиеРасходыНЗП.Стоимость
		|		КОГДА &ДанныеПоСебестоимости = 2
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьБезНДС
		|		КОГДА &ДанныеПоСебестоимости = 3
		|			ТОГДА ПрочиеРасходыНЗП.СтоимостьРегл
		|	КОНЕЦ = 0
		|
		|СГРУППИРОВАТЬ ПО
		|	ПрочиеРасходыНЗП.Организация,
		|	ПрочиеРасходыНЗП.СтатьяРасходов,
		|	ПрочиеРасходыНЗП.СтатьяКалькуляции,
		|	ПрочиеРасходыНЗП.АналитикаУчетаПродукции,
		|	ПрочиеРасходыНЗП.Регистратор,
		|	ПрочиеРасходыНЗП.КорАналитикаУчетаПартий,
		|	ПрочиеРасходыНЗП.Подразделение
		|";
	
	ТекстыЗапроса.Добавить(ТекстПрочиеРасходыОбъединение);
	
#КонецОбласти
	
	Возврат ТекстМатериальныеЗатраты
			+ СтрСоединить(ТекстыЗапроса, " ОБЪЕДИНИТЬ ВСЕ ");
	
КонецФункции

#Область ЗапросПоВыпущеннойПродукции

Функция ЗапросВыпущеннаяПродукция(ПараметрыУзла, ПомещатьВВТ = Ложь)
	
	Если ПараметрыУзла.ИнтерактивнаяНастройка Тогда
		АдаптироватьЗапросСКД(ПараметрыУзла.СхемаКД);
		КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
		МакетКомпоновки = КомпоновщикМакета.Выполнить(ПараметрыУзла.СхемаКД, ПараметрыУзла.НастройкиКД,,, Тип("ГенераторМакетаКомпоновкиДанныхДляКоллекцииЗначений"));
		
		НаборДанных = МакетКомпоновки.НаборыДанных.Найти("ВыпущеннаяПродукция");
		
		ПараметрыЗапроса = МакетКомпоновки.ЗначенияПараметров;
		КлючПараметра = "Имя";
	Иначе
		НаборДанных = ПараметрыУзла.СхемаКД.НаборыДанных.Найти("ВыпущеннаяПродукция");
		
		Отборы = ПараметрыУзла.Отборы; 
		
		Отборы.Вставить("ЗаВесьПериод",				Не ЗначениеЗаполнено(Отборы.ДатаНачала) И Не ЗначениеЗаполнено(Отборы.ДатаОкончания));
		Отборы.Вставить("ПоВсемОрганизациям",		Не ЗначениеЗаполнено(Отборы.Организации));
		Отборы.Вставить("ПоВсемПодразделениям",		Не ЗначениеЗаполнено(Отборы.Подразделения));
		Отборы.Вставить("ПоВсейПродукции",			Не ЗначениеЗаполнено(Отборы.Продукция));
		Отборы.Вставить("ПоВсемХарактеристикам",	Не ЗначениеЗаполнено(Отборы.ХарактеристикиПродукции));
		// При наличии отбора по аналитике учета партий, отбор по сериям не имеет смысла, т.к. аналитика учета партий определяет строку выпуска продукции.
		Отборы.Вставить("ПоВсемСериям",				Не ЗначениеЗаполнено(Отборы.СерииПродукции) ИЛИ ЗначениеЗаполнено(Отборы.АналитикиУчетаПартийПродукции));
		Отборы.Вставить("ПоВсемНазначениям",		Не ЗначениеЗаполнено(Отборы.НазначенияПродукции));
		Отборы.Вставить("ПоВсемПартиям",			Не ЗначениеЗаполнено(Отборы.ПартииПродукции));
		Отборы.Вставить("ПоВсемАналитикамПартий",	Не ЗначениеЗаполнено(Отборы.АналитикиУчетаПартийПродукции));
		Отборы.Вставить("РасшифровкаДвиженийДокумента", ЗначениеЗаполнено(Отборы.Регистраторы));
		
		ПараметрыЗапроса = ПараметрыУзла.Отборы;
		КлючПараметра = "Ключ";
	КонецЕсли;
	
	ТекстЗапроса = НаборДанных.Запрос;
	ТекстЗапроса = Лев(ТекстЗапроса, СтрНайти(ТекстЗапроса, ";", НаправлениеПоиска.СКонца) - 1);
	
	Если Не ПараметрыУзла.ИнтерактивнаяНастройка Тогда
		ТекстУсловия = 
		"И (&ЗаВесьПериод
		|		ИЛИ СебестоимостьТоваров.Период МЕЖДУ &ДатаНачала И &ДатаОкончания)
		|	И (&ПоВсемОрганизациям
		|		ИЛИ СебестоимостьТоваров.Организация В (&Организации))
		|	И (&ПоВсемПодразделениям
		|		ИЛИ СпрПодразделения.Ссылка В (&Подразделения))
		|	И (&ПоВсейПродукции
		|		ИЛИ КлючиАналитики.Номенклатура В (&Продукция))
		|	И (&ПоВсемПартиям
		|		ИЛИ СебестоимостьТоваров.Партия В (&ПартииПродукции))
		|	И (&ПоВсемХарактеристикам
		|		ИЛИ КлючиАналитики.Характеристика В (&ХарактеристикиПродукции))
		|	И (&ПоВсемСериям
		|		ИЛИ КлючиАналитики.Серия В (&СерииПродукции))
		|	И (&ПоВсемНазначениям
		|		ИЛИ КлючиАналитики.Назначение В (&НазначенияПродукции))
		|	И (&ПоВсемАналитикамПартий
		|		ИЛИ СебестоимостьТоваров.АналитикаУчетаПартий В (&АналитикиУчетаПартийПродукции))";
		
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "И &ТекстУсловия", ТекстУсловия);
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	
	Если Не ПомещатьВВТ Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "ПОМЕСТИТЬ ВыпущеннаяПродукция", "");
		ТекстСортировка = 
		"УПОРЯДОЧИТЬ ПО
		|	ВтПродукция.ПродукцияПредставление,
		|	ВтПродукция.ХарактеристикаПродукцииПредставление,
		|	ВтПродукция.СерияПродукцииПредставление,
		|	ВтПродукция.НазначениеПродукцииПредставление,
		|	ВтПродукция.ПартияПродукции
		|;
		|";
		ТекстЗапроса = ТекстЗапроса + ТекстСортировка;
	Иначе
		ТекстЗапроса = ТекстЗапроса + ";";
	КонецЕсли;
	
	Запрос.Текст = ТекстЗапроса;
	УстановитьПараметрыДереваСебестоимости(Запрос, ПараметрыЗапроса, КлючПараметра);
	Возврат Запрос;
	
КонецФункции

Процедура УстановитьПараметрыДереваСебестоимости(Запрос, ПараметрыЗапроса, КлючПараметра)
	
	Для Каждого ТекПараметр Из ПараметрыЗапроса Цикл
		Запрос.УстановитьПараметр(ТекПараметр[КлючПараметра], ТекПараметр.Значение);
	КонецЦикла;
	
КонецПроцедуры

Процедура АдаптироватьЗапросСКД(СхемаКомпоновки) Экспорт
	
	НаборДанных = СхемаКомпоновки.НаборыДанных.Найти("ВыпущеннаяПродукция");
	
	Если НаборДанных = Неопределено Тогда
		ВызватьИсключение НСтр("ru = 'Изменен перечень наборов данных схемы компоновки дерева себестоимости.';
								|en = 'List of data sets of cost tree composition schema is changed.'");
	Иначе
		НаборДанных.Запрос = СтрЗаменить(НаборДанных.Запрос, "И &ТекстУсловия", "");
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область СтруктураДереваСебестоимости

Процедура ПустоеДеревоСебестоимости(ПараметрыДерева, ПараметрыУзла)
	
	Если ПараметрыДерева.ТипРезультата = "ДеревоЗначений" Тогда
		ПараметрыДерева.Результат = Новый ДеревоЗначений;
		ИнициализироватьПоляДереваСебестоимости(ПараметрыДерева.Результат);
	ИначеЕсли ПараметрыДерева.ТипРезультата = "ТаблицаЗначений" Тогда
		ПараметрыДерева.Результат = Новый ТаблицаЗначений;
		ИнициализироватьПоляДереваСебестоимости(ПараметрыДерева.Результат);
	Иначе
		ПараметрыДерева.Результат = Новый МенеджерВременныхТаблиц;
	КонецЕсли;
	
КонецПроцедуры

Процедура ИнициализироватьПоляДереваСебестоимости(Результат)
	
	СтруктураПолей = СтруктураПолейДереваСебестоимости();
	
	Для Каждого ТекПоле Из СтруктураПолей Цикл
		Если ТекПоле.Значение = Неопределено Тогда
			Результат.Колонки.Добавить(ТекПоле.Ключ);
		Иначе
			Результат.Колонки.Добавить(ТекПоле.Ключ, ТекПоле.Значение);
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Функция СтруктураПолейДереваСебестоимости()
	
	СтруктураПолей = Новый Структура;
	
	СтруктураПолей.Вставить("ВидСтроки",
		Новый ОписаниеТипов("ПеречислениеСсылка.ВидыСтрокДереваСебестоимости"));
		
	СтруктураПолей.Вставить("Идентификатор",
		Новый ОписаниеТипов("УникальныйИдентификатор"));
	
	СтруктураПолей.Вставить("АналитикаУчетаПродукции",
		Новый ОписаниеТипов("СправочникСсылка.КлючиАналитикиУчетаНоменклатуры"));
	
	СтруктураПолей.Вставить("АналитикаУчетаВыходноеИзделие",
		Новый ОписаниеТипов("СправочникСсылка.КлючиАналитикиУчетаНоменклатуры"));
	
	ТипыАналитикиЗатрат = Новый Массив;
	ТипыАналитикиЗатрат.Добавить(Тип("СправочникСсылка.КлючиАналитикиУчетаНоменклатуры"));
	ТипыАналитикиЗатрат.Добавить(Тип("СправочникСсылка.ВидыРаботСотрудников"));
	ТипыАналитикиЗатрат.Добавить(Тип("ПланВидовХарактеристикСсылка.СтатьиРасходов"));
	ТипыАналитикиЗатрат = Новый ОписаниеТипов(ТипыАналитикиЗатрат);
	СтруктураПолей.Вставить("АналитикаУчетаЗатрата", ТипыАналитикиЗатрат);
	
	ТипыАналитикиУчетаПартий = Новый ОписаниеТипов("СправочникСсылка.КлючиАналитикиУчетаПартий");
	СтруктураПолей.Вставить("АналитикаУчетаПартий",					ТипыАналитикиУчетаПартий);
	СтруктураПолей.Вставить("АналитикаУчетаПартийПродукции",		ТипыАналитикиУчетаПартий);
	СтруктураПолей.Вставить("АналитикаУчетаПартийВыходноеИзделие",	ТипыАналитикиУчетаПартий);
	СтруктураПолей.Вставить("АналитикаУчетаПартийЗатрата",			ТипыАналитикиУчетаПартий);
	
	СтруктураПолей.Вставить("Организация",
		Новый ОписаниеТипов("СправочникСсылка.Организации"));
		
	СтруктураПолей.Вставить("Подразделение",
		Новый ОписаниеТипов("СправочникСсылка.СтруктураПредприятия"));
	
	СтруктураПолей.Вставить("ТипЗатрат",
		Новый ОписаниеТипов("Строка"));
	
	СтруктураПолей.Вставить("ТребуетсяРазузлование",
		Новый ОписаниеТипов("Булево"));
	
	СтруктураПолей.Вставить("ЕдиницаИзмерения",
		Новый ОписаниеТипов("СправочникСсылка.УпаковкиЕдиницыИзмерения"));
	
	ТипыЗатраты = Новый Массив;
	ТипыЗатраты.Добавить(Тип("СправочникСсылка.Номенклатура"));
	ТипыЗатраты.Добавить(Тип("СправочникСсылка.ВидыРаботСотрудников"));
	ТипыЗатраты.Добавить(Тип("ПланВидовХарактеристикСсылка.СтатьиРасходов"));
	ТипыЗатраты = Новый ОписаниеТипов(ТипыЗатраты);
	СтруктураПолей.Вставить("Номенклатура", ТипыЗатраты);
	
	СтруктураПолей.Вставить("Характеристика",
		Новый ОписаниеТипов("СправочникСсылка.ХарактеристикиНоменклатуры"));
	
	СтруктураПолей.Вставить("Серия",
		Новый ОписаниеТипов("СправочникСсылка.СерииНоменклатуры"));
	
	СтруктураПолей.Вставить("Назначение",
		Новый ОписаниеТипов("СправочникСсылка.Назначения"));
		
	СтруктураПолей.Вставить("Валюта",
		Новый ОписаниеТипов("СправочникСсылка.Валюты"));
	
	СтруктураПолей.Вставить("СтатьяКалькуляции",
		Новый ОписаниеТипов("СправочникСсылка.СтатьиКалькуляции"));
	
	СтруктураПолей.Вставить("Уровень",
		Новый ОписаниеТипов("Число"));
	
	ТипыПартий = Новый ОписаниеТипов(Метаданные.ОпределяемыеТипы.ДокументПартии.Тип.Типы());
	СтруктураПолей.Вставить("Партия",					ТипыПартий);
	СтруктураПолей.Вставить("ПартияПродукции",			ТипыПартий);
	СтруктураПолей.Вставить("ПартияВыходноеИзделие",	ТипыПартий);
	СтруктураПолей.Вставить("ПартияЗатрата",			ТипыПартий);
	
	ТипЧисла = Новый ОписаниеТипов("Число",,, Новый КвалификаторыЧисла(19, 6));
	СтруктураПолей.Вставить("Количество",			ТипЧисла);
	СтруктураПолей.Вставить("Числитель",			ТипЧисла);
	СтруктураПолей.Вставить("Знаменатель",			ТипЧисла);
	
	// Стоимости согласно параметру "ДанныеПоСебестоимости"
	СтруктураПолей.Вставить("Сумма",					ТипЧисла);
	СтруктураПолей.Вставить("СуммаЗабалансовая",		ТипЧисла);
	СтруктураПолей.Вставить("Материальные",				ТипЧисла);
	СтруктураПолей.Вставить("Трудозатраты",				ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянные",	ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременные",	ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходы",				ТипЧисла);
	
	// Стоимости с НДС
	СтруктураПолей.Вставить("МатериальныеСНДС",				ТипЧисла);
	СтруктураПолей.Вставить("ТрудозатратыСНДС",				ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянныеСНДС",	ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременныеСНДС", 	ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходыСНДС",				ТипЧисла);
	
	// Стоимости без НДС
	СтруктураПолей.Вставить("МатериальныеБезНДС",			ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянныеБезНДС",	ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременныеБезНДС",	ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходыБезНДС",				ТипЧисла);
	
	// Стоимости Регл
	СтруктураПолей.Вставить("МатериальныеРегл",				ТипЧисла);
	СтруктураПолей.Вставить("ТрудозатратыРегл",				ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПостоянныеРегл",	ТипЧисла);
	СтруктураПолей.Вставить("ПостатейныеПеременныеРегл",	ТипЧисла);
	СтруктураПолей.Вставить("ДопРасходыРегл",				ТипЧисла);
	СтруктураПолей.Вставить("СтоимостьЗабалансоваяРегл",	ТипЧисла);
	
	Возврат СтруктураПолей;
	
КонецФункции

#КонецОбласти


#КонецОбласти
