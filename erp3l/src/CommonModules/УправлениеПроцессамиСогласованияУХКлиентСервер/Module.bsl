////////////////////////////////////////////////////////////////////////////////
// Модуль содержит клиент-серверную логику механизмов согласования объектов.
//  
////////////////////////////////////////////////////////////////////////////////
#Область ПрограммныйИнтерфейс

Функция НовыйПротоколОшибокУстановкиСтатуса(Ссылка = Неопределено) Экспорт
	
	Протокол = Новый Структура;
	Протокол.Вставить("Ссылка", Ссылка);
	Протокол.Вставить("Ошибки", Новый Массив);
	
	Возврат Протокол;
	
КонецФункции

Функция НовыйОписаниеОшибкиУстановкиСтатуса(ТекстОшибки = "", Поле = "") Экспорт
	
	ОписаниеОшибкиУстановкиСтатуса = Новый Структура;
	ОписаниеОшибкиУстановкиСтатуса.Вставить("ТекстОшибки", ТекстОшибки);
	ОписаниеОшибкиУстановкиСтатуса.Вставить("Поле", Поле);
	
	Возврат ОписаниеОшибкиУстановкиСтатуса;
	
КонецФункции

Процедура ДобавитьОшибкуУстановкиСтатусаОбъекта(ПротоколОшибок, Ссылка, ТекстОшибки, Поле = "") Экспорт
	
	Если ПротоколОшибок = Неопределено Тогда
		ПротоколОшибок = НовыйПротоколОшибокУстановкиСтатуса(Ссылка);
	КонецЕсли;
	
	ПротоколОшибок.Ошибки.Добавить(НовыйОписаниеОшибкиУстановкиСтатуса(ТекстОшибки, Поле));
	
КонецПроцедуры

// Обновляет картинку статуса процесса на форме Форма для объекта согласования СсылкаВход.
Процедура УстановитьКартинкСтатусаПроцесса(СсылкаВход, Форма) Экспорт
	КартинкаНайдена = (Форма.Элементы.Найти("КартинкаСтатуса") <> Неопределено);
	Если КартинкаНайдена Тогда
		ПустоеСостояние = ПредопределенноеЗначение("Перечисление.СостоянияПроцесса.ПустаяСсылка");
		СтруктураДанныхКартинки = УправлениеПроцессамиСогласованияУХ.ПолучитьСтруктуруДанныхКартинкиОтобрженияПроцесса(СсылкаВход);
		НоваяКартинка = ОбщегоНазначенияКлиентСервер.СвойствоСтруктуры(СтруктураДанныхКартинки, "Картинка", Новый Картинка);
		СтатусОбъекта = ОбщегоНазначенияКлиентСервер.СвойствоСтруктуры(СтруктураДанныхКартинки, "СтатусОбъекта", ПустоеСостояние);
		Форма.Элементы.КартинкаСтатуса.Картинка = НоваяКартинка;
		Форма.Элементы.КартинкаСтатуса.Подсказка = Строка(СтатусОбъекта);
	Иначе
		// Картинка статуса на форме не выведена.
	КонецЕсли;	
КонецПроцедуры		// УстановитьКартинкСтатусаПроцесса()

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#КонецОбласти
