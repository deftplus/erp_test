
#Область ПрограммныйИнтерфейс
	
#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

// Процедура выполняет заполнение соответствия обработчиков обновления
Процедура АлгоритмыЗаполнения(ОбработчикиЗаполнения, УчитыватьНастройкиФункциональныхОпций) Экспорт
	
	Модуль = ЗаполнениеОФДАлгоритмы;
	
	//
	Если (НЕ УчитыватьНастройкиФункциональныхОпций) ИЛИ (ПолучитьФункциональнуюОпцию("АвтоматическиФормироватьОФДПоДокументамДДС")) Тогда
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.СписаниеБезналичныхДенежныхСредств.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.РасходныйКассовыйОрдер.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.ПоступлениеБезналичныхДенежныхСредств.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.ПриходныйКассовыйОрдер.ПолноеИмя(), Модуль);
	КонецЕсли;
	
	//
	Если (НЕ УчитыватьНастройкиФункциональныхОпций) ИЛИ (ПолучитьФункциональнуюОпцию("АвтоматическиФормироватьОФДПоДокументамПТУРТУ")) Тогда
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.ПриобретениеТоваровУслуг.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.ВозвратТоваровПоставщику.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.РеализацияТоваровУслуг.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.АктВыполненныхРабот.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.ВозвратТоваровОтКлиента.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.ОтчетКомиссионера.ПолноеИмя(), Модуль);
		ОбработчикиЗаполнения.Вставить(Метаданные.Документы.ПриобретениеУслугПрочихАктивов.ПолноеИмя(), Модуль);
	КонецЕсли;
	
КонецПроцедуры

// Возвращает признак необходимости заполнения ОФД по переданной ссылке на документ
Функция ТребуетсяЗаполнение(ИсточникСсылка) Экспорт
	
	Если ИсточникСсылка = неопределено Тогда
		Возврат Ложь;
	КонецЕсли;
	
	ТипИсточника = ТипЗнч(ИсточникСсылка);
	Если ТипИсточника = Тип("ДокументСсылка.РасходныйКассовыйОрдер")
		ИЛИ ТипИсточника = Тип("ДокументСсылка.ПриходныйКассовыйОрдер")
		ИЛИ ТипИсточника = Тип("ДокументСсылка.ПриобретениеТоваровУслуг") Тогда
		Результат = Истина;
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.СписаниеБезналичныхДенежныхСредств")
		ИЛИ ТипИсточника = Тип("ДокументСсылка.ПоступлениеБезналичныхДенежныхСредств") Тогда
		// В ОФД попадают только проведенные банком СписанияБДС и ПоступлениеБДС
		Результат = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ИсточникСсылка, "ПроведеноБанком");
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.РеализацияТоваровУслуг") Тогда
		// В ОФД попадают все реализации, кроме:
		//		-- отгруженных, но еще не завершенных реализаций.
		//		-- передачи на комиссию
		РеквизитыДокумента = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(ИсточникСсылка, "ХозяйственнаяОперация, Статус");
		
		Если РеквизитыДокумента.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.ПередачаНаКомиссию Тогда
			Результат = Ложь;
		ИначеЕсли РеквизитыДокумента.ХозяйственнаяОперация = Перечисления.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности
			И РеквизитыДокумента.Статус <> Перечисления.СтатусыРеализацийТоваровУслуг.Отгружено Тогда
			Результат = Ложь;
		Иначе
			Результат = Истина;
		КонецЕсли;
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.АктВыполненныхРабот") Тогда
		Результат = Истина;
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ОтчетКомиссионера") Тогда
		Результат = Истина;
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ВозвратТоваровПоставщику") Тогда
		Результат = Истина;
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ВозвратТоваровОтКлиента") Тогда
		Результат = Истина;
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ПриобретениеУслугПрочихАктивов") Тогда
		Результат = Истина;
	Иначе
		Результат = Ложь;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

// Процедура формирует ДокОФД.ДополнительныеСвойства дополнительную информацию, требуемую для работы алгоритмов заполнения
Процедура ПодготовитьДопИнформациюДляОтраженияДокумента(Источник, ДокОФД) Экспорт
	
КонецПроцедуры

// Функция возвращает структуру с данными для заполнения ОФД
Функция СобратьДанныеДляЗаполнения(ИсточникСсылка, ДополнительныеСвойства = неопределено) Экспорт
	
	Если ИсточникСсылка = неопределено Тогда
		Возврат Ложь;
	КонецЕсли;
	
	ТипИсточника = ТипЗнч(ИсточникСсылка);
	Если ТипИсточника = Тип("ДокументСсылка.СписаниеБезналичныхДенежныхСредств")
		ИЛИ ТипИсточника = Тип("ДокументСсылка.РасходныйКассовыйОрдер")
		ИЛИ ТипИсточника = Тип("ДокументСсылка.ПоступлениеБезналичныхДенежныхСредств")
		ИЛИ ТипИсточника = Тип("ДокументСсылка.ПриходныйКассовыйОрдер") Тогда
		Результат = ВыполнитьЗаполнение_ДенежныеДокументы(ИсточникСсылка);
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ПриобретениеТоваровУслуг") Тогда
		Результат = ВыполнитьЗаполнение_ПТУ(ИсточникСсылка);
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ВозвратТоваровПоставщику") Тогда
		Результат = ВыполнитьЗаполнение_ВозвратТоваровПоставщику(ИсточникСсылка);
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.РеализацияТоваровУслуг") Тогда
		Результат = ВыполнитьЗаполнение_РТУ(ИсточникСсылка);
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.АктВыполненныхРабот") Тогда
		Результат = ВыполнитьЗаполнение_АктВыполненныхРабот(ИсточникСсылка);
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ВозвратТоваровОтКлиента") Тогда
		Результат = ВыполнитьЗаполнение_ВозвратТоваровОтКлиента(ИсточникСсылка);
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ОтчетКомиссионера") Тогда
		Результат = ВыполнитьЗаполнение_ОтчетКомиссионера(ИсточникСсылка);
	ИначеЕсли ТипИсточника = Тип("ДокументСсылка.ПриобретениеУслугПрочихАктивов") Тогда	
		Результат = ВыполнитьЗаполнение_ПриобретениеУслугПрочихАктивов(ИсточникСсылка);
	Иначе
		Результат = Неопределено;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Приобретение товаров и услуг
Функция ВыполнитьЗаполнение_ПТУ(ИсходныйДокументСсылка)
	
	// Получение данных
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка",			ИсходныйДокументСсылка);
	Запрос.УстановитьПараметр("ИмяМетаданных",	ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	Запрос.УстановитьПараметр("УИД",			ИсходныйДокументСсылка.УникальныйИдентификатор());
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ПриобретениеТоваровУслуг) КАК Ссылка,
	|	ДоговорыКонтрагентов.Ссылка КАК ДоговорКонтрагента,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.ЦФО ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнойЦФО
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.ЦФО
	|	КОНЕЦ КАК ЦФО,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Проект ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнойПроект
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Проект
	|	КОНЕЦ КАК Проект,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.СтатьяБюджета ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.СтатьяБюджета
	|	КОНЕЦ КАК СтатьяБюджета,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика1 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение1
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика1
	|	КОНЕЦ КАК Аналитика1,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика2 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение2
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика2
	|	КОНЕЦ КАК Аналитика2,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика3 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение3
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика3
	|	КОНЕЦ КАК Аналитика3,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика4 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение4
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика4
	|	КОНЕЦ КАК Аналитика4,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика5 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение5
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика5
	|	КОНЕЦ КАК Аналитика5,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика6 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение6
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика6
	|	КОНЕЦ КАК Аналитика6,
	|	Суммы.ОбъектРасчетов.Объект КАК ОбъектРасчетов,
	|	Суммы.Валюта КАК Валюта,
	|	Суммы.СуммаБезНДС + Суммы.СуммаНДС КАК Сумма,
	|	Суммы.СуммаБезНДС КАК СуммаБезНДС,
	|	Суммы.СуммаНДС КАК СуммаНДС,
	|	Суммы.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	Суммы.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов - Суммы.СуммаНДСВзаиморасчетов КАК СуммаБезНДСВзаиморасчетов,
	|	ПриобретениеТоваровУслугТовары.Количество КАК Количество,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА ДанныеАналитикПланированияДокумента.СтатьяБюджета ЕСТЬ NULL
	|					ТОГДА ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение
	|				ИНАЧЕ ДанныеАналитикПланированияДокумента.СтатьяБюджета
	|			КОНЕЦ ССЫЛКА Справочник.СтатьиДвиженияРесурсов
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоБюджетЗакупок
	|ПОМЕСТИТЬ ВТ_СуммыДокумента
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг.Товары КАК ПриобретениеТоваровУслугТовары
	|		ПО Суммы.Регистратор = ПриобретениеТоваровУслугТовары.Ссылка
	|			И Суммы.ИдентификаторСтроки = ПриобретениеТоваровУслугТовары.ИдентификаторСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	|		ПО (ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ПриобретениеТоваровУслуг).Договор = ДоговорыКонтрагентов.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеТоваровУслуг.АналитикиПланирования КАК ДанныеАналитикПланированияДокумента
	|		ПО ((ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ПриобретениеТоваровУслуг)) = ДанныеАналитикПланированияДокумента.Ссылка)
	|			И (ДанныеАналитикПланированияДокумента.ВидБюджета <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыБюджетов.БюджетДвиженияДенежныхСредств))
	|ГДЕ
	|	Суммы.Регистратор = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ИмяМетаданных КАК ИмяМетаданных,
	|	&УИД КАК УИД,
	|	Документ.ХозяйственнаяОперация КАК ВидОперации,
	|	Документ.Дата КАК Дата,
	|	Документ.Организация КАК Организация,
	|	Документ.Контрагент КАК Контрагент,
	|	Документ.Договор КАК ДоговорКонтрагента,
	|	Документ.Номер КАК НомерИсходногоДокумента,
	|	Документ.Дата КАК ДатаИсходногоДокумента,
	|	Документ.НомерВходящегоДокумента КАК НомерВходящегоДокумента,
	|	Документ.ДатаВходящегоДокумента КАК ДатаВходящегоДокумента,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаДокумента,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаДокумента,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход) КАК ПриходРасход,
	|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности) КАК НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ЦФО КАК ЦФО,
	|	ВТ_СуммыДокумента.Проект КАК Проект
	|ИЗ
	|	Документ.ПриобретениеТоваровУслуг КАК Документ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|		ПО (Документ.Ссылка = &Ссылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Документ.ХозяйственнаяОперация,
	|	ВТ_СуммыДокумента.Валюта,
	|	Документ.Договор,
	|	Документ.НомерВходящегоДокумента,
	|	Документ.ДатаВходящегоДокумента,
	|	Документ.Номер,
	|	Документ.Организация,
	|	Документ.Контрагент,
	|	Документ.Дата,
	|	ВТ_СуммыДокумента.ЦФО,
	|	ВТ_СуммыДокумента.Проект,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	Документ.Дата
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
	|	ВТ_СуммыДокумента.СтатьяБюджета КАК СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов
	|ИЗ
	|	ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_СуммыДокумента.ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА ОтражатьВБДРРеализациюКакПриход.Значение = ИСТИНА
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход)
	|	КОНЕЦ КАК ПриходРасход,
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДоходовИРасходов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента,
	|	Константа.ОтражатьВБДРРеализациюКакПриход КАК ОтражатьВБДРРеализациюКакПриход
	|ГДЕ
	|	СуммыДокумента.ЭтоБюджетЗакупок = ЛОЖЬ
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов,
	|	ОтражатьВБДРРеализациюКакПриход.Значение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход) КАК ПриходРасход,
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДвиженияРесурсов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента
	|ГДЕ
	|	СуммыДокумента.ЭтоБюджетЗакупок = ИСТИНА
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	Если РезультатЗапроса[1].Пустой() Тогда
		Возврат неопределено; // Стандартное заполнение
	КонецЕсли;
	
	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("Шапка", РезультатЗапроса[1].Выгрузить());
	Результат.Вставить("Взаиморасчеты", РезультатЗапроса[2].Выгрузить());
	Результат.Вставить("БюджетДоходовИРасходов", РезультатЗапроса[3].Выгрузить());
	Результат.Вставить("БюджетДвиженияРесурсов", РезультатЗапроса[4].Выгрузить());
	
	// Массив ключевых реквизитов
	КлючевыеРеквизиты = Новый Массив;
	КлючевыеРеквизиты.Добавить("ИмяМетаданных");
	КлючевыеРеквизиты.Добавить("УИД");
	КлючевыеРеквизиты.Добавить("ВидОперации");
	КлючевыеРеквизиты.Добавить("Организация");
	КлючевыеРеквизиты.Добавить("Контрагент");
	КлючевыеРеквизиты.Добавить("СуммаДокумента");
	КлючевыеРеквизиты.Добавить("ВалютаДокумента");
	
	Результат.Вставить("КлючевыеРеквизиты", КлючевыеРеквизиты);
	
	Возврат Результат;
	
КонецФункции

// ВозвратТоваровПоставщику
Функция ВыполнитьЗаполнение_ВозвратТоваровПоставщику(ИсходныйДокументСсылка)
	
	// Получение данных
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", ИсходныйДокументСсылка);
	Запрос.УстановитьПараметр("ИмяМетаданных",	ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	Запрос.УстановитьПараметр("УИД",			ИсходныйДокументСсылка.УникальныйИдентификатор());
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ВозвратТоваровПоставщику) КАК Ссылка,
	|	ДоговорыКонтрагентов.Ссылка КАК ДоговорКонтрагента,
	|	ДоговорыКонтрагентов.ОсновнойЦФО КАК ЦФО,
	|	ДоговорыКонтрагентов.ОсновнойПроект КАК Проект,
	|	ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение КАК СтатьяБюджета,
	|	ДоговорыКонтрагентов.АналитикаИсполнение1 КАК Аналитика1,
	|	ДоговорыКонтрагентов.АналитикаИсполнение2 КАК Аналитика2,
	|	ДоговорыКонтрагентов.АналитикаИсполнение3 КАК Аналитика3,
	|	ДоговорыКонтрагентов.АналитикаИсполнение4 КАК Аналитика4,
	|	ДоговорыКонтрагентов.АналитикаИсполнение5 КАК Аналитика5,
	|	ДоговорыКонтрагентов.АналитикаИсполнение6 КАК Аналитика6,
	|	Суммы.ОбъектРасчетов.Объект КАК ОбъектРасчетов,
	|	Суммы.Валюта КАК Валюта,
	|	Суммы.СуммаБезНДС + Суммы.СуммаНДС КАК Сумма,
	|	Суммы.СуммаБезНДС КАК СуммаБезНДС,
	|	Суммы.СуммаНДС КАК СуммаНДС,
	|	Суммы.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	Суммы.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов - Суммы.СуммаНДСВзаиморасчетов КАК СуммаБезНДСВзаиморасчетов,
	|	ВозвратТоваровПоставщикуТовары.Количество КАК Количество,
	|	ВЫБОР
	|		КОГДА ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение ССЫЛКА Справочник.СтатьиДвиженияРесурсов
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоБюджетЗакупок
	|ПОМЕСТИТЬ ВТ_СуммыДокумента
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровПоставщику.Товары КАК ВозвратТоваровПоставщикуТовары
	|		ПО Суммы.Регистратор = ВозвратТоваровПоставщикуТовары.Ссылка
	|			И Суммы.ИдентификаторСтроки = ВозвратТоваровПоставщикуТовары.ИдентификаторСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	|		ПО (ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ВозвратТоваровПоставщику).Договор = ДоговорыКонтрагентов.Ссылка)
	|ГДЕ
	|	Суммы.Регистратор = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ИмяМетаданных КАК ИмяМетаданных,
	|	&УИД КАК УИД,
	|	Документ.ХозяйственнаяОперация КАК ВидОперации,
	|	Документ.Дата КАК Дата,
	|	Документ.Организация КАК Организация,
	|	Документ.Контрагент КАК Контрагент,
	|	Документ.Договор КАК ДоговорКонтрагента,
	|	Документ.Номер КАК НомерИсходногоДокумента,
	|	Документ.Дата КАК ДатаИсходногоДокумента,
	|	"""" КАК НомерВходящегоДокумента,
	|	"""" КАК ДатаВходящегоДокумента,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаДокумента,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаДокумента,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход) КАК ПриходРасход,
	|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности) КАК НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ЦФО КАК ЦФО,
	|	ВТ_СуммыДокумента.Проект КАК Проект
	|ИЗ
	|	Документ.ВозвратТоваровПоставщику КАК Документ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|		ПО (Документ.Ссылка = &Ссылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Документ.ХозяйственнаяОперация,
	|	ВТ_СуммыДокумента.Валюта,
	|	Документ.Договор,
	|	Документ.Номер,
	|	Документ.Организация,
	|	Документ.Контрагент,
	|	Документ.Дата,
	|	ВТ_СуммыДокумента.ЦФО,
	|	ВТ_СуммыДокумента.Проект,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	Документ.Дата
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
	|	ВТ_СуммыДокумента.СтатьяБюджета КАК СтатьяБюджета,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаВзаиморасчетов
	|ИЗ
	|	ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_СуммыДокумента.ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	ВТ_СуммыДокумента.Валюта
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВЫБОР КОГДА ОтражатьВБДРРеализациюКакПриход.Значение = ИСТИНА
	|		ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход)
	|	КОНЕЦ КАК ПриходРасход,	
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДоходовИРасходов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента,
	|	Константа.ОтражатьВБДРРеализациюКакПриход КАК ОтражатьВБДРРеализациюКакПриход
	|ГДЕ
	|	СуммыДокумента.ЭтоБюджетЗакупок = ЛОЖЬ
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов,
	|	СуммыДокумента.СтатьяБюджета,
	|	ОтражатьВБДРРеализациюКакПриход.Значение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход) КАК ПриходРасход,
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДвиженияРесурсов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента
	|ГДЕ
	|	СуммыДокумента.ЭтоБюджетЗакупок = ИСТИНА
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов,
	|	СуммыДокумента.СтатьяБюджета";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	Если РезультатЗапроса[1].Пустой() Тогда
		Возврат неопределено; // Стандартное заполнение
	КонецЕсли;
	
	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("Шапка", РезультатЗапроса[1].Выгрузить());
	Результат.Вставить("Взаиморасчеты", РезультатЗапроса[2].Выгрузить());
	Результат.Вставить("БюджетДоходовИРасходов", РезультатЗапроса[3].Выгрузить());
	Результат.Вставить("БюджетДвиженияРесурсов", РезультатЗапроса[4].Выгрузить());
	
	// Массив ключевых реквизитов
	КлючевыеРеквизиты = Новый Массив;
	КлючевыеРеквизиты.Добавить("ИмяМетаданных");
	КлючевыеРеквизиты.Добавить("УИД");
	КлючевыеРеквизиты.Добавить("ВидОперации");
	КлючевыеРеквизиты.Добавить("Организация");
	КлючевыеРеквизиты.Добавить("Контрагент");
	КлючевыеРеквизиты.Добавить("СуммаДокумента");
	КлючевыеРеквизиты.Добавить("ВалютаДокумента");
	
	Результат.Вставить("КлючевыеРеквизиты", КлючевыеРеквизиты);
	
	Возврат Результат;
	
КонецФункции

// Реализация товаров и услуг
Функция ВыполнитьЗаполнение_РТУ(ИсходныйДокументСсылка)
	
	// Получение данных
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", ИсходныйДокументСсылка);
	Запрос.УстановитьПараметр("ИмяМетаданных",	ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	Запрос.УстановитьПараметр("УИД",			ИсходныйДокументСсылка.УникальныйИдентификатор());
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.РеализацияТоваровУслуг) КАК Ссылка,
	|	ДоговорыКонтрагентов.Ссылка КАК ДоговорКонтрагента,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.ЦФО ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнойЦФО
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.ЦФО
	|	КОНЕЦ КАК ЦФО,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Проект ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнойПроект
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Проект
	|	КОНЕЦ КАК Проект,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.СтатьяБюджета ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.СтатьяБюджета
	|	КОНЕЦ КАК СтатьяБюджета,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика1 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение1
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика1
	|	КОНЕЦ КАК Аналитика1,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика2 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение2
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика2
	|	КОНЕЦ КАК Аналитика2,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика3 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение3
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика3
	|	КОНЕЦ КАК Аналитика3,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика4 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение4
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика4
	|	КОНЕЦ КАК Аналитика4,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика5 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение5
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика5
	|	КОНЕЦ КАК Аналитика5,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика6 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение6
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика6
	|	КОНЕЦ КАК Аналитика6,
	|	Суммы.ОбъектРасчетов.Объект КАК ОбъектРасчетов,
	|	Суммы.Валюта КАК Валюта,
	|	Суммы.СуммаБезНДС + Суммы.СуммаНДС КАК Сумма,
	|	Суммы.СуммаБезНДС КАК СуммаБезНДС,
	|	Суммы.СуммаНДС КАК СуммаНДС,
	|	Суммы.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	Суммы.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов - Суммы.СуммаНДСВзаиморасчетов КАК СуммаБезНДСВзаиморасчетов,
	|	РеализацияТоваровУслугТовары.Количество КАК Количество,
	|	ВЫБОР
	|		КОГДА ОтражатьВБДРРеализациюКакПриход.Значение = ИСТИНА
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход)
	|	КОНЕЦ КАК ПриходРасход
	|ПОМЕСТИТЬ ВТ_СуммыДокумента
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
	|		ПО Суммы.Регистратор = РеализацияТоваровУслугТовары.Ссылка
	|			И Суммы.ИдентификаторСтроки = РеализацияТоваровУслугТовары.ИдентификаторСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	|		ПО (ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.РеализацияТоваровУслуг).Договор = ДоговорыКонтрагентов.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.АналитикиПланирования КАК ДанныеАналитикПланированияДокумента
	|		ПО ((ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.РеализацияТоваровУслуг)) = ДанныеАналитикПланированияДокумента.Ссылка)
	|			И (ДанныеАналитикПланированияДокумента.ВидБюджета <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыБюджетов.БюджетДвиженияДенежныхСредств)),
	|	Константа.ОтражатьВБДРРеализациюКакПриход КАК ОтражатьВБДРРеализациюКакПриход
	|ГДЕ
	|	Суммы.Регистратор = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ИмяМетаданных КАК ИмяМетаданных,
	|	&УИД КАК УИД,
	|	Документ.ХозяйственнаяОперация КАК ВидОперации,
	|	ВЫБОР
	|		КОГДА Документ.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
	|				И Документ.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРеализацийТоваровУслуг.Отгружено)
	|			ТОГДА Документ.ДатаПереходаПраваСобственности
	|		ИНАЧЕ Документ.Дата
	|	КОНЕЦ КАК Дата,
	|	Документ.Организация КАК Организация,
	|	Документ.Контрагент КАК Контрагент,
	|	Документ.Договор КАК ДоговорКонтрагента,
	|	Документ.Номер КАК НомерИсходногоДокумента,
	|	Документ.Дата КАК ДатаИсходногоДокумента,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаДокумента,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаДокумента,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход) КАК ПриходРасход,
	|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности) КАК НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ЦФО КАК ЦФО,
	|	ВТ_СуммыДокумента.Проект КАК Проект
	|ИЗ
	|	Документ.РеализацияТоваровУслуг КАК Документ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|		ПО (Документ.Ссылка = &Ссылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Документ.ХозяйственнаяОперация,
	|	ВЫБОР
	|		КОГДА Документ.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияБезПереходаПраваСобственности)
	|				И Документ.Статус = ЗНАЧЕНИЕ(Перечисление.СтатусыРеализацийТоваровУслуг.Отгружено)
	|			ТОГДА Документ.ДатаПереходаПраваСобственности
	|		ИНАЧЕ Документ.Дата
	|	КОНЕЦ,
	|	ВТ_СуммыДокумента.Валюта,
	|	Документ.Договор,
	|	Документ.Номер,
	|	Документ.Организация,
	|	Документ.Контрагент,
	|	Документ.Дата,
	|	ВТ_СуммыДокумента.ЦФО,
	|	ВТ_СуммыДокумента.Проект,
	|	ВТ_СуммыДокумента.СтатьяБюджета
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
	|	ВТ_СуммыДокумента.СтатьяБюджета КАК СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	ВТ_СуммыДокумента.ПриходРасход КАК ПриходРасход
	|ИЗ
	|	ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_СуммыДокумента.ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов,
	|	ВТ_СуммыДокумента.ПриходРасход
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДоходовИРасходов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество,
	|	СуммыДокумента.ПриходРасход КАК ПриходРасход
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов,
	|	СуммыДокумента.ПриходРасход";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	Если РезультатЗапроса[1].Пустой() Тогда
		Возврат неопределено; // Стандартное заполнение
	КонецЕсли;
	
	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("Шапка", РезультатЗапроса[1].Выгрузить());
	Результат.Вставить("Взаиморасчеты", РезультатЗапроса[2].Выгрузить());
	Результат.Вставить("БюджетДоходовИРасходов", РезультатЗапроса[3].Выгрузить());
	
	// Массив ключевых реквизитов
	КлючевыеРеквизиты = Новый Массив;
	КлючевыеРеквизиты.Добавить("ИмяМетаданных");
	КлючевыеРеквизиты.Добавить("УИД");
	КлючевыеРеквизиты.Добавить("ВидОперации");
	КлючевыеРеквизиты.Добавить("Организация");
	КлючевыеРеквизиты.Добавить("Контрагент");
	КлючевыеРеквизиты.Добавить("СуммаДокумента");
	КлючевыеРеквизиты.Добавить("ВалютаДокумента");
	
	Результат.Вставить("КлючевыеРеквизиты", КлючевыеРеквизиты);
	
	Возврат Результат;
	
КонецФункции

// АктВыполненныхРабот
Функция ВыполнитьЗаполнение_АктВыполненныхРабот(ИсходныйДокументСсылка)
	
	// Получение данных
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", ИсходныйДокументСсылка);
	Запрос.УстановитьПараметр("ИмяМетаданных",	ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	Запрос.УстановитьПараметр("УИД",			ИсходныйДокументСсылка.УникальныйИдентификатор());
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.АктВыполненныхРабот) КАК Ссылка,
	|	ДоговорыКонтрагентов.Ссылка КАК ДоговорКонтрагента,
	|	ДоговорыКонтрагентов.ОсновнойЦФО КАК ЦФО,
	|	ДоговорыКонтрагентов.ОсновнойПроект КАК Проект,
	|	ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение КАК СтатьяБюджета,
	|	ДоговорыКонтрагентов.АналитикаИсполнение1 КАК Аналитика1,
	|	ДоговорыКонтрагентов.АналитикаИсполнение2 КАК Аналитика2,
	|	ДоговорыКонтрагентов.АналитикаИсполнение3 КАК Аналитика3,
	|	ДоговорыКонтрагентов.АналитикаИсполнение4 КАК Аналитика4,
	|	ДоговорыКонтрагентов.АналитикаИсполнение5 КАК Аналитика5,
	|	ДоговорыКонтрагентов.АналитикаИсполнение6 КАК Аналитика6,
	|	Суммы.ОбъектРасчетов.Объект КАК ОбъектРасчетов,
	|	Суммы.Валюта КАК Валюта,
	|	Суммы.СуммаБезНДС + Суммы.СуммаНДС КАК Сумма,
	|	Суммы.СуммаБезНДС КАК СуммаБезНДС,
	|	Суммы.СуммаНДС КАК СуммаНДС,
	|	Суммы.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	Суммы.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов - Суммы.СуммаНДСВзаиморасчетов КАК СуммаБезНДСВзаиморасчетов,
	|	АктВыполненныхРаботУслуги.Количество КАК Количество,
	|	ВЫБОР
	|		КОГДА ОтражатьВБДРРеализациюКакПриход.Значение = ИСТИНА
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход)
	|	КОНЕЦ КАК ПриходРасход
	|ПОМЕСТИТЬ ВТ_СуммыДокумента
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.АктВыполненныхРабот.Услуги КАК АктВыполненныхРаботУслуги
	|		ПО Суммы.Регистратор = АктВыполненныхРаботУслуги.Ссылка
	|			И Суммы.ИдентификаторСтроки = АктВыполненныхРаботУслуги.ИдентификаторСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	|		ПО (ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.АктВыполненныхРабот).Договор = ДоговорыКонтрагентов.Ссылка),
	|	Константа.ОтражатьВБДРРеализациюКакПриход КАК ОтражатьВБДРРеализациюКакПриход
	|ГДЕ
	|	Суммы.Регистратор = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ИмяМетаданных КАК ИмяМетаданных,
	|	&УИД КАК УИД,
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.РеализацияКлиенту) КАК ВидОперации,
	|	Документ.Дата КАК Дата,
	|	Документ.Организация КАК Организация,
	|	Документ.Контрагент КАК Контрагент,
	|	Документ.Договор КАК ДоговорКонтрагента,
	|	Документ.Номер КАК НомерИсходногоДокумента,
	|	Документ.Дата КАК ДатаИсходногоДокумента,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаДокумента,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаДокумента,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход) КАК ПриходРасход,
	|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности) КАК НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ЦФО КАК ЦФО,
	|	ВТ_СуммыДокумента.Проект КАК Проект
	|ИЗ
	|	Документ.АктВыполненныхРабот КАК Документ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|		ПО (Документ.Ссылка = &Ссылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Документ.Дата,
	|	ВТ_СуммыДокумента.Валюта,
	|	Документ.Договор,
	|	Документ.Номер,
	|	Документ.Организация,
	|	Документ.Контрагент,
	|	ВТ_СуммыДокумента.ЦФО,
	|	ВТ_СуммыДокумента.Проект,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	Документ.Дата
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
	|	ВТ_СуммыДокумента.СтатьяБюджета КАК СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	ВТ_СуммыДокумента.ПриходРасход КАК ПриходРасход
	|ИЗ
	|	ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_СуммыДокумента.ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов,
	|	ВТ_СуммыДокумента.ПриходРасход
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДоходовИРасходов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество,
	|	СуммыДокумента.ПриходРасход КАК ПриходРасход
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов,
	|	СуммыДокумента.ПриходРасход";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	Если РезультатЗапроса[1].Пустой() Тогда
		Возврат неопределено; // Стандартное заполнение
	КонецЕсли;
	
	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("Шапка", РезультатЗапроса[1].Выгрузить());
	Результат.Вставить("Взаиморасчеты", РезультатЗапроса[2].Выгрузить());
	Результат.Вставить("БюджетДоходовИРасходов", РезультатЗапроса[3].Выгрузить());
	
	// Массив ключевых реквизитов
	КлючевыеРеквизиты = Новый Массив;
	КлючевыеРеквизиты.Добавить("ИмяМетаданных");
	КлючевыеРеквизиты.Добавить("УИД");
	КлючевыеРеквизиты.Добавить("ВидОперации");
	КлючевыеРеквизиты.Добавить("Организация");
	КлючевыеРеквизиты.Добавить("Контрагент");
	КлючевыеРеквизиты.Добавить("СуммаДокумента");
	КлючевыеРеквизиты.Добавить("ВалютаДокумента");
	
	Результат.Вставить("КлючевыеРеквизиты", КлючевыеРеквизиты);
	
	Возврат Результат;
	
КонецФункции

// ВозвратТоваровОтКлиента
Функция ВыполнитьЗаполнение_ВозвратТоваровОтКлиента(ИсходныйДокументСсылка)
	
	// Получение данных
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", ИсходныйДокументСсылка);
	Запрос.УстановитьПараметр("ИмяМетаданных",	ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	Запрос.УстановитьПараметр("УИД",			ИсходныйДокументСсылка.УникальныйИдентификатор());
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ВозвратТоваровОтКлиента) КАК Ссылка,
	|	ДоговорыКонтрагентов.Ссылка КАК ДоговорКонтрагента,
	|	ДоговорыКонтрагентов.ОсновнойЦФО КАК ЦФО,
	|	ДоговорыКонтрагентов.ОсновнойПроект КАК Проект,
	|	ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение КАК СтатьяБюджета,
	|	ДоговорыКонтрагентов.АналитикаИсполнение1 КАК Аналитика1,
	|	ДоговорыКонтрагентов.АналитикаИсполнение2 КАК Аналитика2,
	|	ДоговорыКонтрагентов.АналитикаИсполнение3 КАК Аналитика3,
	|	ДоговорыКонтрагентов.АналитикаИсполнение4 КАК Аналитика4,
	|	ДоговорыКонтрагентов.АналитикаИсполнение5 КАК Аналитика5,
	|	ДоговорыКонтрагентов.АналитикаИсполнение6 КАК Аналитика6,
	|	Суммы.ОбъектРасчетов.Объект КАК ОбъектРасчетов,
	|	Суммы.Валюта КАК Валюта,
	|	Суммы.СуммаБезНДС + Суммы.СуммаНДС КАК Сумма,
	|	Суммы.СуммаБезНДС КАК СуммаБезНДС,
	|	Суммы.СуммаНДС КАК СуммаНДС,
	|	Суммы.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	Суммы.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов - Суммы.СуммаНДСВзаиморасчетов КАК СуммаБезНДСВзаиморасчетов,
	|	ВозвратТоваровОтКлиентаТовары.Количество КАК Количество,
	|	ВЫБОР
	|		КОГДА ОтражатьВБДРРеализациюКакПриход.Значение = ИСТИНА
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход)
	|	КОНЕЦ КАК ПриходРасход
	|ПОМЕСТИТЬ ВТ_СуммыДокумента
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ВозвратТоваровОтКлиента.Товары КАК ВозвратТоваровОтКлиентаТовары
	|		ПО Суммы.Регистратор = ВозвратТоваровОтКлиентаТовары.Ссылка
	|			И Суммы.ИдентификаторСтроки = ВозвратТоваровОтКлиентаТовары.ИдентификаторСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	|		ПО (ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ВозвратТоваровОтКлиента).Договор = ДоговорыКонтрагентов.Ссылка),
	|	Константа.ОтражатьВБДРРеализациюКакПриход КАК ОтражатьВБДРРеализациюКакПриход
	|ГДЕ
	|	Суммы.Регистратор = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ИмяМетаданных КАК ИмяМетаданных,
	|	&УИД КАК УИД,
	|	Документ.ХозяйственнаяОперация КАК ВидОперации,
	|	Документ.Дата КАК Дата,
	|	Документ.Организация КАК Организация,
	|	Документ.Контрагент КАК Контрагент,
	|	Документ.Договор КАК ДоговорКонтрагента,
	|	Документ.Номер КАК НомерИсходногоДокумента,
	|	Документ.Дата КАК ДатаИсходногоДокумента,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаДокумента,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаДокумента,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход) КАК ПриходРасход,
	|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности) КАК НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ЦФО КАК ЦФО,
	|	ВТ_СуммыДокумента.Проект КАК Проект
	|ИЗ
	|	Документ.ВозвратТоваровОтКлиента КАК Документ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|		ПО (Документ.Ссылка = &Ссылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Документ.ХозяйственнаяОперация,
	|	Документ.Дата,
	|	ВТ_СуммыДокумента.Валюта,
	|	Документ.Договор,
	|	Документ.Номер,
	|	Документ.Организация,
	|	Документ.Контрагент,
	|	ВТ_СуммыДокумента.ЦФО,
	|	ВТ_СуммыДокумента.Проект,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	Документ.Дата
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
	|	ВТ_СуммыДокумента.СтатьяБюджета КАК СтатьяБюджета,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаВзаиморасчетов,
	|	ВТ_СуммыДокумента.ПриходРасход КАК ПриходРасход
	|ИЗ
	|	ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_СуммыДокумента.ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	ВТ_СуммыДокумента.Валюта,
	|	ВТ_СуммыДокумента.ПриходРасход
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДоходовИРасходов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество,
	|	СуммыДокумента.ПриходРасход КАК ПриходРасход
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов,
	|	СуммыДокумента.ПриходРасход";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	Если РезультатЗапроса[1].Пустой() Тогда
		Возврат неопределено; // Стандартное заполнение
	КонецЕсли;
	
	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("Шапка", РезультатЗапроса[1].Выгрузить());
	Результат.Вставить("Взаиморасчеты", РезультатЗапроса[2].Выгрузить());
	Результат.Вставить("БюджетДоходовИРасходов", РезультатЗапроса[3].Выгрузить());
	
	// Массив ключевых реквизитов
	КлючевыеРеквизиты = Новый Массив;
	КлючевыеРеквизиты.Добавить("ИмяМетаданных");
	КлючевыеРеквизиты.Добавить("УИД");
	КлючевыеРеквизиты.Добавить("ВидОперации");
	КлючевыеРеквизиты.Добавить("Организация");
	КлючевыеРеквизиты.Добавить("Контрагент");
	КлючевыеРеквизиты.Добавить("СуммаДокумента");
	КлючевыеРеквизиты.Добавить("ВалютаДокумента");
	
	Результат.Вставить("КлючевыеРеквизиты", КлючевыеРеквизиты);
	
	Возврат Результат;
	
КонецФункции

// Отчет комиссионера
Функция ВыполнитьЗаполнение_ОтчетКомиссионера(ИсходныйДокументСсылка)
	
	// Получение данных
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка", ИсходныйДокументСсылка);
	Запрос.УстановитьПараметр("ИмяМетаданных",	ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	Запрос.УстановитьПараметр("УИД",			ИсходныйДокументСсылка.УникальныйИдентификатор());
	Запрос.УстановитьПараметр("ПустаяСтатьяДоходовРасходов", КэшируемыеПроцедурыОПК.ПустаяСтатьяДоходовИРасходов());
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСПоставщиком) КАК ТипРасчетов,
	|	ВЫБОР
	|		КОГДА ОтражатьВБДРРеализациюКакПриход.Значение = ИСТИНА
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход)
	|	КОНЕЦ КАК ПриходРасход
	|ПОМЕСТИТЬ ВТ_ПриходРасход
	|ИЗ
	|	Константа.ОтражатьВБДРРеализациюКакПриход КАК ОтражатьВБДРРеализациюКакПриход
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСКлиентом),
	|	ВЫБОР
	|		КОГДА ОтражатьВБДРРеализациюКакПриход.Значение = ИСТИНА
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход)
	|	КОНЕЦ
	|ИЗ
	|	Константа.ОтражатьВБДРРеализациюКакПриход КАК ОтражатьВБДРРеализациюКакПриход
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ОтчетКомиссионера) КАК Ссылка,
	|	ДоговорыКонтрагентов.Ссылка КАК ДоговорКонтрагента,
	|	ДоговорыКонтрагентов.ОсновнойЦФО КАК ЦФО,
	|	ДоговорыКонтрагентов.ОсновнойПроект КАК Проект,
	|	ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение КАК СтатьяБюджета,
	|	ДоговорыКонтрагентов.АналитикаИсполнение1 КАК Аналитика1,
	|	ДоговорыКонтрагентов.АналитикаИсполнение2 КАК Аналитика2,
	|	ДоговорыКонтрагентов.АналитикаИсполнение3 КАК Аналитика3,
	|	ДоговорыКонтрагентов.АналитикаИсполнение4 КАК Аналитика4,
	|	ДоговорыКонтрагентов.АналитикаИсполнение5 КАК Аналитика5,
	|	ДоговорыКонтрагентов.АналитикаИсполнение6 КАК Аналитика6,
	|	Суммы.ОбъектРасчетов.Объект КАК ОбъектРасчетов,
	|	Суммы.Валюта КАК Валюта,
	|	Суммы.СуммаБезНДС + Суммы.СуммаНДС КАК Сумма,
	|	Суммы.СуммаБезНДС КАК СуммаБезНДС,
	|	Суммы.СуммаНДС КАК СуммаНДС,
	|	Суммы.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов - Суммы.СуммаНДСВзаиморасчетов КАК СуммаБезНДСВзаиморасчетов,
	|	Суммы.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	ЕСТЬNULL(ДокументТовары.Количество, 0) КАК Количество,
	|	Суммы.ТипРасчетов КАК ТипРасчетов,
	|	ИСТИНА КАК ОтражатьВБюджетах,
	|	ВЫБОР
	|		КОГДА Суммы.ТипРасчетов = ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСПоставщиком)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности)
	|		КОГДА Суммы.ТипРасчетов = ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСКлиентом)
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.ПустаяСсылка)
	|	КОНЕЦ КАК НаправлениеВзаиморасчетов
	|ПОМЕСТИТЬ ВТ_СуммыДокумента
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ОтчетКомиссионера.Товары КАК ДокументТовары
	|		ПО Суммы.Регистратор = ДокументТовары.Ссылка
	|			И Суммы.ИдентификаторСтроки = ДокументТовары.ИдентификаторСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	|		ПО (ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ОтчетКомиссионера).Договор = ДоговорыКонтрагентов.Ссылка)
	|ГДЕ
	|	Суммы.Регистратор = &Ссылка
	|	И Суммы.ОтражаетсяВРасчетах = ИСТИНА
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ОтчетКомиссионера),
	|	ДоговорыКонтрагентов.Ссылка,
	|	ДоговорыКонтрагентов.ОсновнойЦФО,
	|	ДоговорыКонтрагентов.ОсновнойПроект,
	|	ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение,
	|	ДоговорыКонтрагентов.АналитикаИсполнение1,
	|	ДоговорыКонтрагентов.АналитикаИсполнение2,
	|	ДоговорыКонтрагентов.АналитикаИсполнение3,
	|	ДоговорыКонтрагентов.АналитикаИсполнение4,
	|	ДоговорыКонтрагентов.АналитикаИсполнение5,
	|	ДоговорыКонтрагентов.АналитикаИсполнение6,
	|	Суммы.ОбъектРасчетов.Объект,
	|	Суммы.Валюта,
	|	Документ.СуммаВознаграждения,
	|	Документ.СуммаВознаграждения - Документ.СуммаНДСВознаграждения,
	|	Документ.СуммаНДСВознаграждения,
	|	Суммы.ВалютаВзаиморасчетов,
	|	Документ.СуммаВознаграждения,
	|	Документ.СуммаВознаграждения - Документ.СуммаНДСВознаграждения,
	|	Документ.СуммаНДСВознаграждения,
	|	0,
	|	Направления.ТипРасчетов,
	|	Направления.ОтражатьВБюджетах,
	|	Направления.НаправлениеВзаиморасчетов
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ОтчетКомиссионера КАК Документ
	|		ПО Суммы.Регистратор = Документ.Ссылка
	|			И (Документ.УдержатьВознаграждение = ИСТИНА)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	|		ПО (ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ОтчетКомиссионера).Договор = ДоговорыКонтрагентов.Ссылка),
	|	(ВЫБРАТЬ
	|		ИСТИНА КАК ОтражатьВБюджетах,
	|		ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСПоставщиком) КАК ТипРасчетов,
	|		ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности) КАК НаправлениеВзаиморасчетов
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ЛОЖЬ,
	|		ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСПоставщиком),
	|		ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ЛОЖЬ,
	|		ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСКлиентом),
	|		ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности)) КАК Направления
	|ГДЕ
	|	Суммы.Регистратор = &Ссылка
	|	И Суммы.ОтражаетсяВРасчетах = ИСТИНА
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ИмяМетаданных КАК ИмяМетаданных,
	|	&УИД КАК УИД,
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПередачаНаКомиссию) КАК ВидОперации,
	|	Документ.Дата КАК Дата,
	|	Документ.Организация КАК Организация,
	|	Документ.Контрагент КАК Контрагент,
	|	Документ.Договор КАК ДоговорКонтрагента,
	|	Документ.Номер КАК НомерИсходногоДокумента,
	|	Документ.Дата КАК ДатаИсходногоДокумента,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаДокумента,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаДокумента,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход) КАК ПриходРасход,
	|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности) КАК НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ЦФО КАК ЦФО,
	|	ВТ_СуммыДокумента.Проект КАК Проект
	|ИЗ
	|	Документ.ОтчетКомиссионера КАК Документ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|		ПО (Документ.Ссылка = &Ссылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_СуммыДокумента.Валюта,
	|	Документ.Договор,
	|	Документ.Номер,
	|	Документ.Организация,
	|	Документ.Контрагент,
	|	Документ.Дата,
	|	ВТ_СуммыДокумента.ЦФО,
	|	ВТ_СуммыДокумента.Проект,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	Документ.Дата
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СуммыДокумента.НаправлениеВзаиморасчетов КАК НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
	|	ВЫБОР
	|		КОГДА ВТ_СуммыДокумента.ТипРасчетов = ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСКлиентом)
	|				И ВТ_СуммыДокумента.ОтражатьВБюджетах = ИСТИНА
	|			ТОГДА ВТ_СуммыДокумента.СтатьяБюджета
	|		ИНАЧЕ &ПустаяСтатьяДоходовРасходов
	|	КОНЕЦ КАК СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов
	|ИЗ
	|	ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_СуммыДокумента.НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов,
	|	ВТ_СуммыДокумента.ТипРасчетов,
	|	ВТ_СуммыДокумента.ОтражатьВБюджетах
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ПриходРасход.ПриходРасход КАК ПриходРасход,
	|	ВЫБОР
	|		КОГДА СуммыДокумента.ТипРасчетов = ЗНАЧЕНИЕ(Перечисление.ТипыРасчетовСПартнерами.РасчетыСПоставщиком)
	|			ТОГДА &ПустаяСтатьяДоходовРасходов
	|		ИНАЧЕ СуммыДокумента.СтатьяБюджета
	|	КОНЕЦ КАК СтатьяДоходовИРасходов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_ПриходРасход КАК ВТ_ПриходРасход
	|		ПО (ВТ_ПриходРасход.ТипРасчетов = СуммыДокумента.ТипРасчетов)
	|ГДЕ
	|	СуммыДокумента.ОтражатьВБюджетах = ИСТИНА
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_ПриходРасход.ПриходРасход,
	|	СуммыДокумента.ТипРасчетов,
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	Если РезультатЗапроса[2].Пустой() Тогда
		Возврат неопределено; // Стандартное заполнение
	КонецЕсли;
	
	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("Шапка", РезультатЗапроса[2].Выгрузить());
	Результат.Вставить("Взаиморасчеты", РезультатЗапроса[3].Выгрузить());
	Результат.Вставить("БюджетДоходовИРасходов", РезультатЗапроса[4].Выгрузить());
	
	// Массив ключевых реквизитов
	КлючевыеРеквизиты = Новый Массив;
	КлючевыеРеквизиты.Добавить("ИмяМетаданных");
	КлючевыеРеквизиты.Добавить("УИД");
	КлючевыеРеквизиты.Добавить("ВидОперации");
	КлючевыеРеквизиты.Добавить("Организация");
	КлючевыеРеквизиты.Добавить("Контрагент");
	КлючевыеРеквизиты.Добавить("СуммаДокумента");
	КлючевыеРеквизиты.Добавить("ВалютаДокумента");
	
	Результат.Вставить("КлючевыеРеквизиты", КлючевыеРеквизиты);
	
	Возврат Результат;
	
КонецФункции

Функция ВыполнитьЗаполнение_ДенежныеДокументы(ИсходныйДокументСсылка)
	
	Запросы = Новый Массив;
	
	// 0. получение данных по документу
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	СуммыДокументовВВалютахУчета.Регистратор КАК Ссылка,
	|	СуммыДокументовВВалютахУчета.ИдентификаторСтроки КАК ИдентификаторСтроки,
	|	СуммыДокументовВВалютахУчета.ОтражаетсяВРасчетах КАК ОтражаетсяВРасчетах,
	|	СуммыДокументовВВалютахУчета.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокументовВВалютахУчета.Валюта КАК Валюта,
	|	СуммыДокументовВВалютахУчета.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СуммыДокументовВВалютахУчета.СуммаБезНДС + СуммыДокументовВВалютахУчета.СуммаБезНДС КАК Сумма,
	|	СуммыДокументовВВалютахУчета.СуммаБезНДС КАК СуммаБезНДС,
	|	СуммыДокументовВВалютахУчета.СуммаНДС КАК СуммаНДС,
	|	СуммыДокументовВВалютахУчета.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	СуммыДокументовВВалютахУчета.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов
	|ПОМЕСТИТЬ ВТ_СУММЫ_ДОКУМЕНТОВ
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК СуммыДокументовВВалютахУчета
	|ГДЕ
	|	СуммыДокументовВВалютахУчета.Регистратор = &Ссылка";
	
	ТекстЗапроса = ТекстЗапроса + СтрШаблон("
	|	И СуммыДокументовВВалютахУчета.Регистратор ССЫЛКА %1", ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	
	Запросы.Добавить(ТекстЗапроса);
	
	// 1. Обработка документа
	ТипИсходныйДокумент = ТипЗнч(ИсходныйДокументСсылка);
	Если ТипИсходныйДокумент = Тип("ДокументСсылка.СписаниеБезналичныхДенежныхСредств") Тогда
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка КАК Ссылка,
		|	Документ.ХозяйственнаяОперация КАК ВидОперации,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки КАК ИдентификаторСтроки,
		|	ВЫБОР
		|		КОГДА Документ.ПроведеноБанком
		|			ТОГДА Документ.ДатаПроведенияБанком
		|		ИНАЧЕ Документ.Дата
		|	КОНЕЦ КАК Дата,
		|	Документ.Номер КАК НомерИсходногоДокумента,
		|	Документ.Дата КАК ДатаИсходногоДокумента,
		|	Документ.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах КАК ОтражаетсяВРасчетах,
		|	Документ.Организация КАК Организация,
		|	Документ.Контрагент КАК Контрагент,
		|	НЕОПРЕДЕЛЕНО КАК Договор,
		|	НЕОПРЕДЕЛЕНО КАК ДоговорКредитаДепозита,
		|	НЕОПРЕДЕЛЕНО КАК ДоговорАренды,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов КАК ОбъектРасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Валюта КАК Валюта,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаБезНДС КАК СуммаБезНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДС КАК СуммаНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
		|	Документ.СтатьяДвиженияДенежныхСредств КАК СтатьяДвиженияДенежныхСредств,
		|	Документ.Аналитика1 КАК Аналитика1,
		|	Документ.Аналитика2 КАК Аналитика2,
		|	Документ.Аналитика3 КАК Аналитика3,
		|	Документ.Аналитика4 КАК Аналитика4,
		|	Документ.Аналитика5 КАК Аналитика5,
		|	Документ.Аналитика6 КАК Аналитика6,
		|	Документ.ЦФО КАК ЦФО,
		|	Документ.Проект КАК Проект,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход) КАК ПриходРасход,
		|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности) КАК НаправлениеВзаиморасчетов,
		|	Документ.Ссылка.БанковскийСчет КАК БанковскийСчетКасса,
		|	НЕОПРЕДЕЛЕНО КАК ТипПлатежаПоАренде,
		|	НЕОПРЕДЕЛЕНО КАК ТипСуммыКредитаДепозита,
		|	Документ.ДокументПланирования КАК ДокументПланирования,
		|	Документ.ИдентификаторПозиции КАК ИдентификаторПозиции,
		|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
		|	1 КАК КурсВзаиморасчетов,
		|	1 КАК КратностьВзаиморасчетов
		|ПОМЕСТИТЬ ВТ_ДанныеДокументов
		|ИЗ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ КАК ВТ_СУММЫ_ДОКУМЕНТОВ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СписаниеБезналичныхДенежныхСредств КАК Документ
		|		ПО (ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка ССЫЛКА Документ.СписаниеБезналичныхДенежныхСредств)
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка = Документ.Ссылка
		|			И (ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки = """")
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка,
		|	РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация КАК ВидОперации,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ПроведеноБанком
		|			ТОГДА РасшифровкаПлатежа.Ссылка.ДатаПроведенияБанком
		|		ИНАЧЕ РасшифровкаПлатежа.Ссылка.Дата
		|	КОНЕЦ,
		|	РасшифровкаПлатежа.Ссылка.Номер,
		|	РасшифровкаПлатежа.Ссылка.Дата,
		|	РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах,
		|	РасшифровкаПлатежа.Ссылка.Организация,
		|	РасшифровкаПлатежа.Ссылка.Контрагент,
		|	ВЫБОР
		|		КОГДА ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах = ИСТИНА
		|			ТОГДА ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов.Договор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ,
		|	РасшифровкаПлатежа.ДоговорКредитаДепозита,
		|	РасшифровкаПлатежа.ДоговорАренды,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Валюта,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ВалютаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаБезНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДСВзаиморасчетов,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутренняяПередачаДенежныхСредств)
		|			ИЛИ РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КонвертацияВалюты)
		|			ТОГДА РасшифровкаПлатежа.Ссылка.СтатьяДвиженияДенежныхСредств
		|		ИНАЧЕ РасшифровкаПлатежа.СтатьяДвиженияДенежныхСредств
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутренняяПередачаДенежныхСредств)
		|			ИЛИ РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КонвертацияВалюты)
		|			ТОГДА РасшифровкаПлатежа.Ссылка.Аналитика1
		|		ИНАЧЕ РасшифровкаПлатежа.Аналитика1
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутренняяПередачаДенежныхСредств)
		|			ИЛИ РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КонвертацияВалюты)
		|			ТОГДА РасшифровкаПлатежа.Ссылка.Аналитика2
		|		ИНАЧЕ РасшифровкаПлатежа.Аналитика2
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутренняяПередачаДенежныхСредств)
		|			ИЛИ РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КонвертацияВалюты)
		|			ТОГДА РасшифровкаПлатежа.Ссылка.Аналитика3
		|		ИНАЧЕ РасшифровкаПлатежа.Аналитика3
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутренняяПередачаДенежныхСредств)
		|			ИЛИ РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КонвертацияВалюты)
		|			ТОГДА РасшифровкаПлатежа.Ссылка.Аналитика4
		|		ИНАЧЕ РасшифровкаПлатежа.Аналитика4
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутренняяПередачаДенежныхСредств)
		|			ИЛИ РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КонвертацияВалюты)
		|			ТОГДА РасшифровкаПлатежа.Ссылка.Аналитика5
		|		ИНАЧЕ РасшифровкаПлатежа.Аналитика5
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВнутренняяПередачаДенежныхСредств)
		|			ИЛИ РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.КонвертацияВалюты)
		|			ТОГДА РасшифровкаПлатежа.Ссылка.Аналитика6
		|		ИНАЧЕ РасшифровкаПлатежа.Аналитика6
		|	КОНЕЦ,
		|	РасшифровкаПлатежа.ЦФО,
		|	РасшифровкаПлатежа.Проект,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход),
		|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности),
		|	РасшифровкаПлатежа.Ссылка.БанковскийСчет,
		|	РасшифровкаПлатежа.ТипПлатежаПоАренде,
		|	РасшифровкаПлатежа.ТипСуммыКредитаДепозита,
		|	РасшифровкаПлатежа.ДокументПланирования,
		|	РасшифровкаПлатежа.ИдентификаторПозиции,
		|	РасшифровкаПлатежа.ЭлементСтруктурыЗадолженности,
		|	РасшифровкаПлатежа.КурсЧислительВзаиморасчетов,
		|	РасшифровкаПлатежа.КурсЗнаменательВзаиморасчетов
		|ИЗ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ КАК ВТ_СУММЫ_ДОКУМЕНТОВ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.СписаниеБезналичныхДенежныхСредств.РасшифровкаПлатежа КАК РасшифровкаПлатежа
		|		ПО (ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка ССЫЛКА Документ.СписаниеБезналичныхДенежныхСредств)
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка = РасшифровкаПлатежа.Ссылка
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки = РасшифровкаПлатежа.ИдентификаторСтроки
		|			И (ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки <> """")";
	ИначеЕсли ТипИсходныйДокумент = Тип("ДокументСсылка.ПоступлениеБезналичныхДенежныхСредств") Тогда
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка КАК Ссылка,
		|	Документ.ХозяйственнаяОперация КАК ВидОперации,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки КАК ИдентификаторСтроки,
		|	ВЫБОР
		|		КОГДА Документ.ПроведеноБанком
		|			ТОГДА Документ.ДатаПроведенияБанком
		|		ИНАЧЕ Документ.Дата
		|	КОНЕЦ КАК Дата,
		|	Документ.Номер КАК НомерИсходногоДокумента,
		|	Документ.Дата КАК ДатаИсходногоДокумента,
		|	Документ.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах КАК ОтражаетсяВРасчетах,
		|	Документ.Организация КАК Организация,
		|	Документ.Контрагент КАК Контрагент,
		|	НЕОПРЕДЕЛЕНО КАК Договор,
		|	НЕОПРЕДЕЛЕНО КАК ДоговорКредитаДепозита,
		|	НЕОПРЕДЕЛЕНО КАК ДоговорАренды,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов КАК ОбъектРасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Валюта КАК Валюта,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаБезНДС КАК СуммаБезНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДС КАК СуммаНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
		|	Документ.СтатьяДвиженияДенежныхСредств КАК СтатьяДвиженияДенежныхСредств,
		|	Документ.Аналитика1 КАК Аналитика1,
		|	Документ.Аналитика2 КАК Аналитика2,
		|	Документ.Аналитика3 КАК Аналитика3,
		|	Документ.Аналитика4 КАК Аналитика4,
		|	Документ.Аналитика5 КАК Аналитика5,
		|	Документ.Аналитика6 КАК Аналитика6,
		|	Документ.ЦФО КАК ЦФО,
		|	Документ.Проект КАК Проект,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход) КАК ПриходРасход,
		|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности) КАК НаправлениеВзаиморасчетов,
		|	Документ.Ссылка.БанковскийСчет КАК БанковскийСчетКасса,
		|	НЕОПРЕДЕЛЕНО КАК ТипПлатежаПоАренде,
		|	НЕОПРЕДЕЛЕНО КАК ТипСуммыКредитаДепозита,
		|	Документ.ДокументПланирования КАК ДокументПланирования,
		|	Документ.ИдентификаторПозиции КАК ИдентификаторПозиции,
		|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
		|	1 КАК КурсВзаиморасчетов,
		|	1 КАК КратностьВзаиморасчетов
		|ПОМЕСТИТЬ ВТ_ДанныеДокументов
		|ИЗ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ КАК ВТ_СУММЫ_ДОКУМЕНТОВ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПоступлениеБезналичныхДенежныхСредств КАК Документ
		|		ПО (ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка ССЫЛКА Документ.ПоступлениеБезналичныхДенежныхСредств)
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка = Документ.Ссылка
		|			И (ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки = """")
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка,
		|	РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация КАК ВидОперации,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки,
		|	ВЫБОР
		|		КОГДА РасшифровкаПлатежа.Ссылка.ПроведеноБанком
		|			ТОГДА РасшифровкаПлатежа.Ссылка.ДатаПроведенияБанком
		|		ИНАЧЕ РасшифровкаПлатежа.Ссылка.Дата
		|	КОНЕЦ,
		|	РасшифровкаПлатежа.Ссылка.Номер,
		|	РасшифровкаПлатежа.Ссылка.Дата,
		|	РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах,
		|	РасшифровкаПлатежа.Ссылка.Организация,
		|	РасшифровкаПлатежа.Ссылка.Контрагент,
		|	ВЫБОР
		|		КОГДА ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах = ИСТИНА
		|			ТОГДА ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов.Договор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ,
		|	РасшифровкаПлатежа.ДоговорКредитаДепозита,
		|	НЕОПРЕДЕЛЕНО,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Валюта,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ВалютаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаБезНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДСВзаиморасчетов,
		|	РасшифровкаПлатежа.СтатьяДвиженияДенежныхСредств,
		|	РасшифровкаПлатежа.Аналитика1,
		|	РасшифровкаПлатежа.Аналитика2,
		|	РасшифровкаПлатежа.Аналитика3,
		|	РасшифровкаПлатежа.Аналитика4,
		|	РасшифровкаПлатежа.Аналитика5,
		|	РасшифровкаПлатежа.Аналитика6,
		|	РасшифровкаПлатежа.ЦФО,
		|	РасшифровкаПлатежа.Проект,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход),
		|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности),
		|	РасшифровкаПлатежа.Ссылка.БанковскийСчет,
		|	НЕОПРЕДЕЛЕНО,
		|	РасшифровкаПлатежа.ТипСуммыКредитаДепозита,
		|	РасшифровкаПлатежа.ДокументПланирования,
		|	РасшифровкаПлатежа.ИдентификаторПозиции,
		|	РасшифровкаПлатежа.ЭлементСтруктурыЗадолженности,
		|	РасшифровкаПлатежа.КурсЧислительВзаиморасчетов,
		|	РасшифровкаПлатежа.КурсЗнаменательВзаиморасчетов
		|ИЗ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ КАК ВТ_СУММЫ_ДОКУМЕНТОВ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПоступлениеБезналичныхДенежныхСредств.РасшифровкаПлатежа КАК РасшифровкаПлатежа
		|		ПО (ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка ССЫЛКА Документ.ПоступлениеБезналичныхДенежныхСредств)
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка = РасшифровкаПлатежа.Ссылка
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки = РасшифровкаПлатежа.ИдентификаторСтроки
		|			И (ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки <> """")";
	ИначеЕсли ТипИсходныйДокумент = Тип("ДокументСсылка.РасходныйКассовыйОрдер") Тогда
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка КАК Ссылка,
		|	Документ.ХозяйственнаяОперация КАК ВидОперации,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки КАК ИдентификаторСтроки,
		|	Документ.Дата КАК Дата,
		|	Документ.Номер КАК НомерИсходногоДокумента,
		|	Документ.Дата КАК ДатаИсходногоДокумента,
		|	Документ.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах КАК ОтражаетсяВРасчетах,
		|	Документ.Организация КАК Организация,
		|	Документ.Контрагент КАК Контрагент,
		|	НЕОПРЕДЕЛЕНО КАК Договор,
		|	НЕОПРЕДЕЛЕНО КАК ДоговорКредитаДепозита,
		|	НЕОПРЕДЕЛЕНО КАК ДоговорАренды,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов КАК ОбъектРасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Валюта КАК Валюта,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаБезНДС КАК СуммаБезНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДС КАК СуммаНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
		|	Документ.СтатьяДвиженияДенежныхСредств КАК СтатьяДвиженияДенежныхСредств,
		|	Документ.Аналитика1 КАК Аналитика1,
		|	Документ.Аналитика2 КАК Аналитика2,
		|	Документ.Аналитика3 КАК Аналитика3,
		|	Документ.Аналитика4 КАК Аналитика4,
		|	Документ.Аналитика5 КАК Аналитика5,
		|	Документ.Аналитика6 КАК Аналитика6,
		|	Документ.ЦФО КАК ЦФО,
		|	Документ.Проект КАК Проект,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход) КАК ПриходРасход,
		|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности) КАК НаправлениеВзаиморасчетов,
		|	Документ.Касса КАК БанковскийСчетКасса,
		|	НЕОПРЕДЕЛЕНО КАК ТипПлатежаПоАренде,
		|	НЕОПРЕДЕЛЕНО КАК ТипСуммыКредитаДепозита,
		|	Документ.ДокументПланирования КАК ДокументПланирования,
		|	Документ.ИдентификаторПозиции КАК ИдентификаторПозиции,
		|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
		|	1 КАК КурсВзаиморасчетов,
		|	1 КАК КратностьВзаиморасчетов
		|ПОМЕСТИТЬ ВТ_ДанныеДокументов
		|ИЗ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ КАК ВТ_СУММЫ_ДОКУМЕНТОВ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РасходныйКассовыйОрдер КАК Документ
		|		ПО (ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка ССЫЛКА Документ.РасходныйКассовыйОрдер)
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка = Документ.Ссылка
		|			И (ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки = """")
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка,
		|	РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация КАК ВидОперации,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки,
		|	РасшифровкаПлатежа.Ссылка.Дата,
		|	РасшифровкаПлатежа.Ссылка.Номер,
		|	РасшифровкаПлатежа.Ссылка.Дата,
		|	РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах,
		|	РасшифровкаПлатежа.Ссылка.Организация,
		|	РасшифровкаПлатежа.Ссылка.Контрагент,
		|	ВЫБОР
		|		КОГДА ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах = ИСТИНА
		|			ТОГДА ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов.Договор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ,
		|	РасшифровкаПлатежа.ДоговорКредитаДепозита,
		|	РасшифровкаПлатежа.ДоговорАренды,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Валюта,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ВалютаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаБезНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДСВзаиморасчетов,
		|	РасшифровкаПлатежа.СтатьяДвиженияДенежныхСредств,
		|	РасшифровкаПлатежа.Аналитика1,
		|	РасшифровкаПлатежа.Аналитика2,
		|	РасшифровкаПлатежа.Аналитика3,
		|	РасшифровкаПлатежа.Аналитика4,
		|	РасшифровкаПлатежа.Аналитика5,
		|	РасшифровкаПлатежа.Аналитика6,
		|	РасшифровкаПлатежа.ЦФО,
		|	РасшифровкаПлатежа.Проект,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход),
		|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УвеличениеЗадолженности),
		|	РасшифровкаПлатежа.Ссылка.Касса,
		|	РасшифровкаПлатежа.ТипПлатежаПоАренде,
		|	РасшифровкаПлатежа.ТипСуммыКредитаДепозита,
		|	РасшифровкаПлатежа.ДокументПланирования,
		|	РасшифровкаПлатежа.ИдентификаторПозиции,
		|	РасшифровкаПлатежа.ЭлементСтруктурыЗадолженности,
		|	РасшифровкаПлатежа.КурсЧислительВзаиморасчетов,
		|	РасшифровкаПлатежа.КурсЗнаменательВзаиморасчетов
		|ИЗ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ КАК ВТ_СУММЫ_ДОКУМЕНТОВ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.РасходныйКассовыйОрдер.РасшифровкаПлатежа КАК РасшифровкаПлатежа
		|		ПО (ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка ССЫЛКА Документ.РасходныйКассовыйОрдер)
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка = РасшифровкаПлатежа.Ссылка
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки = РасшифровкаПлатежа.ИдентификаторСтроки
		|			И (ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки <> """")";
	ИначеЕсли ТипИсходныйДокумент = Тип("ДокументСсылка.ПриходныйКассовыйОрдер") Тогда
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка КАК Ссылка,
		|	Документ.ХозяйственнаяОперация КАК ВидОперации,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки КАК ИдентификаторСтроки,
		|	Документ.Дата КАК Дата,
		|	Документ.Номер КАК НомерИсходногоДокумента,
		|	Документ.Дата КАК ДатаИсходногоДокумента,
		|	Документ.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах КАК ОтражаетсяВРасчетах,
		|	Документ.Организация КАК Организация,
		|	Документ.Контрагент КАК Контрагент,
		|	НЕОПРЕДЕЛЕНО КАК Договор,
		|	НЕОПРЕДЕЛЕНО КАК ДоговорКредитаДепозита,
		|	НЕОПРЕДЕЛЕНО КАК ДоговорАренды,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов КАК ОбъектРасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Валюта КАК Валюта,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаБезНДС КАК СуммаБезНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДС КАК СуммаНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
		|	Документ.СтатьяДвиженияДенежныхСредств КАК СтатьяДвиженияДенежныхСредств,
		|	Документ.Аналитика1 КАК Аналитика1,
		|	Документ.Аналитика2 КАК Аналитика2,
		|	Документ.Аналитика3 КАК Аналитика3,
		|	Документ.Аналитика4 КАК Аналитика4,
		|	Документ.Аналитика5 КАК Аналитика5,
		|	Документ.Аналитика6 КАК Аналитика6,
		|	Документ.ЦФО КАК ЦФО,
		|	Документ.Проект КАК Проект,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход) КАК ПриходРасход,
		|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности) КАК НаправлениеВзаиморасчетов,
		|	Документ.Касса КАК БанковскийСчетКасса,
		|	НЕОПРЕДЕЛЕНО КАК ТипПлатежаПоАренде,
		|	НЕОПРЕДЕЛЕНО КАК ТипСуммыКредитаДепозита,
		|	Документ.ДокументПланирования КАК ДокументПланирования,
		|	Документ.ИдентификаторПозиции КАК ИдентификаторПозиции,
		|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
		|	1 КАК КурсВзаиморасчетов,
		|	1 КАК КратностьВзаиморасчетов
		|ПОМЕСТИТЬ ВТ_ДанныеДокументов
		|ИЗ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ КАК ВТ_СУММЫ_ДОКУМЕНТОВ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПриходныйКассовыйОрдер КАК Документ
		|		ПО (ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка ССЫЛКА Документ.ПриходныйКассовыйОрдер)
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка = Документ.Ссылка
		|			И (ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки = """")
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка,
		|	РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация КАК ВидОперации,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки,
		|	РасшифровкаПлатежа.Ссылка.Дата,
		|	РасшифровкаПлатежа.Ссылка.Номер,
		|	РасшифровкаПлатежа.Ссылка.Дата,
		|	РасшифровкаПлатежа.Ссылка.ХозяйственнаяОперация,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах,
		|	РасшифровкаПлатежа.Ссылка.Организация,
		|	РасшифровкаПлатежа.Ссылка.Контрагент,
		|	ВЫБОР
		|		КОГДА ВТ_СУММЫ_ДОКУМЕНТОВ.ОтражаетсяВРасчетах = ИСТИНА
		|			ТОГДА ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов.Договор
		|		ИНАЧЕ НЕОПРЕДЕЛЕНО
		|	КОНЕЦ,
		|	РасшифровкаПлатежа.ДоговорКредитаДепозита,
		|	НЕОПРЕДЕЛЕНО,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ОбъектРасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.Валюта,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.ВалютаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаБезНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДС,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаВзаиморасчетов,
		|	ВТ_СУММЫ_ДОКУМЕНТОВ.СуммаНДСВзаиморасчетов,
		|	РасшифровкаПлатежа.СтатьяДвиженияДенежныхСредств,
		|	РасшифровкаПлатежа.Аналитика1,
		|	РасшифровкаПлатежа.Аналитика2,
		|	РасшифровкаПлатежа.Аналитика3,
		|	РасшифровкаПлатежа.Аналитика4,
		|	РасшифровкаПлатежа.Аналитика5,
		|	РасшифровкаПлатежа.Аналитика6,
		|	РасшифровкаПлатежа.ЦФО,
		|	РасшифровкаПлатежа.Проект,
		|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход),
		|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности),
		|	РасшифровкаПлатежа.Ссылка.Касса,
		|	НЕОПРЕДЕЛЕНО,
		|	РасшифровкаПлатежа.ТипСуммыКредитаДепозита,
		|	РасшифровкаПлатежа.ДокументПланирования,
		|	РасшифровкаПлатежа.ИдентификаторПозиции,
		|	РасшифровкаПлатежа.ЭлементСтруктурыЗадолженности,
		|	РасшифровкаПлатежа.КурсЧислительВзаиморасчетов,
		|	РасшифровкаПлатежа.КурсЗнаменательВзаиморасчетов
		|ИЗ
		|	ВТ_СУММЫ_ДОКУМЕНТОВ КАК ВТ_СУММЫ_ДОКУМЕНТОВ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПриходныйКассовыйОрдер.РасшифровкаПлатежа КАК РасшифровкаПлатежа
		|		ПО (ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка ССЫЛКА Документ.ПриходныйКассовыйОрдер)
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.Ссылка = РасшифровкаПлатежа.Ссылка
		|			И ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки = РасшифровкаПлатежа.ИдентификаторСтроки
		|			И (ВТ_СУММЫ_ДОКУМЕНТОВ.ИдентификаторСтроки <> """")";
	Иначе
		Возврат неопределено;
	КонецЕсли;
	
	Запросы.Добавить(ТекстЗапроса);
	
	// 2. Преобразование данных
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ВТ_ДанныеДокументов.Ссылка КАК Ссылка,
	|	ВТ_ДанныеДокументов.ВидОперации КАК ВидОперации,
	|	ВТ_ДанныеДокументов.Дата КАК Дата,
	|	ВТ_ДанныеДокументов.НомерИсходногоДокумента КАК НомерИсходногоДокумента,
	|	ВТ_ДанныеДокументов.ДатаИсходногоДокумента КАК ДатаИсходногоДокумента,
	|	ВТ_ДанныеДокументов.Организация КАК Организация,
	|	ВТ_ДанныеДокументов.Контрагент КАК Контрагент,
	|	ВТ_ДанныеДокументов.ХозяйственнаяОперация КАК ХозяйственнаяОперация,
	|	ВТ_ДанныеДокументов.БанковскийСчетКасса КАК БанковскийСчетКасса,
	|	ВТ_ДанныеДокументов.ПриходРасход КАК ПриходРасход,
	|	ВТ_ДанныеДокументов.ИдентификаторСтроки КАК ИдентификаторСтроки,
	|	ВЫБОР ВТ_ДанныеДокументов.ХозяйственнаяОперация
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеречислениеНаДепозиты)
	|			ТОГДА ИСТИНА
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыдачаЗаймов)
	|			ТОГДА ИСТИНА
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОплатаПоКредитам)
	|			ТОГДА ИСТИНА
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОплатаАрендодателю)
	|			ТОГДА ИСТИНА
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоКредитам)
	|			ТОГДА ИСТИНА
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоДепозитам)
	|			ТОГДА ИСТИНА
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоЗаймамВыданным)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ВТ_ДанныеДокументов.ОтражаетсяВРасчетах
	|	КОНЕЦ КАК ОтражаетсяВРасчетах,
	|	ВТ_ДанныеДокументов.НаправлениеВзаиморасчетов КАК НаправлениеВзаиморасчетов,
	|	ВЫБОР ВТ_ДанныеДокументов.ХозяйственнаяОперация
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеречислениеНаДепозиты)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорКредитаДепозита
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыдачаЗаймов)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорКредитаДепозита
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОплатаПоКредитам)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорКредитаДепозита
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоКредитам)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорКредитаДепозита
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоДепозитам)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорКредитаДепозита
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоЗаймамВыданным)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорКредитаДепозита
	|		КОГДА ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОплатаАрендодателю)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорАренды
	|		ИНАЧЕ ВТ_ДанныеДокументов.Договор
	|	КОНЕЦ КАК ДоговорКонтрагента,
	|	ВЫБОР
	|		КОГДА ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПеречислениеНаДепозиты)
	|				ИЛИ ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВыдачаЗаймов)
	|				ИЛИ ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОплатаПоКредитам)
	|				ИЛИ ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоКредитам)
	|				ИЛИ ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоДепозитам)
	|				ИЛИ ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствПоЗаймамВыданным)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорКредитаДепозита
	|		КОГДА ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОплатаАрендодателю)
	|			ТОГДА ВТ_ДанныеДокументов.ДоговорАренды
	|		КОГДА ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ОплатаДенежныхСредствВДругуюОрганизацию)
	|				ИЛИ ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратДенежныхСредствОтДругойОрганизации)
	|				ИЛИ ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ПоступлениеДенежныхСредствИзДругойОрганизации)
	|				ИЛИ ВТ_ДанныеДокументов.ХозяйственнаяОперация = ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.ВозвратДенежныхСредствВДругуюОрганизацию)
	|			ТОГДА ВТ_ДанныеДокументов.Договор
	|		ИНАЧЕ ВТ_ДанныеДокументов.ОбъектРасчетов.Объект
	|	КОНЕЦ КАК ОбъектРасчетов,
	|	ВТ_ДанныеДокументов.Валюта КАК Валюта,
	|	ВТ_ДанныеДокументов.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	ВТ_ДанныеДокументов.СуммаБезНДС КАК СуммаБезНДС,
	|	ВТ_ДанныеДокументов.СуммаНДС КАК СуммаНДС,
	|	ВТ_ДанныеДокументов.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	ВТ_ДанныеДокументов.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	ВТ_ДанныеДокументов.ЦФО КАК ЦФО,
	|	ВТ_ДанныеДокументов.Проект КАК Проект,
	|	ВТ_ДанныеДокументов.СтатьяДвиженияДенежныхСредств КАК СтатьяДвиженияДенежныхСредств,
	|	ВТ_ДанныеДокументов.Аналитика1 КАК Аналитика1,
	|	ВТ_ДанныеДокументов.Аналитика2 КАК Аналитика2,
	|	ВТ_ДанныеДокументов.Аналитика3 КАК Аналитика3,
	|	ВТ_ДанныеДокументов.Аналитика4 КАК Аналитика4,
	|	ВТ_ДанныеДокументов.Аналитика5 КАК Аналитика5,
	|	ВТ_ДанныеДокументов.Аналитика6 КАК Аналитика6,
	|	ВТ_ДанныеДокументов.ЭлементСтруктурыЗадолженности КАК ЭлементСтруктурыЗадолженности,
	|	ВТ_ДанныеДокументов.ДокументПланирования КАК ДокументПланирования,
	|	ВТ_ДанныеДокументов.ИдентификаторПозиции КАК ИдентификаторПозиции,
	|	ВТ_ДанныеДокументов.КурсВзаиморасчетов,
	|	ВТ_ДанныеДокументов.КратностьВзаиморасчетов
	|ПОМЕСТИТЬ ВТ_ПодготовленныеДанные
	|ИЗ
	|	ВТ_ДанныеДокументов КАК ВТ_ДанныеДокументов";
	Запросы.Добавить(ТекстЗапроса);
	
	// 3. Данные для заполнения ОФД
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	&ИмяМетаданных КАК ИмяМетаданных,
	|	&УИД КАК УИД,
	|	ВТ_ПодготовленныеДанные.ВидОперации КАК ВидОперации,
	|	ВТ_ПодготовленныеДанные.Ссылка КАК Ссылка,
	|	ВТ_ПодготовленныеДанные.Организация КАК Организация,
	|	ВТ_ПодготовленныеДанные.Контрагент КАК Контрагент,
	|	ВТ_ПодготовленныеДанные.БанковскийСчетКасса КАК БанковскийСчетКасса,
	|	ВТ_ПодготовленныеДанные.ПриходРасход КАК ПриходРасход,
	|	ВТ_ПодготовленныеДанные.НаправлениеВзаиморасчетов КАК НаправлениеВзаиморасчетов,
	|	ВТ_ПодготовленныеДанные.Валюта КАК ВалютаДокумента,
	|	СУММА(ВТ_ПодготовленныеДанные.СуммаБезНДС + ВТ_ПодготовленныеДанные.СуммаНДС) КАК СуммаДокумента,
	|	МАКСИМУМ(ВТ_ПодготовленныеДанные.Дата) КАК Дата,
	|	МАКСИМУМ(ВТ_ПодготовленныеДанные.НомерИсходногоДокумента) КАК НомерИсходногоДокумента,
	|	МАКСИМУМ(ВТ_ПодготовленныеДанные.ДатаИсходногоДокумента) КАК ДатаИсходногоДокумента,
	|	МАКСИМУМ(ВТ_ПодготовленныеДанные.ОтражаетсяВРасчетах) КАК ОтражатьВоВзаиморасчетах
	|ИЗ
	|	ВТ_ПодготовленныеДанные КАК ВТ_ПодготовленныеДанные
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_ПодготовленныеДанные.ВидОперации,
	|	ВТ_ПодготовленныеДанные.Ссылка,
	|	ВТ_ПодготовленныеДанные.Организация,
	|	ВТ_ПодготовленныеДанные.Контрагент,
	|	ВТ_ПодготовленныеДанные.БанковскийСчетКасса,
	|	ВТ_ПодготовленныеДанные.ПриходРасход,
	|	ВТ_ПодготовленныеДанные.НаправлениеВзаиморасчетов,
	|	ВТ_ПодготовленныеДанные.Валюта
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ПодготовленныеДанные.Ссылка КАК Ссылка,
	|	ВТ_ПодготовленныеДанные.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_ПодготовленныеДанные.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ВТ_ПодготовленныеДанные.ЭлементСтруктурыЗадолженности КАК ЭлементСтруктурыЗадолженности,
	|	ВТ_ПодготовленныеДанные.СтатьяДвиженияДенежныхСредств КАК СтатьяБюджета,
	|	ВТ_ПодготовленныеДанные.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_ПодготовленныеДанные.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов
	|ИЗ
	|	ВТ_ПодготовленныеДанные КАК ВТ_ПодготовленныеДанные
	|ГДЕ
	|	ВТ_ПодготовленныеДанные.ОтражаетсяВРасчетах = ИСТИНА
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_ПодготовленныеДанные.Ссылка,
	|	ВТ_ПодготовленныеДанные.ДоговорКонтрагента,
	|	ВТ_ПодготовленныеДанные.ОбъектРасчетов,
	|	ВТ_ПодготовленныеДанные.ЭлементСтруктурыЗадолженности,
	|	ВТ_ПодготовленныеДанные.СтатьяДвиженияДенежныхСредств,
	|	ВТ_ПодготовленныеДанные.ВалютаВзаиморасчетов
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ПодготовленныеДанные.Ссылка КАК Ссылка,
	|	ВТ_ПодготовленныеДанные.СтатьяДвиженияДенежныхСредств КАК СтатьяДвиженияДенежныхСредств,
	|	ВТ_ПодготовленныеДанные.Аналитика1 КАК Аналитика1,
	|	ВТ_ПодготовленныеДанные.Аналитика2 КАК Аналитика2,
	|	ВТ_ПодготовленныеДанные.Аналитика3 КАК Аналитика3,
	|	ВТ_ПодготовленныеДанные.Аналитика4 КАК Аналитика4,
	|	ВТ_ПодготовленныеДанные.Аналитика5 КАК Аналитика5,
	|	ВТ_ПодготовленныеДанные.Аналитика6 КАК Аналитика6,
	|	ВТ_ПодготовленныеДанные.ЦФО КАК ЦФО,
	|	ВТ_ПодготовленныеДанные.Проект КАК Проект,
	|	ВТ_ПодготовленныеДанные.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_ПодготовленныеДанные.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ВТ_ПодготовленныеДанные.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_ПодготовленныеДанные.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(ВТ_ПодготовленныеДанные.СуммаБезНДС + ВТ_ПодготовленныеДанные.СуммаНДС) КАК Сумма,
	|	ВТ_ПодготовленныеДанные.ДокументПланирования КАК ДокументПланирования,
	|	ВТ_ПодготовленныеДанные.ИдентификаторПозиции КАК ИдентификаторПозиции,
	|	ВТ_ПодготовленныеДанные.КурсВзаиморасчетов,
	|	ВТ_ПодготовленныеДанные.КратностьВзаиморасчетов
	|ИЗ
	|	ВТ_ПодготовленныеДанные КАК ВТ_ПодготовленныеДанные
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_ПодготовленныеДанные.ДоговорКонтрагента,
	|	ВТ_ПодготовленныеДанные.ОбъектРасчетов,
	|	ВТ_ПодготовленныеДанные.ЦФО,
	|	ВТ_ПодготовленныеДанные.Проект,
	|	ВТ_ПодготовленныеДанные.СтатьяДвиженияДенежныхСредств,
	|	ВТ_ПодготовленныеДанные.Аналитика1,
	|	ВТ_ПодготовленныеДанные.Аналитика2,
	|	ВТ_ПодготовленныеДанные.Аналитика3,
	|	ВТ_ПодготовленныеДанные.Аналитика4,
	|	ВТ_ПодготовленныеДанные.Аналитика5,
	|	ВТ_ПодготовленныеДанные.Аналитика6,
	|	ВТ_ПодготовленныеДанные.ДокументПланирования,
	|	ВТ_ПодготовленныеДанные.ВалютаВзаиморасчетов,
	|	ВТ_ПодготовленныеДанные.Ссылка,
	|	ВТ_ПодготовленныеДанные.ИдентификаторПозиции,
	|	ВТ_ПодготовленныеДанные.КурсВзаиморасчетов,
	|	ВТ_ПодготовленныеДанные.КратностьВзаиморасчетов";
	Запросы.Добавить(ТекстЗапроса);
	
	// Получение данных
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка",			ИсходныйДокументСсылка);
	Запрос.УстановитьПараметр("ИмяМетаданных",	ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	Запрос.УстановитьПараметр("УИД",			ИсходныйДокументСсылка.УникальныйИдентификатор());
	
	Запрос.Текст = СтрСоединить(Запросы, ОбщегоНазначенияОПК.ТекстРазделителяЗапросовПакета());
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	Если РезультатЗапроса[3].Пустой() Тогда
		Возврат неопределено; // Стандартное заполнение
	КонецЕсли;
	
	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("Шапка", РезультатЗапроса[3].Выгрузить());
	Результат.Вставить("Взаиморасчеты", РезультатЗапроса[4].Выгрузить());
	Результат.Вставить("БюджетДвиженияДенежныхСредств", РезультатЗапроса[5].Выгрузить());
	
	// Массив ключевых реквизитов
	КлючевыеРеквизиты = Новый Массив;
	КлючевыеРеквизиты.Добавить("ИмяМетаданных");
	КлючевыеРеквизиты.Добавить("УИД");
	КлючевыеРеквизиты.Добавить("ВидОперации");
	КлючевыеРеквизиты.Добавить("Организация");
	КлючевыеРеквизиты.Добавить("Контрагент");
	КлючевыеРеквизиты.Добавить("СуммаДокумента");
	КлючевыеРеквизиты.Добавить("ВалютаДокумента");
	
	Результат.Вставить("КлючевыеРеквизиты", КлючевыеРеквизиты);
	
	Возврат Результат;
	
КонецФункции

// Приобретение услуг и прочих активов
Функция ВыполнитьЗаполнение_ПриобретениеУслугПрочихАктивов(ИсходныйДокументСсылка)
	
	// Получение данных
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Ссылка",			ИсходныйДокументСсылка);
	Запрос.УстановитьПараметр("ИмяМетаданных",	ИсходныйДокументСсылка.Метаданные().ПолноеИмя());
	Запрос.УстановитьПараметр("УИД",			ИсходныйДокументСсылка.УникальныйИдентификатор());
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ПриобретениеУслугПрочихАктивов) КАК Ссылка,
	|	ДоговорыКонтрагентов.Ссылка КАК ДоговорКонтрагента,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.ЦФО ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнойЦФО
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.ЦФО
	|	КОНЕЦ КАК ЦФО,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Проект ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнойПроект
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Проект
	|	КОНЕЦ КАК Проект,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.СтатьяБюджета ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.СтатьяБюджета
	|	КОНЕЦ КАК СтатьяБюджета,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика1 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение1
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика1
	|	КОНЕЦ КАК Аналитика1,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика2 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение2
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика2
	|	КОНЕЦ КАК Аналитика2,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика3 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение3
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика3
	|	КОНЕЦ КАК Аналитика3,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика4 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение4
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика4
	|	КОНЕЦ КАК Аналитика4,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика5 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение5
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика5
	|	КОНЕЦ КАК Аналитика5,
	|	ВЫБОР
	|		КОГДА ДанныеАналитикПланированияДокумента.Аналитика6 ЕСТЬ NULL
	|			ТОГДА ДоговорыКонтрагентов.АналитикаИсполнение6
	|		ИНАЧЕ ДанныеАналитикПланированияДокумента.Аналитика6
	|	КОНЕЦ КАК Аналитика6,
	|	Суммы.ОбъектРасчетов.Объект КАК ОбъектРасчетов,
	|	Суммы.Валюта КАК Валюта,
	|	Суммы.СуммаБезНДС + Суммы.СуммаНДС КАК Сумма,
	|	Суммы.СуммаБезНДС КАК СуммаБезНДС,
	|	Суммы.СуммаНДС КАК СуммаНДС,
	|	Суммы.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов КАК СуммаВзаиморасчетов,
	|	Суммы.СуммаНДСВзаиморасчетов КАК СуммаНДСВзаиморасчетов,
	|	Суммы.СуммаВзаиморасчетов - Суммы.СуммаНДСВзаиморасчетов КАК СуммаБезНДСВзаиморасчетов,
	|	ПриобретениеУслугПрочихАктивовРасходы.Количество КАК Количество,
	|	ВЫБОР
	|		КОГДА ВЫБОР
	|				КОГДА ДанныеАналитикПланированияДокумента.СтатьяБюджета ЕСТЬ NULL
	|					ТОГДА ДоговорыКонтрагентов.ОсновнаяСтатьяИсполнение
	|				ИНАЧЕ ДанныеАналитикПланированияДокумента.СтатьяБюджета
	|			КОНЕЦ ССЫЛКА Справочник.СтатьиДвиженияРесурсов
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоБюджетЗакупок
	|ПОМЕСТИТЬ ВТ_СуммыДокумента
	|ИЗ
	|	РегистрСведений.СуммыДокументовВВалютахУчета КАК Суммы
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеУслугПрочихАктивов.Расходы КАК ПриобретениеУслугПрочихАктивовРасходы
	|		ПО Суммы.Регистратор = ПриобретениеУслугПрочихАктивовРасходы.Ссылка
	|			И Суммы.ИдентификаторСтроки = ПриобретениеУслугПрочихАктивовРасходы.ИдентификаторСтроки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	|		ПО (ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ПриобретениеУслугПрочихАктивов).Договор = ДоговорыКонтрагентов.Ссылка)
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриобретениеУслугПрочихАктивов.АналитикиПланирования КАК ДанныеАналитикПланированияДокумента
	|		ПО ((ВЫРАЗИТЬ(Суммы.Регистратор КАК Документ.ПриобретениеУслугПрочихАктивов)) = ДанныеАналитикПланированияДокумента.Ссылка)
	|			И (ДанныеАналитикПланированияДокумента.ВидБюджета <> ЗНАЧЕНИЕ(ПланВидовХарактеристик.ВидыБюджетов.БюджетДвиженияДенежныхСредств))
	|ГДЕ
	|	Суммы.Регистратор = &Ссылка
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	&ИмяМетаданных КАК ИмяМетаданных,
	|	&УИД КАК УИД,
	|	Документ.ХозяйственнаяОперация КАК ВидОперации,
	|	Документ.Дата КАК Дата,
	|	Документ.Организация КАК Организация,
	|	Документ.Контрагент КАК Контрагент,
	|	Документ.Договор КАК ДоговорКонтрагента,
	|	Документ.Номер КАК НомерИсходногоДокумента,
	|	Документ.Дата КАК ДатаИсходногоДокумента,
	|	Документ.НомерВходящегоДокумента КАК НомерВходящегоДокумента,
	|	Документ.ДатаВходящегоДокумента КАК ДатаВходящегоДокумента,
	|	ВТ_СуммыДокумента.Валюта КАК ВалютаДокумента,
	|	СУММА(ВТ_СуммыДокумента.Сумма) КАК СуммаДокумента,
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход) КАК ПриходРасход,
	|	ЗНАЧЕНИЕ(Перечисление.НаправлениеДвиженияВзаиморасчетов.УменьшениеЗадолженности) КАК НаправлениеВзаиморасчетов,
	|	ВТ_СуммыДокумента.ЦФО КАК ЦФО,
	|	ВТ_СуммыДокумента.Проект КАК Проект
	|ИЗ
	|	Документ.ПриобретениеУслугПрочихАктивов КАК Документ
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|		ПО (Документ.Ссылка = &Ссылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	Документ.ХозяйственнаяОперация,
	|	ВТ_СуммыДокумента.Валюта,
	|	Документ.Договор,
	|	Документ.НомерВходящегоДокумента,
	|	Документ.ДатаВходящегоДокумента,
	|	Документ.Номер,
	|	Документ.Организация,
	|	Документ.Контрагент,
	|	Документ.Дата,
	|	ВТ_СуммыДокумента.ЦФО,
	|	ВТ_СуммыДокумента.Проект,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	Документ.Дата
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	ЗНАЧЕНИЕ(Перечисление.ЭлементыСтруктурыЗадолженности.ОсновнойДолг) КАК ЭлементСтруктурыЗадолженности,
	|	ВТ_СуммыДокумента.СтатьяБюджета КАК СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(ВТ_СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов
	|ИЗ
	|	ВТ_СуммыДокумента КАК ВТ_СуммыДокумента
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_СуммыДокумента.ДоговорКонтрагента,
	|	ВТ_СуммыДокумента.ОбъектРасчетов,
	|	ВТ_СуммыДокумента.СтатьяБюджета,
	|	ВТ_СуммыДокумента.ВалютаВзаиморасчетов
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА ОтражатьВБДРРеализациюКакПриход.Значение = ИСТИНА
	|			ТОГДА ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Расход)
	|		ИНАЧЕ ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход)
	|	КОНЕЦ КАК ПриходРасход,
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДоходовИРасходов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента,
	|	Константа.ОтражатьВБДРРеализациюКакПриход КАК ОтражатьВБДРРеализациюКакПриход
	|ГДЕ
	|	СуммыДокумента.ЭтоБюджетЗакупок = ЛОЖЬ
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов,
	|	ОтражатьВБДРРеализациюКакПриход.Значение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(Перечисление.ВидыДвиженийПриходРасход.Приход) КАК ПриходРасход,
	|	СуммыДокумента.СтатьяБюджета КАК СтатьяДвиженияРесурсов,
	|	СуммыДокумента.Аналитика1 КАК Аналитика1,
	|	СуммыДокумента.Аналитика2 КАК Аналитика2,
	|	СуммыДокумента.Аналитика3 КАК Аналитика3,
	|	СуммыДокумента.Аналитика4 КАК Аналитика4,
	|	СуммыДокумента.Аналитика5 КАК Аналитика5,
	|	СуммыДокумента.Аналитика6 КАК Аналитика6,
	|	НЕОПРЕДЕЛЕНО КАК ДокументПланирования,
	|	СуммыДокумента.ДоговорКонтрагента КАК ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО КАК ЦФО,
	|	СуммыДокумента.Проект КАК Проект,
	|	СуммыДокумента.ОбъектРасчетов КАК ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов КАК ВалютаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов) КАК СуммаВзаиморасчетов,
	|	СУММА(СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовНДС,
	|	СУММА(СуммыДокумента.СуммаВзаиморасчетов - СуммыДокумента.СуммаНДСВзаиморасчетов) КАК СуммаВзаиморасчетовБезНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС + СуммыДокумента.СуммаНДС) КАК Сумма,
	|	СУММА(СуммыДокумента.СуммаНДС) КАК СуммаНДС,
	|	СУММА(СуммыДокумента.СуммаБезНДС) КАК СуммаБезНДС,
	|	СУММА(СуммыДокумента.Количество) КАК Количество
	|ИЗ
	|	ВТ_СуммыДокумента КАК СуммыДокумента
	|ГДЕ
	|	СуммыДокумента.ЭтоБюджетЗакупок = ИСТИНА
	|
	|СГРУППИРОВАТЬ ПО
	|	СуммыДокумента.ДоговорКонтрагента,
	|	СуммыДокумента.ЦФО,
	|	СуммыДокумента.Проект,
	|	СуммыДокумента.СтатьяБюджета,
	|	СуммыДокумента.Аналитика1,
	|	СуммыДокумента.Аналитика2,
	|	СуммыДокумента.Аналитика3,
	|	СуммыДокумента.Аналитика4,
	|	СуммыДокумента.Аналитика5,
	|	СуммыДокумента.Аналитика6,
	|	СуммыДокумента.ОбъектРасчетов,
	|	СуммыДокумента.ВалютаВзаиморасчетов";
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	Если РезультатЗапроса[1].Пустой() Тогда
		Возврат неопределено; // Стандартное заполнение
	КонецЕсли;
	
	// Формируем результат
	Результат = Новый Структура;
	Результат.Вставить("Шапка", РезультатЗапроса[1].Выгрузить());
	Результат.Вставить("Взаиморасчеты", РезультатЗапроса[2].Выгрузить());
	Результат.Вставить("БюджетДоходовИРасходов", РезультатЗапроса[3].Выгрузить());
	Результат.Вставить("БюджетДвиженияРесурсов", РезультатЗапроса[4].Выгрузить());
	
	// Массив ключевых реквизитов
	КлючевыеРеквизиты = Новый Массив;
	КлючевыеРеквизиты.Добавить("ИмяМетаданных");
	КлючевыеРеквизиты.Добавить("УИД");
	КлючевыеРеквизиты.Добавить("ВидОперации");
	КлючевыеРеквизиты.Добавить("Организация");
	КлючевыеРеквизиты.Добавить("Контрагент");
	КлючевыеРеквизиты.Добавить("СуммаДокумента");
	КлючевыеРеквизиты.Добавить("ВалютаДокумента");
	
	Результат.Вставить("КлючевыеРеквизиты", КлючевыеРеквизиты);
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти
