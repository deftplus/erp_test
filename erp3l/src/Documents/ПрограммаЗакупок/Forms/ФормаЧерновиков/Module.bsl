
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	// Считывание параметров.
	ПрограммаЗакупок = Параметры.ПрограммаЗакупок;
	// Представление программы закупки.
	ПредставлениеПрограммыЗакупок = "";
	Если ПрограммаЗакупок.ЗакупкаИнновационнойВысокотехнологичнойПродукцииИЛекарственныхСредств Тогда
		ПредставлениеПрограммыЗакупок = НСтр("ru = '%Организация%, %Валюта%, Инвестиционный план'");
	Иначе
		ПредставлениеПрограммыЗакупок = НСтр("ru = '%Организация%, %Валюта%, Годовой план'");
	КонецЕсли;
	Если ЗначениеЗаполнено(ПрограммаЗакупок) Тогда
		ПредставлениеПрограммыЗакупок = СтрЗаменить(ПредставлениеПрограммыЗакупок, "%Организация%", Строка(ПрограммаЗакупок.ОрганизацияДляЗаключенияДоговора));
		ПредставлениеПрограммыЗакупок = СтрЗаменить(ПредставлениеПрограммыЗакупок, "%Валюта%", Строка(ПрограммаЗакупок.ВалютаДокумента));
	Иначе
		ПредставлениеПрограммыЗакупок = СтрЗаменить(ПредставлениеПрограммыЗакупок, "%Организация%", Строка(Параметры.Организация));
		ПредставлениеПрограммыЗакупок = СтрЗаменить(ПредставлениеПрограммыЗакупок, "%Валюта%", Строка(Параметры.Валюта));
	КонецЕсли;
	ПрограммаЗакупокТекст = ПредставлениеПрограммыЗакупок;
	// Заголовок формы.
	НовыйЗаголовок = НСтр("ru = 'Черновики строк плана закупок %ПредставлениеПлана%'");
	НовыйЗаголовок = СтрЗаменить(НовыйЗаголовок, "%ПредставлениеПлана%", Строка(ПредставлениеПрограммыЗакупок));
	ЭтаФорма.Заголовок = НовыйЗаголовок;
КонецПроцедуры

&НаСервереБезКонтекста
Процедура ЗаменитьДаты_Сервер(ЗакупкаВход)
	МассивСтатусов = Новый Массив;
	МассивСтатусов.Добавить(ПредопределенноеЗначение("Перечисление.СтатусыВыгружаемыхОбъектовЕИС.ПустаяСсылка"));
	МассивСтатусов.Добавить(ПредопределенноеЗначение("Перечисление.СтатусыВыгружаемыхОбъектовЕИС.Черновик"));
	МассивСтатусов.Добавить(ПредопределенноеЗначение("Перечисление.СтатусыВыгружаемыхОбъектовЕИС.Возвращен"));
	МассивСтатусов.Добавить(ПредопределенноеЗначение("Перечисление.СтатусыВыгружаемыхОбъектовЕИС.НаУтверждении"));
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	СтрокаПланаЗакупок.Ссылка КАК Ссылка,
		|	СтрокаПланаЗакупок.ПериодЗакупок КАК ПериодЗакупок
		|ИЗ
		|	Документ.СтрокаПланаЗакупок КАК СтрокаПланаЗакупок
		|ГДЕ
		|	СтрокаПланаЗакупок.ПериодЗакупок = &ПериодЗакупок
		|	И СтрокаПланаЗакупок.ЗакупкаИнновационнойВысокотехнологичнойПродукцииИЛекарственныхСредств = &ЗакупкаИнновационнойВысокотехнологичнойПродукцииИЛекарственныхСредств
		|	И СтрокаПланаЗакупок.ОрганизацияДляЗаключенияДоговора = &ОрганизацияДляЗаключенияДоговора";
	Запрос.УстановитьПараметр("ПериодЗакупок", ЗакупкаВход.ПериодЗакупок);
	Запрос.УстановитьПараметр("ЗакупкаИнновационнойВысокотехнологичнойПродукцииИЛекарственныхСредств", ЗакупкаВход.ЗакупкаИнновационнойВысокотехнологичнойПродукцииИЛекарственныхСредств);
	Запрос.УстановитьПараметр("ОрганизацияДляЗаключенияДоговора", ЗакупкаВход.ОрганизацияДляЗаключенияДоговора);
	РезультатЗапроса = Запрос.Выполнить();
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		ДокументСсылка = ВыборкаДетальныеЗаписи.Ссылка;
		ДокументОбъект = ДокументСсылка.ПолучитьОбъект();
		ДокументОбъект.Дата = Дата(2028, 1, 10, Час(ДокументОбъект.Дата), Минута(ДокументОбъект.Дата), Секунда(ДокументОбъект.Дата));
		ДокументОбъект.Записать(РежимЗаписиДокумента.Проведение);
		СтарыйСтатус = УправлениеПроцессамиСогласованияУХ.ВернутьСтатусОбъекта(ДокументСсылка);
		Если (МассивСтатусов.Найти(СтарыйСтатус) <> Неопределено) ИЛИ (НЕ ЗначениеЗаполнено(СтарыйСтатус)) Тогда
			УправлениеПроцессамиСогласованияУХ.ПеревестиЗаявкуВПроизвольноеСостояние(ДокументСсылка, Перечисления.СтатусыВыгружаемыхОбъектовЕИС.Утвержден);
		Иначе
			// Пропускаем.
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры		// ЗаменитьДаты_Сервер()

&НаКлиенте
Процедура ПредставлениеПрограммыЗакупокНажатие(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ПоказатьЗначение(, ПрограммаЗакупок);
КонецПроцедуры

&НаКлиенте
Процедура ЗаменитьДаты28(Команда)
	ЗаменитьДаты_Сервер(ПрограммаЗакупок);
КонецПроцедуры
