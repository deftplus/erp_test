
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)

	ТипДанныхЗаполнения = ТипЗнч(ДанныеЗаполнения);	
	
	Если ДанныеЗаполнения = Неопределено Тогда 
		
		ИнициализироватьДокумент(ДанныеЗаполнения);
		
	ИначеЕсли ТипДанныхЗаполнения = Тип("Структура") Тогда 
		
		Если ДанныеЗаполнения.Свойство("СтруктураДействий") Тогда 
					
		ИначеЕсли ДанныеЗаполнения.Свойство("ИсточникЗаполнения") И ДанныеЗаполнения.ИсточникЗаполнения = "ДанныеНСБУ" Тогда
			ЗаполнитьИзНСБУ();
		ИначеЕсли ДанныеЗаполнения.Свойство("ИсточникЗаполнения") И ДанныеЗаполнения.ИсточникЗаполнения = "ДокументыОснования" Тогда
			ЗаполнитьПоДокументамОснованиям(ДанныеЗаполнения);
		ИначеЕсли ДанныеЗаполнения.Свойство("ИсточникЗаполнения") И ДанныеЗаполнения.ИсточникЗаполнения = "ТаблицаВНА" Тогда
			//
		ИначеЕсли ДанныеЗаполнения.Свойство("АдресТаблицы") Тогда
			
			МСФОВызовСервераУХ.ЗаполнитьПоТаблицеЗагрузки(ЭтотОбъект, ДанныеЗаполнения);
		
	 	Иначе
			ИнициализироватьДокумент(ДанныеЗаполнения);
		КонецЕсли;	
		
	ИначеЕсли Метаданные().ВводитсяНаОсновании.Содержит(ДанныеЗаполнения.Метаданные()) Тогда		
		
		ЗаполнитьПоДокументамОснованиям(ДанныеЗаполнения);
		
	Иначе
		
		ИнициализироватьДокумент(ДанныеЗаполнения);
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	
	ИнициализироватьДокумент();
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)

КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)	
	ПроведениеСерверУХ.ПередЗаписью(ЭтотОбъект, Отказ, РежимЗаписи, РежимПроведения);	
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	ПроведениеСерверУХ.ИнициализироватьДополнительныеСвойстваДляПроведения(Ссылка, ДополнительныеСвойства, РежимПроведения);
	Документы.ПризнаниеРасходовПоАмортизацииНСБУ.ПодготовитьПараметрыПроведения(ДополнительныеСвойства, Отказ);
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	ПроведениеСерверУХ.ПодготовитьНаборыЗаписейКРегистрацииДвижений(ЭтотОбъект);
	Документы.ПризнаниеРасходовПоАмортизацииНСБУ.СформироватьДвижения(Движения, ДополнительныеСвойства, Отказ);
	ПроведениеСерверУХ.ОбработкаПроведения_ЗаписьИКонтроль(ЭтотОбъект, Отказ);	
	
КонецПроцедуры

Процедура ОбработкаУдаленияПроведения(Отказ)
	ПроведениеСерверУХ.ОбработкаУдаленияПроведения(ЭтотОбъект, Отказ);
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыФункции

Процедура ИнициализироватьДокумент(ДанныеЗаполнения = Неопределено)
	
	МСФОУХ.ОбработкаЗаполнения(ЭтотОбъект, ДанныеЗаполнения);
	ПериодРасчета = ОбщегоНазначенияУХ.ПолучитьПериодПоДате(Дата, Перечисления.Периодичность.Месяц);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиЗаполнения

Процедура ЗаполнитьПоДокументамОснованиям(ДокументОснование)
	МСФОВызовСервераУХ.ЗаполнитьДокументИзРежимаНСБУ(ЭтотОбъект, ДокументОснование);
КонецПроцедуры

Процедура ЗаполнитьИзНСБУ(ДанныеЗаполнения = Неопределено)

	ДокументыОснованияИсточник = ?(ДокументыОснования.Количество(), ДокументыОснования.ВыгрузитьКолонку("ДокументОснование"), Неопределено);
	
	ПараметрыЗаполнения = МСФОКлиентСерверУХ.ПолучитьПараметрыЗаполнения(ЭтотОбъект, ДокументыОснованияИсточник);	
	ИсточникЗаполнения = МСФОВНАУХ.ПолучитьДанные_НачислениеАмортизациВНА(ПараметрыЗаполнения);
	
	ЭтотОбъект.ВНА.Загрузить(ИсточникЗаполнения.ВНА);	
	ЭтотОбъект.ДокументыОснования.Загрузить(ИсточникЗаполнения.ДокументыОснования);
	
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли

