
#Область ОбработкаОсновныхСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	// Добавим контрагента в табличную часть, если он был передан параметром.
	ЭтоНовый = (Не ЗначениеЗаполнено(Объект.Ссылка));
	ЕстьКонтрагент = ЗначениеЗаполнено(Параметры.Контрагент);
	Если ЭтоНовый И ЕстьКонтрагент Тогда
		Объект.РазмерыКонтрагентов.Очистить();
		НоваяСтрока = Объект.РазмерыКонтрагентов.Добавить();
		НоваяСтрока.Контрагент = Параметры.Контрагент;
	Иначе
		// Заполнение не требуется.
	КонецЕсли;
КонецПроцедуры

#КонецОбласти


#Область ОбработкаСобытийЭлементовФормы


&НаКлиенте
Процедура РазмерыКонтрагентовПриИзменении(Элемент)
	ТекДанные = Элементы.РазмерыКонтрагентов.ТекущиеДанные;
	Если ЕстьДублированиеКонтрагента(ТекДанные.Контрагент) Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = НСтр("ru = 'В таблице уже есть такой контрагент!'");
		Сообщение.Поле = "Объект.РазмерыКонтрагентов[" + (ТекДанные.НомерСтроки-1) + "].Контрагент";
		Сообщение.Сообщить();
		ТекДанные.Контрагент = Неопределено;
	КонецЕсли;
КонецПроцедуры


#КонецОбласти


#Область СлужебныеПроцедурыНаКлиенте


&НаКлиенте
Функция ЕстьДублированиеКонтрагента(Контрагент)
	мСтрок = Объект.РазмерыКонтрагентов.НайтиСтроки(
		Новый Структура("Контрагент", Контрагент));
	Возврат мСтрок.Количество() > 1;
КонецФункции


#КонецОбласти


#Область СлужебныеПроцедурыНаСервере


#КонецОбласти

