
&НаКлиенте
Процедура ВыполнитьДействие(Команда)
	
	    ВыполнитьДействиеСервер();

	    Если Действие = "Открыть этап" Тогда
		   Оповестить("ОткрытьЭтап",ВыбОрганизацииАдрес);
	    КонецЕсли;
		
		Если Действие = "Закрыть этап" Тогда
		   Оповестить("ЗакрытьЭтап",ВыбОрганизацииАдрес);
	    КонецЕсли;

		Закрыть();
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ТЗОрганизаций = Параметры.ЭтапПроцесса.ОрганизационныеЕдиницыОтбор.Выгрузить();
	Для Каждого Стр из ТЗОрганизаций Цикл
		НС = ТаблицаОрганизаций.Добавить();
		НС.Организация = Стр.ОрганизационнаяЕдиница;
	КонецЦикла;
	НовыйЗаголовок = НСтр("ru = '%Действие% для следующих организаций:'");
	НовыйЗаголовок = СтрЗаменить(НовыйЗаголовок, "%Действие%", Строка(Параметры.Действие));
	Заголовок = НовыйЗаголовок;
	Действие = Параметры.Действие;
КонецПроцедуры

&НаСервере
Процедура ВыполнитьДействиеСервер()
	
	ТаблицаВыбранныхОрганизаций.Очистить();
	
	Для Каждого Стр из ТаблицаОрганизаций Цикл
		Если Стр.Выбран Тогда
			 Нстр = ТаблицаВыбранныхОрганизаций.Добавить();
			 Нстр.Организация = Стр.Организация; 	
		КонецЕсли;
	КонецЦикла;
    ВыбОрганизацииАдрес = ПоместитьВоВременноеХранилище(РеквизитФормыВЗначение("ТаблицаВыбранныхОрганизаций"),Новый УникальныйИдентификатор());
	
КонецПроцедуры	

&НаКлиенте
Процедура УстановитьФлажки(Команда)
	
	Для Каждого Стр Из ТаблицаОрганизаций Цикл
		  Стр.Выбран = Истина;
	КонецЦикла;
	 
КонецПроцедуры

&НаКлиенте
Процедура СнятьФлажки(Команда)
	
	Для Каждого Стр Из ТаблицаОрганизаций Цикл
		 Стр.Выбран = Ложь;
	КонецЦикла;

КонецПроцедуры
