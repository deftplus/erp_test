// Возвращает количество этапов согласования, которые текущий пользователь может согласовать
// по объекту согласования СогласовываемыйДокументВход
&НаСервереБезКонтекста
Функция КоличествоЭтаповСогласованияТекущегоПользователя(СогласовываемыйДокументВход)
	ЭтапыТекущегоПользователя = МодульУправленияПроцессамиУХ.ЭтапыСогласованияДляТекущегоПользователя(СогласовываемыйДокументВход);
	Возврат ЭтапыТекущегоПользователя.Количество();
КонецФункции

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	СогласовываемыйДокумент = Объект.СвязанныйОбъект;
	Если ЗначениеЗаполнено(Объект.Ссылка) И ЗначениеЗаполнено(СогласовываемыйДокумент) Тогда
		// Задача записана и есть объект согласования - откроем форму комментариев.
		Если КоличествоЭтаповСогласованияТекущегоПользователя(СогласовываемыйДокумент) > 0 Тогда
			СтруктураПараметров = Новый Структура("СогласовываемыйДокумент", СогласовываемыйДокумент);
			ОткрытьФорму("ОбщаяФорма.КомментарийИСогласование", СтруктураПараметров, ЭтаФорма);
			ЭтаФорма.Закрыть();
		Иначе
			// Текущий пользователь не может согласовывать данный документ, вызываем стандартную форму.
		КонецЕсли;
	Иначе
		// Нет объекта для согласования, вызываем стандартную форму.
	КонецЕсли;
КонецПроцедуры
