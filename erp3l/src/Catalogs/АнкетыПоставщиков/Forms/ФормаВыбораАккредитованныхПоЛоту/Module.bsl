
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ЗакупочнаяПроцедура = Параметры.ЗакупочнаяПроцедура;
	Если Не ЗначениеЗаполнено(ЗакупочнаяПроцедура) Тогда
		Отказ = Истина;
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст =
			НСтр("ru = 'Форму выбора аккредитованных поставщиков можно открыть только с указанием закупочной процедуры.'");
		Сообщение.Сообщить();
		Возврат;
	КонеЦЕсли;
	
	мНоменклатурыИГруппЗакупки =
		ЦентрализованныеЗакупкиУХ.ПолучитьМассивНоменклатурыИГруппЗакупки(
			ЗакупочнаяПроцедура);
	Номенклатура.ЗагрузитьЗначения(мНоменклатурыИГруппЗакупки);
	
	Если Номенклатура.Количество() = 0 Тогда
		Отказ = Истина;
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст =
			НСтр("ru = 'Форму выбора аккредитованных поставщиков можно открыть только для закупки с заполненным перечнем номенклатуры.'");
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;
	
	УстановитьОтборПоЗакупке();
КонецПроцедуры

&НаСервере
Процедура УстановитьОтборПоЗакупке()
	Список.Параметры.УстановитьЗначениеПараметра(
		"мНоменклатуры", 
		Номенклатура.ВыгрузитьЗначения());
	// Для закрытой закупки доступны только уже аккредитованные поставщики
	ОтборыСписковКлиентСерверУХ.ИзменитьЭлементОтбораСписка(
		Список,
		"Статус",
		Перечисления.СостоянияАккредитацииПоставщиков.Аккредитован,
		Истина,
		ЗакупочнаяПроцедура.ЗакрытаяЗакупка);
	Элементы.ДекорацияТолькоАккредитованные.Видимость =
		ЗакупочнаяПроцедура.ЗакрытаяЗакупка;
КонецПроцедуры
