#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "УстановленОтборФиксированнойАналитики" Тогда
		
		ОбработкаТабличныхЧастейКлиентСерверУХ.УдалитьСтрокиДеталиПоКлючуСтроки(Объект.ОтборыАналитик, "КлючОтбора", Параметр.КлючОтбора);
		ПредставлениеОтбора = "";
		СтрокиАналитика = Объект.ФиксированныеАналитики.НайтиСтроки(Новый Структура("КлючОтбора", Параметр.КлючОтбора));
		
		Если Параметр.ЗначениеСписок.Количество() = 0 Тогда
		
			Для каждого СтрокаАналитика Из СтрокиАналитика Цикл
				СтрокаАналитика.ПредставлениеОтбора = "";
				СтрокаАналитика.КлючОтбора = 0;
			КонецЦикла;
			
		Иначе
			
			Для каждого ЗначениеСписка Из Параметр.ЗначениеСписок Цикл
				
				НовыйОтбор = Объект.ОтборыАналитик.Добавить();
				НовыйОтбор.КлючОтбора = Параметр.КлючОтбора;
				НовыйОтбор.ВидСравнения = Параметр.ВидСравнения;
				НовыйОтбор.Значение = ЗначениеСписка.Значение;			
				ПредставлениеОтбора = ?(ПредставлениеОтбора = "", Строка(Параметр.ВидСравнения) + ":", 
				ПредставлениеОтбора + ", ") + ЗначениеСписка.Значение; 
				
			КонецЦикла;
			
			Для каждого СтрокаАналитика Из СтрокиАналитика Цикл
				СтрокаАналитика.ПредставлениеОтбора = ПредставлениеОтбора;
				
			КонецЦикла;
						
		КонецЕсли;
					
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	
	Если НЕ ТекущийОбъект.Предопределенный Тогда
		Элементы.ФормаОбновитьПредопределенный.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	//СКД = Справочники.ВидыОтчетов.ПолучитьМакет("ПолучениеПоказателей");
	//АдресСКД = ПоместитьВоВременноеХранилище(СКД, УникальныйИдентификатор);
	//
	//КомпоновщикНастроек.Инициализировать(Новый ИсточникДоступныхНастроекКомпоновкиДанных(АдресСКД));	
	//КомпоновщикНастроек.РазвернутьАвтоПоля();
		
КонецПроцедуры

#Область ОбработчикиТЧ

&НаКлиенте
Процедура ФиксированныеАналитикиИсточникВидАналитикиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
КонецПроцедуры

#КонецОбласти

&НаКлиенте
Процедура ГруппаАналитикИсточникПриИзменении(Элемент)
	ГруппаАналитикИсточникПриИзмененииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ГруппаАналитикИсточникПриИзмененииНаСервере()
	// Вставить содержимое обработчика.
КонецПроцедуры

&НаСервере
Процедура ОбновитьПредопределенныйНаСервере()
	
	ОбъектГруппа = РеквизитФормыВЗначение("Объект");
	Справочники.ФиксированныеГруппыАналитик.ОбновитьГруппу(ОбъектГруппа, Объект.ВидОтчетаИсточник.Пустая());
	ЗначениеВРеквизитФормы(ОбъектГруппа, "Объект");
	
КонецПроцедуры

&НаКлиенте
Процедура Обновить(Команда)
	ОбновитьПредопределенныйНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура ФиксированныеПоказателиПриИзменении(Элемент)
	
	ТекущаяСтрока = Элементы.ФиксированныеПоказатели.ТекущиеДанные;
	Если (ТекущаяСтрока <> Неопределено) И (ТекущаяСтрока.Коэффициент = 0) Тогда
		ТекущаяСтрока.Коэффициент = 1;
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура ФиксированныеАналитикиПредставлениеОтбораНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ТекущаяСтрока = Элементы.ФиксированныеАналитики.ТекущиеДанные;
	Если ТекущаяСтрока = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Если ТекущаяСтрока.КлючОтбора = 0 Тогда
		ТекущаяСтрока.КлючОтбора = ОбработкаТабличныхЧастейКлиентСерверУХ.ПолучитьНовыйКлючСтроки(Объект.ФиксированныеАналитики, "КлючОтбора");
	КонецЕсли;
	
	СтрокиОтбора = Объект.ОтборыАналитик.НайтиСтроки(Новый Структура("КлючОтбора", ТекущаяСтрока.КлючОтбора));
	Если СтрокиОтбора.Количество() = 0 Тогда
		ТекущийВидСравнения = Неопределено;
		Значение = Неопределено;
	Иначе
		ТекущийВидСравнения = СтрокиОтбора[0].ВидСравнения;
		
		Значение = Новый СписокЗначений;
		Для каждого СтрокаОтбора Из СтрокиОтбора Цикл		
			Значение.Добавить(СтрокаОтбора.Значение);
		КонецЦикла;
		
	КонецЕсли;
	
	ПараметрыФормы = Новый Структура;
	ПараметрыФормы.Вставить("КлючОтбора", 	ТекущаяСтрока.КлючОтбора);
	ПараметрыФормы.Вставить("ТипАналитики", ПолучитьОписаниеТиповПриеминика(ТекущаяСтрока.ТипПриемника));
	ПараметрыФормы.Вставить("ВидСравнения", ТекущийВидСравнения);
	ПараметрыФормы.Вставить("Значение", 	Значение);
	
	ОткрытьФорму("Справочник.ФиксированныеГруппыАналитик.Форма.ФормаУстановкиОтбора", ПараметрыФормы, ЭтаФорма);
	
КонецПроцедуры

&НаСервереБезКонтекста
Функция ПолучитьОписаниеТиповПриеминика(ТипПриемника)

	Если ТипЗнч(ТипПриемника) = Тип("ПеречислениеСсылка.ТипыЗначенийПоказателейОтчетов") Тогда
		
		Если ТипПриемника = Перечисления.ТипыЗначенийПоказателейОтчетов.Булево Тогда
			Возврат Новый ОписаниеТипов("Булево");
		ИначеЕсли ТипПриемника = Перечисления.ТипыЗначенийПоказателейОтчетов.Дата Тогда
			Возврат Новый ОписаниеТипов("Дата");
		ИначеЕсли ТипПриемника = Перечисления.ТипыЗначенийПоказателейОтчетов.Строка Тогда
			Возврат Новый ОписаниеТипов("Строка");
		ИначеЕсли ТипПриемника = Перечисления.ТипыЗначенийПоказателейОтчетов.Число Тогда
			Возврат Новый ОписаниеТипов("Число");
		КонецЕсли;
		
	Иначе
		
		Возврат ТипПриемника.ТипЗначения;
		
	КонецЕсли;

КонецФункции



