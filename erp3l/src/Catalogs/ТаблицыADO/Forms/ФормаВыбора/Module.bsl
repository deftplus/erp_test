
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Отбор.Свойство("Владелец") И ЗначениеЗаполнено(Параметры.Отбор.Владелец) Тогда
		
		ТипБД=Параметры.Отбор.Владелец;
		
		Если НЕ ТипБД.ВерсияПлатформы=Перечисления.ПлатформыВнешнихИнформационныхБаз.ADO Тогда
			
			ОбщегоНазначенияУХ.СообщитьОбОшибке(Нстр("ru = 'Выбранный тип внешней информационной базы не использует подключение по ADO'"),Отказ,,СтатусСообщения.Информация);
			Возврат;
			
		КонецЕсли;
		
		ОбновитьОтборПоВладельцу();
		
		Элементы.ТипБД.Доступность=Ложь;
		
	Иначе
		
		Элементы.ТипБД.Доступность=Истина;
		
		Запрос=Новый Запрос;
		Запрос.Текст="ВЫБРАТЬ ПЕРВЫЕ 1
		|	ТипыБазДанных.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.ТипыБазДанных КАК ТипыБазДанных
		|ГДЕ
		|	ТипыБазДанных.ВерсияПлатформы = ЗНАЧЕНИЕ(Перечисление.ПлатформыВнешнихИнформационныхБаз.ADO)";
		
		Результат=Запрос.Выполнить().Выбрать();
		
		Если Результат.Следующий() Тогда
			
			ТипБД=Результат.Ссылка;
			ОбновитьОтборПоВладельцу();
			
		КонецЕсли;
		
	КонецЕсли;
	
	Элементы.ИмяФайла.Видимость=(ТипБД.ВИБПоУмолчанию.ТипХранилищаДанныхADO=Перечисления.ТипыХранилищДанныхADO.XLS
		ИЛИ ТипБД.ВИБПоУмолчанию.ТипХранилищаДанныхADO=Перечисления.ТипыХранилищДанныхADO.MSAccess);
	
КонецПроцедуры

&НаСервере
Процедура ОбновитьОтборПоВладельцу()
	
	ОтборыСписковКлиентСерверУХ.ИзменитьЭлементОтбораСписка(Список, "Владелец", ТипБД, Истина);
			
КонецПроцедуры // ОбновитьОтборПоВладельцу() 

&НаСервереБезКонтекста
Процедура ЗаполнитьСписокТаблиц(ТипБД)
	
	Справочники.ТаблицыADO.ОбновитьТаблицыADO(ТипБД);
		
КонецПроцедуры // ЗаполнитьСписокСправочников()


/////////////////////////////////////////////////////////////////////////////////

&НаКлиенте
Процедура ЗагрузитьИЗADO(Команда)
	
	Если НЕ ЗначениеЗаполнено(ТипБД) Тогда
		
		ПоказатьПредупреждение(, Нстр("ru = 'Не указан тип внешней информационной базы.'"));
		Возврат;
		
	Иначе
		
		ЗаполнитьСписокТаблиц(ТипБД);
		Элементы.Список.Обновить();
		
	КонецЕсли;
			
КонецПроцедуры

&НаКлиенте
Процедура ТипБДПриИзменении(Элемент)
	
	ОбновитьОтборПоВладельцу();
	
КонецПроцедуры

&НаКлиенте
Процедура ТипБДНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка=Ложь;
	
	СтруктураОтбора=Новый Структура;
	СтруктураОтбора.Вставить("ВерсияПлатформы",ПредопределенноеЗначение("Перечисление.ПлатформыВнешнихИнформационныхБаз.ADO"));
	
	ОткрытьФорму("Справочник.ТипыБазДанных.ФормаВыбора",Новый Структура("Отбор",СтруктураОтбора),Элемент);
		
КонецПроцедуры

&НаКлиенте
Процедура ПросмотрДанных(Команда)
	
	Если Элементы.Список.ТекущиеДанные=Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	СтруктураПараметров=Новый Структура;
	СтруктураПараметров.Вставить("ТаблицаADO",Элементы.Список.ТекущиеДанные.Ссылка);
	СтруктураПараметров.Вставить("ТипБД",ТипБД);
	СтруктураПараметров.Вставить("РежимВыбора",Ложь);
	
	ОткрытьФорму("ОбщаяФорма.ФормаПросмотраТаблицыADO",СтруктураПараметров);
	
КонецПроцедуры
