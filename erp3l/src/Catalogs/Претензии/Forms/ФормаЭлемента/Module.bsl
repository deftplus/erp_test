
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если НЕ Объект.Ссылка.Пустая() Тогда
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	ХодПретензионноИсковойРаботыСрезПоследних.Регистратор КАК Регистратор,
			|	ХодПретензионноИсковойРаботыСрезПоследних.Период
			|ИЗ
			|	РегистрСведений.ХодПретензионноИсковойРаботы.СрезПоследних(&Период, Претензия = &Ссылка) КАК ХодПретензионноИсковойРаботыСрезПоследних";
		
		Запрос.УстановитьПараметр("Период", КонецДня(ТекущаяДатаСеанса()));
		Запрос.УстановитьПараметр("Ссылка", Объект.Ссылка);
		
		РезультатЗапроса = Запрос.Выполнить();
		
		ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
		
		Если ВыборкаДетальныеЗаписи.Следующий() Тогда
			Период = ВыборкаДетальныеЗаписи.Период;
			Регистратор = ВыборкаДетальныеЗаписи.Регистратор;
		КонецЕсли;

	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Отказ = Истина;
	Если Объект.Ссылка.Пустая() Тогда
		ОткрытьФорму("Документ.ИзменениеПретензии.ФормаОбъекта", Новый Структура("Основание", Объект.Основание), ВладелецФормы);
	Иначе
		Если НЕ Регистратор.Пустая() И Период = НачалоДня(ОбщегоНазначенияКлиент.ДатаСеанса()) Тогда
			ОткрытьФорму("Документ.ИзменениеПретензии.ФормаОбъекта", Новый Структура("Ключ", Регистратор), ВладелецФормы);
		Иначе
			ОткрытьФорму("Документ.ИзменениеПретензии.ФормаОбъекта", Новый Структура("Основание", Объект.Ссылка), ВладелецФормы);
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФормуПретензии()
	ОткрытьФорму("Документ.ИзменениеПретензии.ФормаОбъекта", Новый Структура("Основание", ?(ЗначениеЗаполнено(Объект.Основание), Объект.Основание, Объект.Ссылка)), ВладелецФормы);
КонецПроцедуры
