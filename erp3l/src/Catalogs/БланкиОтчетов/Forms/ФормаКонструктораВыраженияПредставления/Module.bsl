
&НаКлиенте
Процедура Применить(Команда)
	
	Закрыть(СтрЗАменить(ПолеШаблонаТекст,Символ(10),""));
		
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	
	Если Параметры.АналитикаСубконто = Перечисления.ПредназначенияЭлементовАналитик.Сценарии Тогда
		
		ТипОбъекта = Справочники.СправочникиБД.НайтиПоНаименованию("Сценарии",,,Справочники.ТипыБазДанных.ТекущаяИБ);

	ИначеЕсли Параметры.АналитикаСубконто = Перечисления.ПредназначенияЭлементовАналитик.Организации Тогда
		
		ТипОбъекта = Справочники.СправочникиБД.НайтиПоНаименованию("Организации",,,Справочники.ТипыБазДанных.ТекущаяИБ);

	ИначеЕсли Параметры.АналитикаСубконто = Перечисления.ПредназначенияЭлементовАналитик.Проекты Тогда	
		
		ТипОбъекта = Справочники.СправочникиБД.НайтиПоНаименованию("Проекты",,,Справочники.ТипыБазДанных.ТекущаяИБ);
		
	ИначеЕсли Параметры.АналитикаСубконто = Перечисления.ПредназначенияЭлементовАналитик.ПоказателиСтроки Тогда	
		
		ТипОбъекта = Справочники.СправочникиБД.НайтиПоНаименованию("СтрокиОтчетов",,,Справочники.ТипыБазДанных.ТекущаяИБ);
		
	Иначе	
		МетаданныеОбъекта = Параметры.АналитикаСубконто.ТипЗначения.ПривестиЗначение().Метаданные();
		ТипОбъекта = Справочники.СправочникиБД.НайтиПоНаименованию(МетаданныеОбъекта.Имя,,,Справочники.ТипыБазДанных.ТекущаяИБ);
	КонецЕсли;
	
	
	Если ТипОбъекта = Неопределено Тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	КатегорияСобытияСогласования = Справочники.КатегорииСобытийОповещений.СобытияСогласования;
	МакетСКД = РасширениеПроцессыИСогласованиеУХ.ПолучитьСхемуСКДДляПодстановкиВШаблоне(ТипОбъекта, , КатегорияСобытияСогласования);
	
	КомпоновщикНастроек.Инициализировать(Новый ИсточникДоступныхНастроекКомпоновкиДанных(ПоместитьВоВременноеХранилище(МакетСКД, УникальныйИдентификатор)));
		
	ПолеШаблонаТекст = Параметры.ТекущееПредставление;
	
КонецПроцедуры

&НаКлиенте
Процедура КомпоновщикНастроекНастройкиПорядокДоступныеПоляПорядкаНачалоПеретаскивания(Элемент, ПараметрыПеретаскивания, Выполнение)
	ТекСтр = Элементы.КомпоновщикНастроекНастройкиПорядокДоступныеПоляПорядка.ТекущаяСтрока;
	Если НЕ ТекСтр = Неопределено Тогда
		СтрокаОтбора = КомпоновщикНастроек.Настройки.Порядок.ДоступныеПоляПорядка.ПолучитьОбъектПоИдентификатору(Элементы.КомпоновщикНастроекНастройкиПорядокДоступныеПоляПорядка.ТекущаяСтрока);
		Если СтрокаОтбора.Папка Тогда
			СтандартнаяОбработка = Ложь;
			Возврат;
		КонецЕсли;
	Иначе
		СтандартнаяОбработка = Ложь;
		Возврат;
	КонецЕсли;
	
	ПараметрыПеретаскивания.Значение = ПолучитьИмяПоляВШаблоне(Строка(СтрокаОтбора.Поле));

КонецПроцедуры

&НаКлиенте
Функция ПолучитьИмяПоляВШаблоне(ИмяПоля)
		
	Если СокрЛП(ПолеШаблонаТекст) = "" Тогда
		
		СтрокаШаблона = Нстр("ru = 'Строка(&%1)'");
		
		Результат = "";
		Если Не ПустаяСтрока(СтрокаШаблона) тогда								
			Результат = СтрШаблон(СтрокаШаблона, ИмяПоля);
		КонецЕсли;
		
		Возврат Результат;
		
	Иначе
		
		СтрокаШаблона = Нстр("ru = ' + Строка(&%1)'");
		
		Результат = "";
		Если Не ПустаяСтрока(СтрокаШаблона) тогда								
			Результат = СтрШаблон(СтрокаШаблона, ИмяПоля);
		КонецЕсли;
		
		Возврат Результат;
		
	КонецЕсли;	
		
КонецФункции



