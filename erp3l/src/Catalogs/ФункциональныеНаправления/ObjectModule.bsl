#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область ОбработчикиСобытий

Процедура ПриЗаписи(Отказ)
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	НаборФНРазвернутые = РегистрыСведений.ФункциональныеНаправленияРазвернутые.СоздатьНаборЗаписей();
	НаборФНРазвернутые.Прочитать();
	ТзФНРазвернутые = НаборФНРазвернутые.Выгрузить();
	ТзФНРазвернутые.Очистить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	ФункциональныеНаправления.Ссылка,
	|	ФункциональныеНаправления.Родитель
	|ИЗ
	|	Справочник.ФункциональныеНаправления КАК ФункциональныеНаправления";
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
	
		 ЗаполнитьРодителей(Выборка.Ссылка,Выборка.родитель,ТзФНРазвернутые);
	
	КонецЦикла;
	
	НаборФНРазвернутые.Загрузить(ТзФНРазвернутые);
	НаборФНРазвернутые.Записать(Истина);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура ЗаполнитьРодителей(Элемент,Родитель,ТзФНРазвернутые)
	
	Если ЗначениеЗаполнено(Родитель) Тогда	
		нЭл = ТзФНРазвернутые.Добавить();
    	нЭл.ФН_Элемент = Элемент;
		нЭл.ФН_Предок = Родитель;
        ЗаполнитьРодителей(Элемент,Родитель.Родитель,ТзФНРазвернутые)
	Иначе		
		нЭл = ТзФНРазвернутые.Добавить();
    	нЭл.ФН_Элемент = Элемент;
		нЭл.ФН_Предок = Элемент;
	КонецЕсли;	
	
	
КонецПроцедуры	

#КонецОбласти

#КонецЕсли 