
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	УниверсальныйОтчет = Параметры.УниверсальныйОтчет;
	
	Если НЕ ЗначениеЗаполнено(УниверсальныйОтчет) Тогда
		
		Отказ = Истина;
		ОбщегоНазначенияУХ.СообщитьОбОшибке(НСтр("ru = 'Для текущей области нельзя установить подчиненные области'"));
		Возврат;
		
	КонецЕсли;
	
	ТекущиеРасшифровки = УниверсальныйОтчет.Расшифровки.Получить();
	
	Если ТекущиеРасшифровки = Неопределено Тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	Для Каждого Элемент Из ТекущиеРасшифровки Цикл
		НоваяСтрока = НаборОтчетов.Добавить();
		НоваяСтрока.Отчет = Элемент.Отчет;
		НоваяСтрока.Использовать       = Истина;
	КонецЦикла;
	
	// Для МКП нужно добавить еще структуру и динамику показателей.
	Если УниверсальныйОтчет.ВидПроизвольногоОтчета = 1 Тогда
		
		НоваяСтрока = НаборОтчетов.Добавить();
		НоваяСтрока.Отчет = Перечисления.ВидыРасшифровокПоказателяМКП.ДинамикаПоказателя;
		НоваяСтрока.Использовать       = Истина;
		
		НоваяСтрока = НаборОтчетов.Добавить();
		НоваяСтрока.Отчет = Перечисления.ВидыРасшифровокПоказателяМКП.СтруктураПоказателя;
		НоваяСтрока.Использовать       = Истина;
	КонецЕсли;
	
	Если НаборОтчетов.Количество() = 0 Тогда
		
		ОбщегоНазначенияУХ.СообщитьОбОшибке(НСтр("ru = 'Для текущей области нет подчиненных отчетов'"));
		Отказ = Истина;
		Возврат;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОК(Команда)
	
	НайденныеСтроки = НаборОтчетов.НайтиСтроки(Новый Структура("Использовать", Истина));
	
	МассивОтвета = Новый Массив;
	Для Каждого Элемент Из НайденныеСтроки Цикл
		МассивОтвета.Добавить(Элемент.Отчет);
	КонецЦикла;
	
	Закрыть(МассивОтвета);
	
КонецПроцедуры


&НаКлиенте
Процедура УстановитьФлажки(Команда)
	
	Для Каждого Элемент ИЗ НаборОтчетов Цикл
		
		Элемент.Использовать = Истина;
		
	КонецЦикла;
	
КонецПроцедуры


&НаКлиенте
Процедура СнятьФлажки(Команда)
	
	Для Каждого Элемент ИЗ НаборОтчетов Цикл
		
		Элемент.Использовать = Ложь;
		
	КонецЦикла;
	
КонецПроцедуры

