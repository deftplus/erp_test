
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ВыполняетсяОбработка = Истина;
	ИдентификаторЗадания = Параметры.ИдентификаторЗадания;
	
КонецПроцедуры


Функция ПроверитьСтатусПроцесса()
	
	Если Не ЗначениеЗаполнено(ИдентификаторЗадания)  Тогда
		Возврат 0; //Были ошибки или задание потерялоь
	КонецЕсли;
	
	Попытка
		Если ДлительныеОперации.ЗаданиеВыполнено(ИдентификаторЗадания) Тогда
			Возврат 1;//Задание успешно выполнено
		Иначе	 
			Возврат 2;//Задание выполняется
		КонецЕсли;	
	Исключение
		Возврат 0; //Были ошибки
	КонецПопытки;	
		
КонецФункции


&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	ПодключитьОбработчикОжидания("ОжиданиеОбновленияДанных",1);
	
КонецПроцедуры

&НаКлиенте
Процедура ОжиданиеОбновленияДанных()
		
	СтатусВыполнения = ПроверитьСтатусПроцесса();

	Если  СтатусВыполнения=0  Тогда
		ОбщегоНазначенияУХ.СообщитьОбОшибке(НСтр("ru = 'Возникли ошибки при попытке записи! Подробнее см. журнал регистрации'"));	
		ОтключитьОбработчикОжидания("ОжиданиеОбновленияДанных");
		ВыполняетсяОбработка = Ложь;
		Закрыть(Новый Структура("СтатусВыполнения",0));
		
	ИначеЕсли СтатусВыполнения=1 Тогда		
				
		ВыполняетсяОбработка = Ложь;
		ОтключитьОбработчикОжидания("ОжиданиеОбновленияДанных");
        Закрыть(Новый Структура("СтатусВыполнения",0));
	КонецЕсли;
	
КонецПроцедуры	

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка) 
	
	Если ВыполняетсяОбработка Тогда
		 Отказ = Истина;
	КонецЕсли;	
		
КонецПроцедуры
