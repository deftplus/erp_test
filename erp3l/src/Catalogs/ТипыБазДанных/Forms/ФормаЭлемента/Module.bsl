
&НаСервере
Процедура ЗагрузитьСтруктуруМетаданныхСервер()
	
	Если Объект.ВерсияПлатформы = Перечисления.ПлатформыВнешнихИнформационныхБаз.ADO Тогда
		
		Справочники.ТаблицыADO.ОбновитьТаблицыADO(Объект.Ссылка);
				
	Иначе 
		
		ТипИБ = Объект.Ссылка;
		Это77 = (Объект.ВерсияПлатформы = Перечисления.ПлатформыВнешнихИнформационныхБаз.Предприятие77);
		
		Кэш = РаботаСОбъектамиМетаданныхУХ.НовыйКэшОбновленияМетаданных();
		
		ОбщегоНазначенияУХ.ЗаполнитьСписокСправочниковБД(ТипИБ,, Кэш);
		ОбщегоНазначенияУХ.ЗаполнитьСписокДокументовБД(ТипИБ,, Кэш);
		ОбщегоНазначенияУХ.ЗаполнитьСписокПеречисленийБД(ТипИБ,, Кэш);
		Если НЕ Это77 Тогда
			ОбщегоНазначенияУХ.ЗаполнитьСписокПлановВидовХарактеристикБД(ТипИБ,,Кэш);
		КонецЕсли;		
		ОбщегоНазначенияУХ.ЗаполнитьСписокРегистровБД(ТипИБ,, Истина, Истина, Истина, Истина, НЕ Это77, Кэш);
							
	КонецЕсли;
			
КонецПроцедуры // ЗаполнитьСписокРегистров() 

&НаКлиенте
Процедура ЗагрузитьСтруктуруМетаданных(Команда)
	
	Если Объект.Ссылка.Пустая() Тогда
		ТекстВопроса = НСтр("ru = 'Тип ИБ еще не записан.
			|Загрузка структуры метаданных возможна только после записи.
			|Данные будут записаны.'");
		
		ОписаниеОповещения = Новый ОписаниеОповещения("ЗагрузитьСтруктуруМетаданныхПродолжение", ЭтотОбъект);
			
		ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, РежимДиалогаВопрос.ОКОтмена,,КодВозвратаДиалога.Отмена);
		Возврат;
	КонецЕсли;
	
	ЗагрузитьСтруктуруМетаданныхСервер();
	
	//Если РаботаСДиалогамиУХ.СохранитьНовый(ЭтаФорма) Тогда
	//	
	//	ЗагрузитьСтруктуруМетаданныхСервер();
	//	
	//КонецЕсли;
		
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьСтруктуруМетаданныхПродолжение(Результат, Параметры) Экспорт
	
	Если Результат = КодВозвратаДиалога.Отмена Тогда
		Возврат;
	КонецЕсли;
	
	Если Записать() Тогда 
		ЗагрузитьСтруктуруМетаданныхСервер();	
	Иначе
		ПоказатьПредупреждение(,"При записи типа ИБ произошла ошибка");
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Элементы.ГруппаНастройкиПодключения.Видимость = НЕ Объект.Предопределенный;
	Элементы.Наименование.Доступность = НЕ Объект.Предопределенный;

КонецПроцедуры

&НаКлиенте
Процедура НастроитьСоответствия(Команда)
	
	Если НЕ Объект.Предопределенный Тогда
		
		ОткрытьФорму("Справочник.СоответствиеВнешнимИБ.ФормаСписка", Новый Структура("Отбор", Новый Структура("Владелец", Объект.Ссылка)));
		
	ИначеЕсли Объект.Ссылка = ПредопределенноеЗначение("Справочник.ТипыБазДанных.ТекущаяИБ") Тогда
		
		// Откроем форму настройки сооответствия видов субконто
		
	Иначе
		
		ОткрытьФорму("Справочник.ТипыБазДанных.Форма.НастройкаПолейДляВидаАналитик");
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервереБезКонтекста
Функция ПодключениеПоВебСервису(ВнешняяИБ) 
	
	Возврат ВнешняяИБ.ИспользоватьWS;
		
КонецФункции // ПодключениеПоВебСервису()
