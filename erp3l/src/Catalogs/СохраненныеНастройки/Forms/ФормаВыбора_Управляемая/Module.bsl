
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Параметры.Свойство("РежимСохраненияНастройки", РежимСохраненияНастройки);
	Элементы.Группа_СохранениеВыбор.ТекущаяСтраница = ?(РежимСохраненияНастройки, Элементы.Страница_Сохранение, Элементы.Страница_Выбор);
	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьВариант(Команда)
	
	Закрыть(СохранитьНовуюНастройку());
	
КонецПроцедуры

&НаСервере
Функция СохранитьНовуюНастройку()
	
	НовыйЭлемент = Справочники.СохраненныеНастройки.СоздатьЭлемент();
	НовыйЭлемент.Наименование = Наименование;
	
	ЛевоеЗначение_НастраиваемыйОбъект = Новый ПолеКомпоновкиДанных("НастраиваемыйОбъект");
	ЛевоеЗначение_ТипНастройки        = Новый ПолеКомпоновкиДанных("ТипНастройки");
	
	Для Каждого Элемент Из Список.Отбор.Элементы Цикл
		Если Элемент.ЛевоеЗначение = ЛевоеЗначение_НастраиваемыйОбъект Тогда
			НастраиваемыйОбъект = Элемент.ПравоеЗначение;
		ИначеЕсли Элемент.ЛевоеЗначение = ЛевоеЗначение_ТипНастройки Тогда
			ТипНастройки = Элемент.ПравоеЗначение;
		КонецЕсли;
	КонецЦикла;
	
	НовыйЭлемент.НастраиваемыйОбъект = НастраиваемыйОбъект;
	НовыйЭлемент.Владелец            = ОбщегоНазначенияУХ.ПолучитьЗначениеПеременной("глТекущийПользователь");
	НовыйЭлемент.ТипНастройки        = ТипНастройки;
	
	НовыйПользователь = НовыйЭлемент.Пользователи.Добавить();
	НовыйПользователь.Пользователь = ОбщегоНазначенияУХ.ПолучитьЗначениеПеременной("глТекущийПользователь");
	НовыйПользователь.ПравоИзменения = Истина;
	Отказ = Ложь;
	Сообщение = "";
	НовыйЭлемент.ПроверитьОбязательныеРеквизиты(НовыйЭлемент, Отказ, Сообщение);
	Если Отказ Тогда
		Сообщить("Элемент не может быть записан! " + Сообщение, СтатусСообщения.Важное);
		Возврат Неопределено;
	КонецЕсли;
	
	НовыйЭлемент.Записать();
	Возврат НовыйЭлемент.Ссылка;
	
КонецФункции

&НаКлиенте
Процедура СохранитьНастройку()
	
	ТекущаяСтрока = Элементы.Список.ДанныеСтроки(Элементы.Список.ТекущаяСтрока);
	
	Если ТекущаяСтрока <> Неопределено Тогда
		
		Ответ = Неопределено;

		ДопПараметры = Новый Структура("ТекущаяСтрока", ТекущаяСтрока);
		Оповещение = Новый ОписаниеОповещения("Подключаемый_СохранитьНастройку", ЭтотОбъект, ДопПараметры);
		ТекстВопроса = "Заменить существующую настройку """ + ТекущаяСтрока.Наименование + """?";
		
		ПоказатьВопрос(Оповещение, ТекстВопроса, РежимДиалогаВопрос.ДаНет,, КодВозвратаДиалога.Нет);
		
	Иначе
		
		// Создание новой настройки
		Закрыть(СохранитьНовуюНастройку());
		
	КонецЕсли;	
	
КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_СохранитьНастройку(РезультатВопроса, ДополнительныеПараметры) Экспорт
    
    ТекущаяСтрока = ДополнительныеПараметры.ТекущаяСтрока;
        
    Ответ = РезультатВопроса;
    Если Ответ = КодВозвратаДиалога.Да Тогда
        Закрыть(ТекущаяСтрока.Ссылка);
    Иначе
        Возврат;
    КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура СписокВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	Если РежимСохраненияНастройки Тогда
		СохранитьНастройку();
	Иначе
		Если Открыта() Тогда
			ОповеститьОВыборе(ВыбраннаяСтрока);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры
