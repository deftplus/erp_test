&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Отбор.Свойство("Владелец") И ЗначениеЗаполнено(Параметры.Отбор.Владелец) Тогда
		
		ТипБД=Параметры.Отбор.Владелец;
		
		Если ТипБД.ВерсияПлатформы=Перечисления.ПлатформыВнешнихИнформационныхБаз.ADO Тогда
			
			ОбщегоНазначенияУХ.СообщитьОбОшибке(НСтр("ru = 'Для выбранного типа информационной базы доступны только таблицы ADO'"), Отказ, , СтатусСообщения.Информация);
			Возврат;
			
		КонецЕсли;
		
		Элементы.ТипБД.Доступность=Ложь;
		
		ДобавитьОтборПоПравилам();
		
	Иначе
		
		Если Параметры.ОбластьГенерации=Перечисления.ОбластиГенерацииОбъектов.ВнешняяИБ Тогда
			
			Запрос=Новый Запрос;
			Запрос.Текст="ВЫБРАТЬ ПЕРВЫЕ 1
			|	ТипыБазДанных.Ссылка КАК Ссылка
			|ИЗ
			|	Справочник.ТипыБазДанных КАК ТипыБазДанных
			|ГДЕ
			|	НЕ ТипыБазДанных.Ссылка = ЗНАЧЕНИЕ(Справочник.ТипыБазДанных.ТекущаяИБ)";
			
			Результат=Запрос.Выполнить().Выбрать();
			
			Если Результат.Следующий() Тогда
				
				ТипБД=Результат.Ссылка;
				
			КонецЕсли;
				
		Иначе
			
			Элементы.ТипБД.Доступность=(НЕ Параметры.Отбор.Свойство("ИспользуетсяВПроцессе"));	
			ТипБД=Справочники.ТипыБазДанных.ТекущаяИБ;
			
		КонецЕсли;
		
		ОбновитьОтборПоВладельцу();
		
	КонецЕсли;
	
	Если ТипБД=Справочники.ТипыБазДанных.ТекущаяИБ Тогда
		
		Элементы.СписокЗагрузитьИЗВИБ.Заголовок = НСтр("ru = 'Обновить по данным текущей ИБ'");
		Элементы.ИспользуетсяВПроцессе.Видимость = Истина;
		
	Иначе
		
		Элементы.СписокЗагрузитьИЗВИБ.Заголовок = НСтр("ru = 'Обновить по данным внешней ИБ'");
		Элементы.ИспользуетсяВПроцессе.Видимость = Ложь;
		
	КонецЕсли;	
	
КонецПроцедуры

&НаСервере
Процедура ДобавитьОтборПоПравилам()
	
	Если Параметры.ДляЗаполненияПоПравилам Тогда
		
		Запрос=Новый Запрос;
		Запрос.Текст="ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПравилаЗаполненияОбъектовБД.Владелец КАК ДокументБД
		|ИЗ
		|	Справочник.ПравилаЗаполненияОбъектовБД КАК ПравилаЗаполненияОбъектовБД
		|ГДЕ
		|	НЕ ПравилаЗаполненияОбъектовБД.ПометкаУдаления
		|	И ПравилаЗаполненияОбъектовБД.Владелец.Владелец = &ТипБД";
		
		Запрос.УстановитьПараметр("ТипБД",ТипБД);
		
		СписокОтбора=Новый СписокЗначений;
		СписокОтбора.ЗагрузитьЗначения(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ДокументБД"));
		
		ОбщегоНазначенияКлиентСерверУХ.УстановитьЭлементОтбора(Список.Отбор,"Ссылка",СписокОтбора,ВидСравненияКомпоновкиДанных.ВСписке,,Истина);
		
	КонецЕсли;
	
		
КонецПроцедуры // ДобавитьОтборПоПравилам()

&НаСервере
Процедура ОбновитьОтборПоВладельцу()
	
	Если Параметры.ДляЗаполненияПоПравилам Тогда
		
		Запрос=Новый Запрос;
		Запрос.Текст="ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ПравилаЗаполненияОбъектовБД.Владелец КАК ДокументБД
		|ИЗ
		|	Справочник.ПравилаЗаполненияОбъектовБД КАК ПравилаЗаполненияОбъектовБД
		|ГДЕ
		|	НЕ ПравилаЗаполненияОбъектовБД.ПометкаУдаления
		|	И ПравилаЗаполненияОбъектовБД.Владелец.Владелец = &ТипБД";
		
		Запрос.УстановитьПараметр("ТипБД",ТипБД);
		
		СписокОтбора=Новый СписокЗначений;
		СписокОтбора.ЗагрузитьЗначения(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("ДокументБД"));
		
		ОбщегоНазначенияКлиентСерверУХ.УстановитьЭлементОтбора(Список.Отбор,"Ссылка",СписокОтбора,ВидСравненияКомпоновкиДанных.ВСписке,,Истина);
		
	Иначе
		
		ОбщегоНазначенияКлиентСерверУХ.УстановитьЭлементОтбора(Список.Отбор,"Владелец",ТипБД,ВидСравненияКомпоновкиДанных.Равно,,Истина);
		
	КонецЕсли;
	
	Если ТипБД=Справочники.ТипыБазДанных.ТекущаяИБ Тогда
		
		Элементы.СписокЗагрузитьИЗВИБ.Заголовок = НСтр("ru = 'Обновить по данным текущей ИБ'");
		Элементы.ИспользуетсяВПроцессе.Видимость = Истина;
		
	Иначе
		
		Элементы.СписокЗагрузитьИЗВИБ.Заголовок = НСтр("ru = 'Обновить по данным внешней ИБ'");
		Элементы.ИспользуетсяВПроцессе.Видимость = Ложь;
		
	КонецЕсли;
	
	ДобавитьОтборПоПравилам();
		
КонецПроцедуры // ОбновитьОтборПоВладельцу() 

&НаСервереБезКонтекста
Процедура ЗаполнитьСписокДокументов(ТипБД)
		
	ОбщегоНазначенияУХ.ЗаполнитьСписокДокументовБД(ТипБД);
	
КонецПроцедуры //

&НаКлиенте
Процедура ТипБДПриИзменении(Элемент)
	
	ОбновитьОтборПоВладельцу();
	
КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьИЗВИБ(Команда)
	
	Если НЕ ЗначениеЗаполнено(ТипБД) Тогда
		
		ПоказатьПредупреждение(, НСтр("ru = 'Не указан тип внешней информационной базы.'"));
		Возврат;
		
	Иначе
		
		ЗаполнитьСписокДокументов(ТипБД);
		Элементы.Список.Обновить();
		
	КонецЕсли;
			
КонецПроцедуры

&НаКлиенте
Процедура ТипБДНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	Если ЗначениеЗаполнено(Параметры.ОбластьГенерации) Тогда
		
		СтандартнаяОбработка=Ложь;
		ОткрытьФорму("Справочник.ТипыБазДанных.ФормаВыбора",Новый Структура("ОбластьГенерации",Параметры.ОбластьГенерации),Элемент);
		
	КонецЕсли;
	
КонецПроцедуры
