

Процедура ПередЗаписью(Отказ)
	
	Если  Не ЗначениеЗаполнено(СвязанныйПериод) Тогда		
		СвязанныйПериод = ПолучитьПериодПоРеквизитам();
		Если Не  ЗначениеЗаполнено(СвязанныйПериод) Тогда
			СвязанныйПериод =Справочники.КлючиШкалы.ЗаполнитьСвязанныйПериод(СвязанныйПериод,ЭтотОбъект);		
		КонецЕсли;	
	КонецЕсли;	

КонецПроцедуры



Функция  ПолучитьПериодПоРеквизитам()
	
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Периоды.Ссылка КАК Ссылка,
		|	Периоды.ДатаНачала КАК ДатаНачала,
		|	Периоды.ДатаОкончания КАК ДатаОкончания
		|ИЗ
		|	Справочник.Периоды КАК Периоды
		|ГДЕ
		|	Периоды.Периодичность = &Периодичность
		|	И (Периоды.ДатаНачала = &ДатаНачала 
		|			ИЛИ Периоды.ДатаОкончания = &ДатаОкончания)
		|	И Периоды.Произвольный = ЛОЖЬ
		|	И Периоды.ПометкаУдаления = ЛОЖЬ";
		
		
		Запрос.УстановитьПараметр("Периодичность", ЭтотОбъект.Периодичность);
		Запрос.УстановитьПараметр("ДатаНачала",    ЭтотОбъект.ДатаНачала);
		Запрос.УстановитьПараметр("ДатаОкончания", ЭтотОбъект.ДатаОкончания);
		
		Выборка = Запрос.Выполнить().Выбрать();
		Пока Выборка.Следующий() Цикл	
			Возврат Выборка.Ссылка;	
		КонецЦикла;
	
	    Возврат Справочники.Периоды.ПустаяСсылка();
	
КонецФункции