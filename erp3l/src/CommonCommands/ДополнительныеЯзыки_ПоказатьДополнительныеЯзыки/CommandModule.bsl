
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
		
	Если ПараметрыВыполненияКоманды.Источник.Параметры.Свойство("Ключ") Тогда
		
		ПараметрыФормы = Новый Структура("Ссылка,ФормаИмя",ПараметрКоманды,ПараметрыВыполненияКоманды.Источник.ИмяФормы);
		ОткрытьФорму("ОбщаяФорма.ФормаРедактированияДополнительныхЯзыковЭлемент", ПараметрыФормы, ПараметрыВыполненияКоманды.Источник, ПараметрыВыполненияКоманды.Уникальность, ПараметрыВыполненияКоманды.Окно, ПараметрыВыполненияКоманды.НавигационнаяСсылка);
		
	Иначе
		
		СтруктураИмени=ОбщегоНазначенияУХ.РазложитьСтрокуВМассивПодстрок(ПараметрыВыполненияКоманды.Источник.ИмяФормы,".");
		ТаблицаАналитики=СтруктураИмени[0]+"."+СтруктураИмени[1];
		
		Владелец=Неопределено;
		
		ТипЗначенияВладельца=ТипЗначенияВладельца(ТаблицаАналитики);
		
		Если НЕ ТипЗначенияВладельца=Неопределено Тогда
			
			Попытка
				
				ОсновнойСписок=ПараметрыВыполненияКоманды.Источник["Список"];
				
				Если ТипЗнч(ОсновнойСписок)=Тип("ДинамическийСписок") Тогда
					
					Владелец=ПолучитьВладельцаИзОтбора(ОсновнойСписок);
												
				КонецЕсли;
				
			Исключение
				
				Владелец=ПолучитьВладельцаПоСсылке(ПараметрКоманды);
				
			КонецПопытки;
			
		КонецЕсли;
				
		ПараметрыФормы = Новый Структура("ТаблицаАналитики,ТипЗначенияВладельца,Владелец",ТаблицаАналитики,ТипЗначенияВладельца,Владелец);
		
		ОткрытьФорму("ОбщаяФорма.ФормаРедактированияДополнительныхЯзыковСписок", ПараметрыФормы, ПараметрыВыполненияКоманды.Источник, ПараметрыВыполненияКоманды.Уникальность, ПараметрыВыполненияКоманды.Окно, ПараметрыВыполненияКоманды.НавигационнаяСсылка);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Функция ПолучитьВладельцаИзОтбора(ОсновнойСписок)
	
	Поле = Новый ПолеКомпоновкиДанных("Владелец");
	
	Для Каждого Элемент ИЗ ОсновнойСписок.Отбор.Элементы Цикл
		
		Если Элемент.ЛевоеЗначение=Поле И Элемент.ВидСравнения=ВидСравненияКомпоновкиДанных.Равно Тогда
			
			Возврат Элемент.ПравоеЗначение;
			
		КонецЕсли;
		
	КонецЦикла;
	
	Возврат Неопределено;
	
КонецФункции // ПолучитьВладельцаИзОтбора() 

&НаСервере
Функция ПолучитьВладельцаПоСсылке(Ссылка)
	
	Возврат Ссылка.Владелец;
	
КонецФункции // ПолучитьВладельцаПоСсылке()

&НаКлиенте
Функция ОпределитьОтборПоВладельцу(ТипЗначенияВладельца,Источник)
	
	МассивЭлементов=Новый Массив;
	
	
КонецФункции // ОпределитьОтборПоВладельцу() 

&НаСервере
Функция ТипЗначенияВладельца(ТаблицаАналитики)

	Если СтрНайти(ТаблицаАналитики,"Справочник.")=0 Тогда
		
		Возврат Неопределено;
		
	КонецЕсли;
	
	МетаданныеОбъекта=ОбщегоНазначенияУХ.ПолучитьОбъектМетаданныхПоТаблицеАналитики(ТаблицаАналитики);
	
	СтрокаТипов="";
	
	Для Каждого ТекВладелец ИЗ МетаданныеОбъекта.Владельцы Цикл
		
		СтрокаТипов=СтрокаТипов+";"+РаботаСОбъектамиМетаданныхВнешнийУХ.ПолучитьРабочееПредставлениеТипа(ТекВладелец.FullName());
		
	КонецЦикла;
	
	Если СтрДлина(СтрокаТипов)>0 Тогда
		
		Возврат ОбщегоНазначенияУХ.ПолучитьОписаниеТиповИзСтрокиТипов(Сред(СтрокаТипов,2));
		
	Иначе
		
		Возврат Неопределено;
		
	КонецЕсли;
	
КонецФункции // МассивТаблицВладельца()




