
&НаКлиенте
Процедура ллл_ОбработатьВыборДокумента(Результат, ДополнительныеПараметры) Экспорт
	
	Если ЗначениеЗаполнено(Результат) Тогда
		МассивДокументов = ПриобретенияИзСделки(Результат);
		Для Каждого ТекДок Из МассивДокументов Цикл
			НоваяСтрока = СписокДокументов.Добавить();
			НоваяСтрока.АналитикаРасходов = ТекДок;
			Элементы.СписокДокументов.ТекущаяСтрока = НоваяСтрока.ПолучитьИдентификатор();
			СписокДокументовДокументПриИзменении(Неопределено);
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПриобретенияИзСделки(Результат)
	
	МассивДокументов = Новый Массив;
	Если ЗначениеЗаполнено(Результат) Тогда
		ТекМассивДок = СписокДокументов.Выгрузить(, "АналитикаРасходов").ВыгрузитьКолонку("АналитикаРасходов");
		Для Каждого ТекСтр Из Результат.ЗаказыПоставщикам Цикл
			Если ЗначениеЗаполнено(ТекСтр.ПриобретениеТоваровУслуг)
				И МассивДокументов.Найти(ТекСтр.ПриобретениеТоваровУслуг) = Неопределено
				И ТекМассивДок.Найти(ТекСтр.ПриобретениеТоваровУслуг) = Неопределено Тогда
				МассивДокументов.Добавить(ТекСтр.ПриобретениеТоваровУслуг);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	Возврат МассивДокументов;
	
КонецФункции

&НаКлиенте
Процедура ллл_ПодобратьДокументыПоЛогистическойСделкеПосле(Команда)
	
	ПараметрыФормы = Новый Структура();
	ПараметрыФормы.Вставить("РежимВыбора",        Истина);
	ПараметрыФормы.Вставить("МножественныйВыбор", Ложь);

	ОповещениеЗакрытия  = Новый ОписаниеОповещения("ллл_ОбработатьВыборДокумента", ЭтотОбъект);
	
	ОткрытьФорму("Документ.ллл_ЛогистическаяСделка.ФормаВыбора", ПараметрыФормы, ЭтаФорма, , , ,
		ОповещениеЗакрытия, РежимОткрытияОкнаФормы.БлокироватьОкноВладельца); 
	
КонецПроцедуры
